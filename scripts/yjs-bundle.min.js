(()=>{var Ya=Object.create;var Ni=Object.defineProperty;var Ka=Object.getOwnPropertyDescriptor;var Ja=Object.getOwnPropertyNames;var Xa=Object.getPrototypeOf,Za=Object.prototype.hasOwnProperty;var Ln=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Qa=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),oo=(e,t)=>{for(var n in t)Ni(e,n,{get:t[n],enumerable:!0})},tl=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ja(t))!Za.call(e,s)&&s!==n&&Ni(e,s,{get:()=>t[s],enumerable:!(r=Ka(t,s))||r.enumerable});return e};var el=(e,t,n)=>(n=e!=null?Ya(Xa(e)):{},tl(t||!e||!e.__esModule?Ni(n,"default",{value:e,enumerable:!0}):n,e));var La=Qa((Oa,zs)=>{(function(e){if(typeof Oa=="object"&&typeof zs<"u")zs.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var t;t=typeof window>"u"?typeof global>"u"?typeof self>"u"?this:self:global:window,t.SimplePeer=e()}})(function(){var e=Math.floor,t=Math.abs,n=Math.pow;return(function(){function r(s,o,a){function h(u,f){if(!o[u]){if(!s[u]){var p=typeof Ln=="function"&&Ln;if(!f&&p)return p(u,!0);if(g)return g(u,!0);var y=new Error("Cannot find module '"+u+"'");throw y.code="MODULE_NOT_FOUND",y}var w=o[u]={exports:{}};s[u][0].call(w.exports,function(S){var R=s[u][1][S];return h(R||S)},w,w.exports,r,s,o,a)}return o[u].exports}for(var g=typeof Ln=="function"&&Ln,l=0;l<a.length;l++)h(a[l]);return h}return r})()({1:[function(r,s,o){"use strict";function a(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var C=_.indexOf("=");C===-1&&(C=v);var x=C===v?0:4-C%4;return[C,x]}function h(_,v,C){return 3*(v+C)/4-C}function g(_){var v,C,x=a(_),A=x[0],O=x[1],E=new w(h(_,A,O)),k=0,L=0<O?A-4:A;for(C=0;C<L;C+=4)v=y[_.charCodeAt(C)]<<18|y[_.charCodeAt(C+1)]<<12|y[_.charCodeAt(C+2)]<<6|y[_.charCodeAt(C+3)],E[k++]=255&v>>16,E[k++]=255&v>>8,E[k++]=255&v;return O===2&&(v=y[_.charCodeAt(C)]<<2|y[_.charCodeAt(C+1)]>>4,E[k++]=255&v),O===1&&(v=y[_.charCodeAt(C)]<<10|y[_.charCodeAt(C+1)]<<4|y[_.charCodeAt(C+2)]>>2,E[k++]=255&v>>8,E[k++]=255&v),E}function l(_){return p[63&_>>18]+p[63&_>>12]+p[63&_>>6]+p[63&_]}function u(_,v,C){for(var x,A=[],O=v;O<C;O+=3)x=(16711680&_[O]<<16)+(65280&_[O+1]<<8)+(255&_[O+2]),A.push(l(x));return A.join("")}function f(_){for(var v,C=_.length,x=C%3,A=[],O=16383,E=0,k=C-x;E<k;E+=O)A.push(u(_,E,E+O>k?k:E+O));return x===1?(v=_[C-1],A.push(p[v>>2]+p[63&v<<4]+"==")):x===2&&(v=(_[C-2]<<8)+_[C-1],A.push(p[v>>10]+p[63&v>>4]+p[63&v<<2]+"=")),A.join("")}o.byteLength=function(_){var v=a(_),C=v[0],x=v[1];return 3*(C+x)/4-x},o.toByteArray=g,o.fromByteArray=f;for(var p=[],y=[],w=typeof Uint8Array>"u"?Array:Uint8Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=0,m=S.length;R<m;++R)p[R]=S[R],y[S.charCodeAt(R)]=R;y[45]=62,y[95]=63},{}],2:[function(){},{}],3:[function(r,s,o){(function(){(function(){"use strict";var a=String.fromCharCode,h=Math.min;function g(i){if(2147483647<i)throw new RangeError('The value "'+i+'" is invalid for option "size"');var c=new Uint8Array(i);return c.__proto__=l.prototype,c}function l(i,c,d){if(typeof i=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(i)}return u(i,c,d)}function u(i,c,d){if(typeof i=="string")return w(i,c);if(ArrayBuffer.isView(i))return S(i);if(i==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(T(i,ArrayBuffer)||i&&T(i.buffer,ArrayBuffer))return R(i,c,d);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var b=i.valueOf&&i.valueOf();if(b!=null&&b!==i)return l.from(b,c,d);var U=m(i);if(U)return U;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return l.from(i[Symbol.toPrimitive]("string"),c,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}function f(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(0>i)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function p(i,c,d){return f(i),0>=i||c===void 0?g(i):typeof d=="string"?g(i).fill(c,d):g(i).fill(c)}function y(i){return f(i),g(0>i?0:0|_(i))}function w(i,c){if((typeof c!="string"||c==="")&&(c="utf8"),!l.isEncoding(c))throw new TypeError("Unknown encoding: "+c);var d=0|v(i,c),b=g(d),U=b.write(i,c);return U!==d&&(b=b.slice(0,U)),b}function S(i){for(var c=0>i.length?0:0|_(i.length),d=g(c),b=0;b<c;b+=1)d[b]=255&i[b];return d}function R(i,c,d){if(0>c||i.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<c+(d||0))throw new RangeError('"length" is outside of buffer bounds');var b;return b=c===void 0&&d===void 0?new Uint8Array(i):d===void 0?new Uint8Array(i,c):new Uint8Array(i,c,d),b.__proto__=l.prototype,b}function m(i){if(l.isBuffer(i)){var c=0|_(i.length),d=g(c);return d.length===0||i.copy(d,0,0,c),d}return i.length===void 0?i.type==="Buffer"&&Array.isArray(i.data)?S(i.data):void 0:typeof i.length!="number"||D(i.length)?g(0):S(i)}function _(i){if(i>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|i}function v(i,c){if(l.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||T(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);var d=i.length,b=2<arguments.length&&arguments[2]===!0;if(!b&&d===0)return 0;for(var U=!1;;)switch(c){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return Xt(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Ut(i).length;default:if(U)return b?-1:Xt(i).length;c=(""+c).toLowerCase(),U=!0}}function C(i,c,d){var b=!1;if((c===void 0||0>c)&&(c=0),c>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,c>>>=0,d<=c))return"";for(i||(i="utf8");;)switch(i){case"hex":return oe(this,c,d);case"utf8":case"utf-8":return ft(this,c,d);case"ascii":return P(this,c,d);case"latin1":case"binary":return xr(this,c,d);case"base64":return G(this,c,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Jt(this,c,d);default:if(b)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),b=!0}}function x(i,c,d){var b=i[c];i[c]=i[d],i[d]=b}function A(i,c,d,b,U){if(i.length===0)return-1;if(typeof d=="string"?(b=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,D(d)&&(d=U?0:i.length-1),0>d&&(d=i.length+d),d>=i.length){if(U)return-1;d=i.length-1}else if(0>d)if(U)d=0;else return-1;if(typeof c=="string"&&(c=l.from(c,b)),l.isBuffer(c))return c.length===0?-1:O(i,c,d,b,U);if(typeof c=="number")return c&=255,typeof Uint8Array.prototype.indexOf=="function"?U?Uint8Array.prototype.indexOf.call(i,c,d):Uint8Array.prototype.lastIndexOf.call(i,c,d):O(i,[c],d,b,U);throw new TypeError("val must be string, number or Buffer")}function O(i,c,d,b,U){function I(On,Ze){return B===1?On[Ze]:On.readUInt16BE(Ze*B)}var B=1,z=i.length,ot=c.length;if(b!==void 0&&(b=(b+"").toLowerCase(),b==="ucs2"||b==="ucs-2"||b==="utf16le"||b==="utf-16le")){if(2>i.length||2>c.length)return-1;B=2,z/=2,ot/=2,d/=2}var J;if(U){var Y=-1;for(J=d;J<z;J++)if(I(i,J)!==I(c,Y===-1?0:J-Y))Y!==-1&&(J-=J-Y),Y=-1;else if(Y===-1&&(Y=J),J-Y+1===ot)return Y*B}else for(d+ot>z&&(d=z-ot),J=d;0<=J;J--){for(var K=!0,Xe=0;Xe<ot;Xe++)if(I(i,J+Xe)!==I(c,Xe)){K=!1;break}if(K)return J}return-1}function E(i,c,d,b){d=+d||0;var U=i.length-d;b?(b=+b,b>U&&(b=U)):b=U;var I=c.length;b>I/2&&(b=I/2);for(var B,z=0;z<b;++z){if(B=parseInt(c.substr(2*z,2),16),D(B))return z;i[d+z]=B}return z}function k(i,c,d,b){return jt(Xt(c,i.length-d),i,d,b)}function L(i,c,d,b){return jt(In(c),i,d,b)}function M(i,c,d,b){return L(i,c,d,b)}function q(i,c,d,b){return jt(Ut(c),i,d,b)}function H(i,c,d,b){return jt(Dn(c,i.length-d),i,d,b)}function G(i,c,d){return c===0&&d===i.length?N.fromByteArray(i):N.fromByteArray(i.slice(c,d))}function ft(i,c,d){d=h(i.length,d);for(var b=[],U=c;U<d;){var I=i[U],B=null,z=239<I?4:223<I?3:191<I?2:1;if(U+z<=d){var ot,J,Y,K;z===1?128>I&&(B=I):z===2?(ot=i[U+1],(192&ot)==128&&(K=(31&I)<<6|63&ot,127<K&&(B=K))):z===3?(ot=i[U+1],J=i[U+2],(192&ot)==128&&(192&J)==128&&(K=(15&I)<<12|(63&ot)<<6|63&J,2047<K&&(55296>K||57343<K)&&(B=K))):z===4&&(ot=i[U+1],J=i[U+2],Y=i[U+3],(192&ot)==128&&(192&J)==128&&(192&Y)==128&&(K=(15&I)<<18|(63&ot)<<12|(63&J)<<6|63&Y,65535<K&&1114112>K&&(B=K)))}B===null?(B=65533,z=1):65535<B&&(B-=65536,b.push(55296|1023&B>>>10),B=56320|1023&B),b.push(B),U+=z}return At(b)}function At(i){var c=i.length;if(c<=4096)return a.apply(String,i);for(var d="",b=0;b<c;)d+=a.apply(String,i.slice(b,b+=4096));return d}function P(i,c,d){var b="";d=h(i.length,d);for(var U=c;U<d;++U)b+=a(127&i[U]);return b}function xr(i,c,d){var b="";d=h(i.length,d);for(var U=c;U<d;++U)b+=a(i[U]);return b}function oe(i,c,d){var b=i.length;(!c||0>c)&&(c=0),(!d||0>d||d>b)&&(d=b);for(var U="",I=c;I<d;++I)U+=Rn(i[I]);return U}function Jt(i,c,d){for(var b=i.slice(c,d),U="",I=0;I<b.length;I+=2)U+=a(b[I]+256*b[I+1]);return U}function et(i,c,d){if(i%1!=0||0>i)throw new RangeError("offset is not uint");if(i+c>d)throw new RangeError("Trying to access beyond buffer length")}function nt(i,c,d,b,U,I){if(!l.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>U||c<I)throw new RangeError('"value" argument is out of bounds');if(d+b>i.length)throw new RangeError("Index out of range")}function ce(i,c,d,b){if(d+b>i.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function Ft(i,c,d,b,U){return c=+c,d>>>=0,U||ce(i,c,d,4,34028234663852886e22,-34028234663852886e22),F.write(i,c,d,b,23,4),d+4}function ae(i,c,d,b,U){return c=+c,d>>>=0,U||ce(i,c,d,8,17976931348623157e292,-17976931348623157e292),F.write(i,c,d,b,52,8),d+8}function Se(i){if(i=i.split("=")[0],i=i.trim().replace(W,""),2>i.length)return"";for(;i.length%4!=0;)i+="=";return i}function Rn(i){return 16>i?"0"+i.toString(16):i.toString(16)}function Xt(i,c){c=c||1/0;for(var d,b=i.length,U=null,I=[],B=0;B<b;++B){if(d=i.charCodeAt(B),55295<d&&57344>d){if(!U){if(56319<d){-1<(c-=3)&&I.push(239,191,189);continue}else if(B+1===b){-1<(c-=3)&&I.push(239,191,189);continue}U=d;continue}if(56320>d){-1<(c-=3)&&I.push(239,191,189),U=d;continue}d=(U-55296<<10|d-56320)+65536}else U&&-1<(c-=3)&&I.push(239,191,189);if(U=null,128>d){if(0>(c-=1))break;I.push(d)}else if(2048>d){if(0>(c-=2))break;I.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(c-=3))break;I.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(c-=4))break;I.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return I}function In(i){for(var c=[],d=0;d<i.length;++d)c.push(255&i.charCodeAt(d));return c}function Dn(i,c){for(var d,b,U,I=[],B=0;B<i.length&&!(0>(c-=2));++B)d=i.charCodeAt(B),b=d>>8,U=d%256,I.push(U),I.push(b);return I}function Ut(i){return N.toByteArray(Se(i))}function jt(i,c,d,b){for(var U=0;U<b&&!(U+d>=c.length||U>=i.length);++U)c[U+d]=i[U];return U}function T(i,c){return i instanceof c||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===c.name}function D(i){return i!==i}var N=r("base64-js"),F=r("ieee754");o.Buffer=l,o.SlowBuffer=function(i){return+i!=i&&(i=0),l.alloc(+i)},o.INSPECT_MAX_BYTES=50,o.kMaxLength=2147483647,l.TYPED_ARRAY_SUPPORT=(function(){try{var i=new Uint8Array(1);return i.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},i.foo()===42}catch{return!1}})(),l.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){return l.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){return l.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=function(i,c,d){return u(i,c,d)},l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(i,c,d){return p(i,c,d)},l.allocUnsafe=function(i){return y(i)},l.allocUnsafeSlow=function(i){return y(i)},l.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==l.prototype},l.compare=function(i,c){if(T(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),T(c,Uint8Array)&&(c=l.from(c,c.offset,c.byteLength)),!l.isBuffer(i)||!l.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===c)return 0;for(var d=i.length,b=c.length,U=0,I=h(d,b);U<I;++U)if(i[U]!==c[U]){d=i[U],b=c[U];break}return d<b?-1:b<d?1:0},l.isEncoding=function(i){switch((i+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(i,c){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return l.alloc(0);var d;if(c===void 0)for(c=0,d=0;d<i.length;++d)c+=i[d].length;var b=l.allocUnsafe(c),U=0;for(d=0;d<i.length;++d){var I=i[d];if(T(I,Uint8Array)&&(I=l.from(I)),!l.isBuffer(I))throw new TypeError('"list" argument must be an Array of Buffers');I.copy(b,U),U+=I.length}return b},l.byteLength=v,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var i=this.length;if(i%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var c=0;c<i;c+=2)x(this,c,c+1);return this},l.prototype.swap32=function(){var i=this.length;if(i%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var c=0;c<i;c+=4)x(this,c,c+3),x(this,c+1,c+2);return this},l.prototype.swap64=function(){var i=this.length;if(i%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var c=0;c<i;c+=8)x(this,c,c+7),x(this,c+1,c+6),x(this,c+2,c+5),x(this,c+3,c+4);return this},l.prototype.toString=function(){var i=this.length;return i===0?"":arguments.length===0?ft(this,0,i):C.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(i){if(!l.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i||l.compare(this,i)===0},l.prototype.inspect=function(){var i="",c=o.INSPECT_MAX_BYTES;return i=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(i+=" ... "),"<Buffer "+i+">"},l.prototype.compare=function(i,c,d,b,U){if(T(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),!l.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(c===void 0&&(c=0),d===void 0&&(d=i?i.length:0),b===void 0&&(b=0),U===void 0&&(U=this.length),0>c||d>i.length||0>b||U>this.length)throw new RangeError("out of range index");if(b>=U&&c>=d)return 0;if(b>=U)return-1;if(c>=d)return 1;if(c>>>=0,d>>>=0,b>>>=0,U>>>=0,this===i)return 0;for(var I=U-b,B=d-c,z=h(I,B),ot=this.slice(b,U),J=i.slice(c,d),Y=0;Y<z;++Y)if(ot[Y]!==J[Y]){I=ot[Y],B=J[Y];break}return I<B?-1:B<I?1:0},l.prototype.includes=function(i,c,d){return this.indexOf(i,c,d)!==-1},l.prototype.indexOf=function(i,c,d){return A(this,i,c,d,!0)},l.prototype.lastIndexOf=function(i,c,d){return A(this,i,c,d,!1)},l.prototype.write=function(i,c,d,b){if(c===void 0)b="utf8",d=this.length,c=0;else if(d===void 0&&typeof c=="string")b=c,d=this.length,c=0;else if(isFinite(c))c>>>=0,isFinite(d)?(d>>>=0,b===void 0&&(b="utf8")):(b=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var U=this.length-c;if((d===void 0||d>U)&&(d=U),0<i.length&&(0>d||0>c)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");b||(b="utf8");for(var I=!1;;)switch(b){case"hex":return E(this,i,c,d);case"utf8":case"utf-8":return k(this,i,c,d);case"ascii":return L(this,i,c,d);case"latin1":case"binary":return M(this,i,c,d);case"base64":return q(this,i,c,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,i,c,d);default:if(I)throw new TypeError("Unknown encoding: "+b);b=(""+b).toLowerCase(),I=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},l.prototype.slice=function(i,c){var d=this.length;i=~~i,c=c===void 0?d:~~c,0>i?(i+=d,0>i&&(i=0)):i>d&&(i=d),0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d),c<i&&(c=i);var b=this.subarray(i,c);return b.__proto__=l.prototype,b},l.prototype.readUIntLE=function(i,c,d){i>>>=0,c>>>=0,d||et(i,c,this.length);for(var b=this[i],U=1,I=0;++I<c&&(U*=256);)b+=this[i+I]*U;return b},l.prototype.readUIntBE=function(i,c,d){i>>>=0,c>>>=0,d||et(i,c,this.length);for(var b=this[i+--c],U=1;0<c&&(U*=256);)b+=this[i+--c]*U;return b},l.prototype.readUInt8=function(i,c){return i>>>=0,c||et(i,1,this.length),this[i]},l.prototype.readUInt16LE=function(i,c){return i>>>=0,c||et(i,2,this.length),this[i]|this[i+1]<<8},l.prototype.readUInt16BE=function(i,c){return i>>>=0,c||et(i,2,this.length),this[i]<<8|this[i+1]},l.prototype.readUInt32LE=function(i,c){return i>>>=0,c||et(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+16777216*this[i+3]},l.prototype.readUInt32BE=function(i,c){return i>>>=0,c||et(i,4,this.length),16777216*this[i]+(this[i+1]<<16|this[i+2]<<8|this[i+3])},l.prototype.readIntLE=function(i,c,d){i>>>=0,c>>>=0,d||et(i,c,this.length);for(var b=this[i],U=1,I=0;++I<c&&(U*=256);)b+=this[i+I]*U;return U*=128,b>=U&&(b-=n(2,8*c)),b},l.prototype.readIntBE=function(i,c,d){i>>>=0,c>>>=0,d||et(i,c,this.length);for(var b=c,U=1,I=this[i+--b];0<b&&(U*=256);)I+=this[i+--b]*U;return U*=128,I>=U&&(I-=n(2,8*c)),I},l.prototype.readInt8=function(i,c){return i>>>=0,c||et(i,1,this.length),128&this[i]?-1*(255-this[i]+1):this[i]},l.prototype.readInt16LE=function(i,c){i>>>=0,c||et(i,2,this.length);var d=this[i]|this[i+1]<<8;return 32768&d?4294901760|d:d},l.prototype.readInt16BE=function(i,c){i>>>=0,c||et(i,2,this.length);var d=this[i+1]|this[i]<<8;return 32768&d?4294901760|d:d},l.prototype.readInt32LE=function(i,c){return i>>>=0,c||et(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},l.prototype.readInt32BE=function(i,c){return i>>>=0,c||et(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},l.prototype.readFloatLE=function(i,c){return i>>>=0,c||et(i,4,this.length),F.read(this,i,!0,23,4)},l.prototype.readFloatBE=function(i,c){return i>>>=0,c||et(i,4,this.length),F.read(this,i,!1,23,4)},l.prototype.readDoubleLE=function(i,c){return i>>>=0,c||et(i,8,this.length),F.read(this,i,!0,52,8)},l.prototype.readDoubleBE=function(i,c){return i>>>=0,c||et(i,8,this.length),F.read(this,i,!1,52,8)},l.prototype.writeUIntLE=function(i,c,d,b){if(i=+i,c>>>=0,d>>>=0,!b){var U=n(2,8*d)-1;nt(this,i,c,d,U,0)}var I=1,B=0;for(this[c]=255&i;++B<d&&(I*=256);)this[c+B]=255&i/I;return c+d},l.prototype.writeUIntBE=function(i,c,d,b){if(i=+i,c>>>=0,d>>>=0,!b){var U=n(2,8*d)-1;nt(this,i,c,d,U,0)}var I=d-1,B=1;for(this[c+I]=255&i;0<=--I&&(B*=256);)this[c+I]=255&i/B;return c+d},l.prototype.writeUInt8=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,1,255,0),this[c]=255&i,c+1},l.prototype.writeUInt16LE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,2,65535,0),this[c]=255&i,this[c+1]=i>>>8,c+2},l.prototype.writeUInt16BE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,2,65535,0),this[c]=i>>>8,this[c+1]=255&i,c+2},l.prototype.writeUInt32LE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,4,4294967295,0),this[c+3]=i>>>24,this[c+2]=i>>>16,this[c+1]=i>>>8,this[c]=255&i,c+4},l.prototype.writeUInt32BE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,4,4294967295,0),this[c]=i>>>24,this[c+1]=i>>>16,this[c+2]=i>>>8,this[c+3]=255&i,c+4},l.prototype.writeIntLE=function(i,c,d,b){if(i=+i,c>>>=0,!b){var U=n(2,8*d-1);nt(this,i,c,d,U-1,-U)}var I=0,B=1,z=0;for(this[c]=255&i;++I<d&&(B*=256);)0>i&&z===0&&this[c+I-1]!==0&&(z=1),this[c+I]=255&(i/B>>0)-z;return c+d},l.prototype.writeIntBE=function(i,c,d,b){if(i=+i,c>>>=0,!b){var U=n(2,8*d-1);nt(this,i,c,d,U-1,-U)}var I=d-1,B=1,z=0;for(this[c+I]=255&i;0<=--I&&(B*=256);)0>i&&z===0&&this[c+I+1]!==0&&(z=1),this[c+I]=255&(i/B>>0)-z;return c+d},l.prototype.writeInt8=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,1,127,-128),0>i&&(i=255+i+1),this[c]=255&i,c+1},l.prototype.writeInt16LE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,2,32767,-32768),this[c]=255&i,this[c+1]=i>>>8,c+2},l.prototype.writeInt16BE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,2,32767,-32768),this[c]=i>>>8,this[c+1]=255&i,c+2},l.prototype.writeInt32LE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,4,2147483647,-2147483648),this[c]=255&i,this[c+1]=i>>>8,this[c+2]=i>>>16,this[c+3]=i>>>24,c+4},l.prototype.writeInt32BE=function(i,c,d){return i=+i,c>>>=0,d||nt(this,i,c,4,2147483647,-2147483648),0>i&&(i=4294967295+i+1),this[c]=i>>>24,this[c+1]=i>>>16,this[c+2]=i>>>8,this[c+3]=255&i,c+4},l.prototype.writeFloatLE=function(i,c,d){return Ft(this,i,c,!0,d)},l.prototype.writeFloatBE=function(i,c,d){return Ft(this,i,c,!1,d)},l.prototype.writeDoubleLE=function(i,c,d){return ae(this,i,c,!0,d)},l.prototype.writeDoubleBE=function(i,c,d){return ae(this,i,c,!1,d)},l.prototype.copy=function(i,c,d,b){if(!l.isBuffer(i))throw new TypeError("argument should be a Buffer");if(d||(d=0),b||b===0||(b=this.length),c>=i.length&&(c=i.length),c||(c=0),0<b&&b<d&&(b=d),b===d||i.length===0||this.length===0)return 0;if(0>c)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>b)throw new RangeError("sourceEnd out of bounds");b>this.length&&(b=this.length),i.length-c<b-d&&(b=i.length-c+d);var U=b-d;if(this===i&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(c,d,b);else if(this===i&&d<c&&c<b)for(var I=U-1;0<=I;--I)i[I+c]=this[I+d];else Uint8Array.prototype.set.call(i,this.subarray(d,b),c);return U},l.prototype.fill=function(i,c,d,b){if(typeof i=="string"){if(typeof c=="string"?(b=c,c=0,d=this.length):typeof d=="string"&&(b=d,d=this.length),b!==void 0&&typeof b!="string")throw new TypeError("encoding must be a string");if(typeof b=="string"&&!l.isEncoding(b))throw new TypeError("Unknown encoding: "+b);if(i.length===1){var U=i.charCodeAt(0);(b==="utf8"&&128>U||b==="latin1")&&(i=U)}}else typeof i=="number"&&(i&=255);if(0>c||this.length<c||this.length<d)throw new RangeError("Out of range index");if(d<=c)return this;c>>>=0,d=d===void 0?this.length:d>>>0,i||(i=0);var I;if(typeof i=="number")for(I=c;I<d;++I)this[I]=i;else{var B=l.isBuffer(i)?i:l.from(i,b),z=B.length;if(z===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(I=0;I<d-c;++I)this[I+c]=B[I%z]}return this};var W=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,r("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(r,s,o){(function(a){(function(){function h(){let l;try{l=o.storage.getItem("debug")}catch{}return!l&&typeof a<"u"&&"env"in a&&(l=a.env.DEBUG),l}o.formatArgs=function(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;let u="color: "+this.color;l.splice(1,0,u,"color: inherit");let f=0,p=0;l[0].replace(/%[a-zA-Z%]/g,y=>{y==="%%"||(f++,y==="%c"&&(p=f))}),l.splice(p,0,u)},o.save=function(l){try{l?o.storage.setItem("debug",l):o.storage.removeItem("debug")}catch{}},o.load=h,o.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},o.storage=(function(){try{return localStorage}catch{}})(),o.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),o.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],o.log=console.debug||console.log||(()=>{}),s.exports=r("./common")(o);let{formatters:g}=s.exports;g.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}).call(this)}).call(this,r("_process"))},{"./common":5,_process:12}],5:[function(r,s){s.exports=function(o){function a(l){function u(...y){if(!u.enabled)return;let w=u,S=+new Date,R=S-(f||S);w.diff=R,w.prev=f,w.curr=S,f=S,y[0]=a.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let m=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(v,C)=>{if(v==="%%")return"%";m++;let x=a.formatters[C];if(typeof x=="function"){let A=y[m];v=x.call(w,A),y.splice(m,1),m--}return v}),a.formatArgs.call(w,y),(w.log||a.log).apply(w,y)}let f,p=null;return u.namespace=l,u.useColors=a.useColors(),u.color=a.selectColor(l),u.extend=h,u.destroy=a.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:()=>p===null?a.enabled(l):p,set:y=>{p=y}}),typeof a.init=="function"&&a.init(u),u}function h(l,u){let f=a(this.namespace+(typeof u>"u"?":":u)+l);return f.log=this.log,f}function g(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(l){return l instanceof Error?l.stack||l.message:l},a.disable=function(){let l=[...a.names.map(g),...a.skips.map(g).map(u=>"-"+u)].join(",");return a.enable(""),l},a.enable=function(l){a.save(l),a.names=[],a.skips=[];let u,f=(typeof l=="string"?l:"").split(/[\s,]+/),p=f.length;for(u=0;u<p;u++)f[u]&&(l=f[u].replace(/\*/g,".*?"),l[0]==="-"?a.skips.push(new RegExp("^"+l.substr(1)+"$")):a.names.push(new RegExp("^"+l+"$")))},a.enabled=function(l){if(l[l.length-1]==="*")return!0;let u,f;for(u=0,f=a.skips.length;u<f;u++)if(a.skips[u].test(l))return!1;for(u=0,f=a.names.length;u<f;u++)if(a.names[u].test(l))return!0;return!1},a.humanize=r("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(o).forEach(l=>{a[l]=o[l]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(l){let u=0;for(let f=0;f<l.length;f++)u=(u<<5)-u+l.charCodeAt(f),u|=0;return a.colors[t(u)%a.colors.length]},a.enable(a.load()),a}},{ms:11}],6:[function(r,s){"use strict";function o(a,h){for(let g in h)Object.defineProperty(a,g,{value:h[g],enumerable:!0,configurable:!0});return a}s.exports=function(a,h,g){if(!a||typeof a=="string")throw new TypeError("Please pass an Error to err-code");g||(g={}),typeof h=="object"&&(g=h,h=""),h&&(g.code=h);try{return o(a,g)}catch{g.message=a.message,g.stack=a.stack;let u=function(){};return u.prototype=Object.create(Object.getPrototypeOf(a)),o(new u,g)}}},{}],7:[function(r,s){"use strict";function o(E){console&&console.warn&&console.warn(E)}function a(){a.init.call(this)}function h(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}function g(E){return E._maxListeners===void 0?a.defaultMaxListeners:E._maxListeners}function l(E,k,L,M){var q,H,G;if(h(L),H=E._events,H===void 0?(H=E._events=Object.create(null),E._eventsCount=0):(H.newListener!==void 0&&(E.emit("newListener",k,L.listener?L.listener:L),H=E._events),G=H[k]),G===void 0)G=H[k]=L,++E._eventsCount;else if(typeof G=="function"?G=H[k]=M?[L,G]:[G,L]:M?G.unshift(L):G.push(L),q=g(E),0<q&&G.length>q&&!G.warned){G.warned=!0;var ft=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+(k+" listeners added. Use emitter.setMaxListeners() to increase limit"));ft.name="MaxListenersExceededWarning",ft.emitter=E,ft.type=k,ft.count=G.length,o(ft)}return E}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(E,k,L){var M={fired:!1,wrapFn:void 0,target:E,type:k,listener:L},q=u.bind(M);return q.listener=L,M.wrapFn=q,q}function p(E,k,L){var M=E._events;if(M===void 0)return[];var q=M[k];return q===void 0?[]:typeof q=="function"?L?[q.listener||q]:[q]:L?R(q):w(q,q.length)}function y(E){var k=this._events;if(k!==void 0){var L=k[E];if(typeof L=="function")return 1;if(L!==void 0)return L.length}return 0}function w(E,k){for(var L=Array(k),M=0;M<k;++M)L[M]=E[M];return L}function S(E,k){for(;k+1<E.length;k++)E[k]=E[k+1];E.pop()}function R(E){for(var k=Array(E.length),L=0;L<k.length;++L)k[L]=E[L].listener||E[L];return k}function m(E,k,L){typeof E.on=="function"&&_(E,"error",k,L)}function _(E,k,L,M){if(typeof E.on=="function")M.once?E.once(k,L):E.on(k,L);else if(typeof E.addEventListener=="function")E.addEventListener(k,function q(H){M.once&&E.removeEventListener(k,q),L(H)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}var v,C=typeof Reflect=="object"?Reflect:null,x=C&&typeof C.apply=="function"?C.apply:function(E,k,L){return Function.prototype.apply.call(E,k,L)};v=C&&typeof C.ownKeys=="function"?C.ownKeys:Object.getOwnPropertySymbols?function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:function(E){return Object.getOwnPropertyNames(E)};var A=Number.isNaN||function(E){return E!==E};s.exports=a,s.exports.once=function(E,k){return new Promise(function(L,M){function q(G){E.removeListener(k,H),M(G)}function H(){typeof E.removeListener=="function"&&E.removeListener("error",q),L([].slice.call(arguments))}_(E,k,H,{once:!0}),k!=="error"&&m(E,q,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var O=10;Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return O},set:function(E){if(typeof E!="number"||0>E||A(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");O=E}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(E){if(typeof E!="number"||0>E||A(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this},a.prototype.getMaxListeners=function(){return g(this)},a.prototype.emit=function(E){for(var k=[],L=1;L<arguments.length;L++)k.push(arguments[L]);var M=E==="error",q=this._events;if(q!==void 0)M=M&&q.error===void 0;else if(!M)return!1;if(M){var H;if(0<k.length&&(H=k[0]),H instanceof Error)throw H;var G=new Error("Unhandled error."+(H?" ("+H.message+")":""));throw G.context=H,G}var ft=q[E];if(ft===void 0)return!1;if(typeof ft=="function")x(ft,this,k);else for(var At=ft.length,P=w(ft,At),L=0;L<At;++L)x(P[L],this,k);return!0},a.prototype.addListener=function(E,k){return l(this,E,k,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(E,k){return l(this,E,k,!0)},a.prototype.once=function(E,k){return h(k),this.on(E,f(this,E,k)),this},a.prototype.prependOnceListener=function(E,k){return h(k),this.prependListener(E,f(this,E,k)),this},a.prototype.removeListener=function(E,k){var L,M,q,H,G;if(h(k),M=this._events,M===void 0)return this;if(L=M[E],L===void 0)return this;if(L===k||L.listener===k)--this._eventsCount==0?this._events=Object.create(null):(delete M[E],M.removeListener&&this.emit("removeListener",E,L.listener||k));else if(typeof L!="function"){for(q=-1,H=L.length-1;0<=H;H--)if(L[H]===k||L[H].listener===k){G=L[H].listener,q=H;break}if(0>q)return this;q===0?L.shift():S(L,q),L.length===1&&(M[E]=L[0]),M.removeListener!==void 0&&this.emit("removeListener",E,G||k)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(E){var k,L,M;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[E]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete L[E]),this;if(arguments.length===0){var q,H=Object.keys(L);for(M=0;M<H.length;++M)q=H[M],q!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=L[E],typeof k=="function")this.removeListener(E,k);else if(k!==void 0)for(M=k.length-1;0<=M;M--)this.removeListener(E,k[M]);return this},a.prototype.listeners=function(E){return p(this,E,!0)},a.prototype.rawListeners=function(E){return p(this,E,!1)},a.listenerCount=function(E,k){return typeof E.listenerCount=="function"?E.listenerCount(k):y.call(E,k)},a.prototype.listenerCount=y,a.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(r,s){s.exports=function(){if(typeof globalThis>"u")return null;var o={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return o.RTCPeerConnection?o:null}},{}],9:[function(r,s,o){o.read=function(a,h,g,l,u){var f,p,y=8*u-l-1,w=(1<<y)-1,S=w>>1,R=-7,m=g?u-1:0,_=g?-1:1,v=a[h+m];for(m+=_,f=v&(1<<-R)-1,v>>=-R,R+=y;0<R;f=256*f+a[h+m],m+=_,R-=8);for(p=f&(1<<-R)-1,f>>=-R,R+=l;0<R;p=256*p+a[h+m],m+=_,R-=8);if(f===0)f=1-S;else{if(f===w)return p?NaN:(v?-1:1)*(1/0);p+=n(2,l),f-=S}return(v?-1:1)*p*n(2,f-l)},o.write=function(a,h,g,l,u,f){var p,y,w,S=Math.LN2,R=Math.log,m=8*f-u-1,_=(1<<m)-1,v=_>>1,C=u===23?n(2,-24)-n(2,-77):0,x=l?0:f-1,A=l?1:-1,O=0>h||h===0&&0>1/h?1:0;for(h=t(h),isNaN(h)||h===1/0?(y=isNaN(h)?1:0,p=_):(p=e(R(h)/S),1>h*(w=n(2,-p))&&(p--,w*=2),h+=1<=p+v?C/w:C*n(2,1-v),2<=h*w&&(p++,w/=2),p+v>=_?(y=0,p=_):1<=p+v?(y=(h*w-1)*n(2,u),p+=v):(y=h*n(2,v-1)*n(2,u),p=0));8<=u;a[g+x]=255&y,x+=A,y/=256,u-=8);for(p=p<<u|y,m+=u;0<m;a[g+x]=255&p,x+=A,p/=256,m-=8);a[g+x-A]|=128*O}},{}],10:[function(r,s){s.exports=typeof Object.create=="function"?function(o,a){a&&(o.super_=a,o.prototype=Object.create(a.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}))}:function(o,a){if(a){o.super_=a;var h=function(){};h.prototype=a.prototype,o.prototype=new h,o.prototype.constructor=o}}},{}],11:[function(r,s){var o=Math.round;function a(f){if(f+="",!(100<f.length)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var y=parseFloat(p[1]),w=(p[2]||"ms").toLowerCase();return w==="years"||w==="year"||w==="yrs"||w==="yr"||w==="y"?315576e5*y:w==="weeks"||w==="week"||w==="w"?6048e5*y:w==="days"||w==="day"||w==="d"?864e5*y:w==="hours"||w==="hour"||w==="hrs"||w==="hr"||w==="h"?36e5*y:w==="minutes"||w==="minute"||w==="mins"||w==="min"||w==="m"?6e4*y:w==="seconds"||w==="second"||w==="secs"||w==="sec"||w==="s"?1e3*y:w==="milliseconds"||w==="millisecond"||w==="msecs"||w==="msec"||w==="ms"?y:void 0}}}function h(f){var p=t(f);return 864e5<=p?o(f/864e5)+"d":36e5<=p?o(f/36e5)+"h":6e4<=p?o(f/6e4)+"m":1e3<=p?o(f/1e3)+"s":f+"ms"}function g(f){var p=t(f);return 864e5<=p?l(f,p,864e5,"day"):36e5<=p?l(f,p,36e5,"hour"):6e4<=p?l(f,p,6e4,"minute"):1e3<=p?l(f,p,1e3,"second"):f+" ms"}function l(f,p,y,w){return o(f/y)+" "+w+(p>=1.5*y?"s":"")}var u=24*(60*6e4);s.exports=function(f,p){p=p||{};var y=typeof f;if(y=="string"&&0<f.length)return a(f);if(y==="number"&&isFinite(f))return p.long?g(f):h(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],12:[function(r,s){function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function h(C){if(y===setTimeout)return setTimeout(C,0);if((y===o||!y)&&setTimeout)return y=setTimeout,setTimeout(C,0);try{return y(C,0)}catch{try{return y.call(null,C,0)}catch{return y.call(this,C,0)}}}function g(C){if(w===clearTimeout)return clearTimeout(C);if((w===a||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(C);try{return w(C)}catch{try{return w.call(null,C)}catch{return w.call(this,C)}}}function l(){_&&R&&(_=!1,R.length?m=R.concat(m):v=-1,m.length&&u())}function u(){if(!_){var C=h(l);_=!0;for(var x=m.length;x;){for(R=m,m=[];++v<x;)R&&R[v].run();v=-1,x=m.length}R=null,_=!1,g(C)}}function f(C,x){this.fun=C,this.array=x}function p(){}var y,w,S=s.exports={};(function(){try{y=typeof setTimeout=="function"?setTimeout:o}catch{y=o}try{w=typeof clearTimeout=="function"?clearTimeout:a}catch{w=a}})();var R,m=[],_=!1,v=-1;S.nextTick=function(C){var x=Array(arguments.length-1);if(1<arguments.length)for(var A=1;A<arguments.length;A++)x[A-1]=arguments[A];m.push(new f(C,x)),m.length!==1||_||h(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},S.title="browser",S.browser=!0,S.env={},S.argv=[],S.version="",S.versions={},S.on=p,S.addListener=p,S.once=p,S.off=p,S.removeListener=p,S.removeAllListeners=p,S.emit=p,S.prependListener=p,S.prependOnceListener=p,S.listeners=function(){return[]},S.binding=function(){throw new Error("process.binding is not supported")},S.cwd=function(){return"/"},S.chdir=function(){throw new Error("process.chdir is not supported")},S.umask=function(){return 0}},{}],13:[function(r,s){(function(o){(function(){let a;s.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?o:window):h=>(a||(a=Promise.resolve())).then(h).catch(g=>setTimeout(()=>{throw g},0))}).call(this)}).call(this,typeof global>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:global)},{}],14:[function(r,s){(function(o,a){(function(){"use strict";var h=r("safe-buffer").Buffer,g=a.crypto||a.msCrypto;s.exports=g&&g.getRandomValues?function(l,u){if(l>4294967295)throw new RangeError("requested too many random bytes");var f=h.allocUnsafe(l);if(0<l)if(65536<l)for(var p=0;p<l;p+=65536)g.getRandomValues(f.slice(p,p+65536));else g.getRandomValues(f);return typeof u=="function"?o.nextTick(function(){u(null,f)}):f}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,r("_process"),typeof global>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:global)},{_process:12,"safe-buffer":30}],15:[function(r,s){"use strict";function o(p,y){p.prototype=Object.create(y.prototype),p.prototype.constructor=p,p.__proto__=y}function a(p,y,w){function S(m,_,v){return typeof y=="string"?y:y(m,_,v)}w||(w=Error);var R=(function(m){function _(v,C,x){return m.call(this,S(v,C,x))||this}return o(_,m),_})(w);R.prototype.name=w.name,R.prototype.code=p,f[p]=R}function h(p,y){if(Array.isArray(p)){var w=p.length;return p=p.map(function(S){return S+""}),2<w?"one of ".concat(y," ").concat(p.slice(0,w-1).join(", "),", or ")+p[w-1]:w===2?"one of ".concat(y," ").concat(p[0]," or ").concat(p[1]):"of ".concat(y," ").concat(p[0])}return"of ".concat(y," ").concat(p+"")}function g(p,y,w){return p.substr(!w||0>w?0:+w,y.length)===y}function l(p,y,w){return(w===void 0||w>p.length)&&(w=p.length),p.substring(w-y.length,w)===y}function u(p,y,w){return typeof w!="number"&&(w=0),!(w+y.length>p.length)&&p.indexOf(y,w)!==-1}var f={};a("ERR_INVALID_OPT_VALUE",function(p,y){return'The value "'+y+'" is invalid for option "'+p+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(p,y,w){var S;typeof y=="string"&&g(y,"not ")?(S="must not be",y=y.replace(/^not /,"")):S="must be";var R;if(l(p," argument"))R="The ".concat(p," ").concat(S," ").concat(h(y,"type"));else{var m=u(p,".")?"property":"argument";R='The "'.concat(p,'" ').concat(m," ").concat(S," ").concat(h(y,"type"))}return R+=". Received type ".concat(typeof w),R},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(p){return"The "+p+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(p){return"Cannot call "+p+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(p){return"Unknown encoding: "+p},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),s.exports.codes=f},{}],16:[function(r,s){(function(o){(function(){"use strict";function a(S){return this instanceof a?(u.call(this,S),f.call(this,S),this.allowHalfOpen=!0,void(S&&(S.readable===!1&&(this.readable=!1),S.writable===!1&&(this.writable=!1),S.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",h))))):new a(S)}function h(){this._writableState.ended||o.nextTick(g,this)}function g(S){S.end()}var l=Object.keys||function(S){var R=[];for(var m in S)R.push(m);return R};s.exports=a;var u=r("./_stream_readable"),f=r("./_stream_writable");r("inherits")(a,u);for(var p,y=l(f.prototype),w=0;w<y.length;w++)p=y[w],a.prototype[p]||(a.prototype[p]=f.prototype[p]);Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(S){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=S,this._writableState.destroyed=S)}})}).call(this)}).call(this,r("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(r,s){"use strict";function o(h){return this instanceof o?void a.call(this,h):new o(h)}s.exports=o;var a=r("./_stream_transform");r("inherits")(o,a),o.prototype._transform=function(h,g,l){l(null,h)}},{"./_stream_transform":19,inherits:10}],18:[function(r,s){(function(o,a){(function(){"use strict";function h(i){return et.from(i)}function g(i){return et.isBuffer(i)||i instanceof nt}function l(i,c,d){return typeof i.prependListener=="function"?i.prependListener(c,d):void(i._events&&i._events[c]?Array.isArray(i._events[c])?i._events[c].unshift(d):i._events[c]=[d,i._events[c]]:i.on(c,d))}function u(i,c,d){At=At||r("./_stream_duplex"),i=i||{},typeof d!="boolean"&&(d=c instanceof At),this.objectMode=!!i.objectMode,d&&(this.objectMode=this.objectMode||!!i.readableObjectMode),this.highWaterMark=Dn(this,i,"readableHighWaterMark",d),this.buffer=new Rn,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=i.emitClose!==!1,this.autoDestroy=!!i.autoDestroy,this.destroyed=!1,this.defaultEncoding=i.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,i.encoding&&(!Ft&&(Ft=r("string_decoder/").StringDecoder),this.decoder=new Ft(i.encoding),this.encoding=i.encoding)}function f(i){if(At=At||r("./_stream_duplex"),!(this instanceof f))return new f(i);var c=this instanceof At;this._readableState=new u(i,this,c),this.readable=!0,i&&(typeof i.read=="function"&&(this._read=i.read),typeof i.destroy=="function"&&(this._destroy=i.destroy)),Jt.call(this)}function p(i,c,d,b,U){P("readableAddChunk",c);var I=i._readableState;if(c===null)I.reading=!1,m(i,I);else{var B;if(U||(B=w(I,c)),B)F(i,B);else if(!(I.objectMode||c&&0<c.length))b||(I.reading=!1,C(i,I));else if(typeof c=="string"||I.objectMode||Object.getPrototypeOf(c)===et.prototype||(c=h(c)),b)I.endEmitted?F(i,new N):y(i,I,c,!0);else if(I.ended)F(i,new T);else{if(I.destroyed)return!1;I.reading=!1,I.decoder&&!d?(c=I.decoder.write(c),I.objectMode||c.length!==0?y(i,I,c,!1):C(i,I)):y(i,I,c,!1)}}return!I.ended&&(I.length<I.highWaterMark||I.length===0)}function y(i,c,d,b){c.flowing&&c.length===0&&!c.sync?(c.awaitDrain=0,i.emit("data",d)):(c.length+=c.objectMode?1:d.length,b?c.buffer.unshift(d):c.buffer.push(d),c.needReadable&&_(i)),C(i,c)}function w(i,c){var d;return g(c)||typeof c=="string"||c===void 0||i.objectMode||(d=new jt("chunk",["string","Buffer","Uint8Array"],c)),d}function S(i){return 1073741824<=i?i=1073741824:(i--,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i++),i}function R(i,c){return 0>=i||c.length===0&&c.ended?0:c.objectMode?1:i===i?(i>c.highWaterMark&&(c.highWaterMark=S(i)),i<=c.length?i:c.ended?c.length:(c.needReadable=!0,0)):c.flowing&&c.length?c.buffer.head.data.length:c.length}function m(i,c){if(P("onEofChunk"),!c.ended){if(c.decoder){var d=c.decoder.end();d&&d.length&&(c.buffer.push(d),c.length+=c.objectMode?1:d.length)}c.ended=!0,c.sync?_(i):(c.needReadable=!1,!c.emittedReadable&&(c.emittedReadable=!0,v(i)))}}function _(i){var c=i._readableState;P("emitReadable",c.needReadable,c.emittedReadable),c.needReadable=!1,c.emittedReadable||(P("emitReadable",c.flowing),c.emittedReadable=!0,o.nextTick(v,i))}function v(i){var c=i._readableState;P("emitReadable_",c.destroyed,c.length,c.ended),!c.destroyed&&(c.length||c.ended)&&(i.emit("readable"),c.emittedReadable=!1),c.needReadable=!c.flowing&&!c.ended&&c.length<=c.highWaterMark,M(i)}function C(i,c){c.readingMore||(c.readingMore=!0,o.nextTick(x,i,c))}function x(i,c){for(;!c.reading&&!c.ended&&(c.length<c.highWaterMark||c.flowing&&c.length===0);){var d=c.length;if(P("maybeReadMore read 0"),i.read(0),d===c.length)break}c.readingMore=!1}function A(i){return function(){var c=i._readableState;P("pipeOnDrain",c.awaitDrain),c.awaitDrain&&c.awaitDrain--,c.awaitDrain===0&&oe(i,"data")&&(c.flowing=!0,M(i))}}function O(i){var c=i._readableState;c.readableListening=0<i.listenerCount("readable"),c.resumeScheduled&&!c.paused?c.flowing=!0:0<i.listenerCount("data")&&i.resume()}function E(i){P("readable nexttick read 0"),i.read(0)}function k(i,c){c.resumeScheduled||(c.resumeScheduled=!0,o.nextTick(L,i,c))}function L(i,c){P("resume",c.reading),c.reading||i.read(0),c.resumeScheduled=!1,i.emit("resume"),M(i),c.flowing&&!c.reading&&i.read(0)}function M(i){var c=i._readableState;for(P("flow",c.flowing);c.flowing&&i.read()!==null;);}function q(i,c){if(c.length===0)return null;var d;return c.objectMode?d=c.buffer.shift():!i||i>=c.length?(d=c.decoder?c.buffer.join(""):c.buffer.length===1?c.buffer.first():c.buffer.concat(c.length),c.buffer.clear()):d=c.buffer.consume(i,c.decoder),d}function H(i){var c=i._readableState;P("endReadable",c.endEmitted),c.endEmitted||(c.ended=!0,o.nextTick(G,c,i))}function G(i,c){if(P("endReadableNT",i.endEmitted,i.length),!i.endEmitted&&i.length===0&&(i.endEmitted=!0,c.readable=!1,c.emit("end"),i.autoDestroy)){var d=c._writableState;(!d||d.autoDestroy&&d.finished)&&c.destroy()}}function ft(i,c){for(var d=0,b=i.length;d<b;d++)if(i[d]===c)return d;return-1}s.exports=f;var At;f.ReadableState=u;var P,xr=r("events").EventEmitter,oe=function(i,c){return i.listeners(c).length},Jt=r("./internal/streams/stream"),et=r("buffer").Buffer,nt=a.Uint8Array||function(){},ce=r("util");P=ce&&ce.debuglog?ce.debuglog("stream"):function(){};var Ft,ae,Se,Rn=r("./internal/streams/buffer_list"),Xt=r("./internal/streams/destroy"),In=r("./internal/streams/state"),Dn=In.getHighWaterMark,Ut=r("../errors").codes,jt=Ut.ERR_INVALID_ARG_TYPE,T=Ut.ERR_STREAM_PUSH_AFTER_EOF,D=Ut.ERR_METHOD_NOT_IMPLEMENTED,N=Ut.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r("inherits")(f,Jt);var F=Xt.errorOrDestroy,W=["error","close","destroy","pause","resume"];Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(i){this._readableState&&(this._readableState.destroyed=i)}}),f.prototype.destroy=Xt.destroy,f.prototype._undestroy=Xt.undestroy,f.prototype._destroy=function(i,c){c(i)},f.prototype.push=function(i,c){var d,b=this._readableState;return b.objectMode?d=!0:typeof i=="string"&&(c=c||b.defaultEncoding,c!==b.encoding&&(i=et.from(i,c),c=""),d=!0),p(this,i,c,!1,d)},f.prototype.unshift=function(i){return p(this,i,null,!0,!1)},f.prototype.isPaused=function(){return this._readableState.flowing===!1},f.prototype.setEncoding=function(i){Ft||(Ft=r("string_decoder/").StringDecoder);var c=new Ft(i);this._readableState.decoder=c,this._readableState.encoding=this._readableState.decoder.encoding;for(var d=this._readableState.buffer.head,b="";d!==null;)b+=c.write(d.data),d=d.next;return this._readableState.buffer.clear(),b!==""&&this._readableState.buffer.push(b),this._readableState.length=b.length,this},f.prototype.read=function(i){P("read",i),i=parseInt(i,10);var c=this._readableState,d=i;if(i!==0&&(c.emittedReadable=!1),i===0&&c.needReadable&&((c.highWaterMark===0?0<c.length:c.length>=c.highWaterMark)||c.ended))return P("read: emitReadable",c.length,c.ended),c.length===0&&c.ended?H(this):_(this),null;if(i=R(i,c),i===0&&c.ended)return c.length===0&&H(this),null;var b=c.needReadable;P("need readable",b),(c.length===0||c.length-i<c.highWaterMark)&&(b=!0,P("length less than watermark",b)),c.ended||c.reading?(b=!1,P("reading or ended",b)):b&&(P("do read"),c.reading=!0,c.sync=!0,c.length===0&&(c.needReadable=!0),this._read(c.highWaterMark),c.sync=!1,!c.reading&&(i=R(d,c)));var U;return U=0<i?q(i,c):null,U===null?(c.needReadable=c.length<=c.highWaterMark,i=0):(c.length-=i,c.awaitDrain=0),c.length===0&&(!c.ended&&(c.needReadable=!0),d!==i&&c.ended&&H(this)),U!==null&&this.emit("data",U),U},f.prototype._read=function(){F(this,new D("_read()"))},f.prototype.pipe=function(i,c){function d(Qe,tn){P("onunpipe"),Qe===Y&&tn&&tn.hasUnpiped===!1&&(tn.hasUnpiped=!0,U())}function b(){P("onend"),i.end()}function U(){P("cleanup"),i.removeListener("close",z),i.removeListener("finish",ot),i.removeListener("drain",Ze),i.removeListener("error",B),i.removeListener("unpipe",d),Y.removeListener("end",b),Y.removeListener("end",J),Y.removeListener("data",I),so=!0,K.awaitDrain&&(!i._writableState||i._writableState.needDrain)&&Ze()}function I(Qe){P("ondata");var tn=i.write(Qe);P("dest.write",tn),tn===!1&&((K.pipesCount===1&&K.pipes===i||1<K.pipesCount&&ft(K.pipes,i)!==-1)&&!so&&(P("false write response, pause",K.awaitDrain),K.awaitDrain++),Y.pause())}function B(Qe){P("onerror",Qe),J(),i.removeListener("error",B),oe(i,"error")===0&&F(i,Qe)}function z(){i.removeListener("finish",ot),J()}function ot(){P("onfinish"),i.removeListener("close",z),J()}function J(){P("unpipe"),Y.unpipe(i)}var Y=this,K=this._readableState;switch(K.pipesCount){case 0:K.pipes=i;break;case 1:K.pipes=[K.pipes,i];break;default:K.pipes.push(i)}K.pipesCount+=1,P("pipe count=%d opts=%j",K.pipesCount,c);var Xe=(!c||c.end!==!1)&&i!==o.stdout&&i!==o.stderr,On=Xe?b:J;K.endEmitted?o.nextTick(On):Y.once("end",On),i.on("unpipe",d);var Ze=A(Y);i.on("drain",Ze);var so=!1;return Y.on("data",I),l(i,"error",B),i.once("close",z),i.once("finish",ot),i.emit("pipe",Y),K.flowing||(P("pipe resume"),Y.resume()),i},f.prototype.unpipe=function(i){var c=this._readableState,d={hasUnpiped:!1};if(c.pipesCount===0)return this;if(c.pipesCount===1)return i&&i!==c.pipes?this:(i||(i=c.pipes),c.pipes=null,c.pipesCount=0,c.flowing=!1,i&&i.emit("unpipe",this,d),this);if(!i){var b=c.pipes,U=c.pipesCount;c.pipes=null,c.pipesCount=0,c.flowing=!1;for(var I=0;I<U;I++)b[I].emit("unpipe",this,{hasUnpiped:!1});return this}var B=ft(c.pipes,i);return B===-1?this:(c.pipes.splice(B,1),c.pipesCount-=1,c.pipesCount===1&&(c.pipes=c.pipes[0]),i.emit("unpipe",this,d),this)},f.prototype.on=function(i,c){var d=Jt.prototype.on.call(this,i,c),b=this._readableState;return i==="data"?(b.readableListening=0<this.listenerCount("readable"),b.flowing!==!1&&this.resume()):i=="readable"&&!b.endEmitted&&!b.readableListening&&(b.readableListening=b.needReadable=!0,b.flowing=!1,b.emittedReadable=!1,P("on readable",b.length,b.reading),b.length?_(this):!b.reading&&o.nextTick(E,this)),d},f.prototype.addListener=f.prototype.on,f.prototype.removeListener=function(i,c){var d=Jt.prototype.removeListener.call(this,i,c);return i==="readable"&&o.nextTick(O,this),d},f.prototype.removeAllListeners=function(i){var c=Jt.prototype.removeAllListeners.apply(this,arguments);return(i==="readable"||i===void 0)&&o.nextTick(O,this),c},f.prototype.resume=function(){var i=this._readableState;return i.flowing||(P("resume"),i.flowing=!i.readableListening,k(this,i)),i.paused=!1,this},f.prototype.pause=function(){return P("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(P("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},f.prototype.wrap=function(i){var c=this,d=this._readableState,b=!1;for(var U in i.on("end",function(){if(P("wrapped end"),d.decoder&&!d.ended){var B=d.decoder.end();B&&B.length&&c.push(B)}c.push(null)}),i.on("data",function(B){if(P("wrapped data"),d.decoder&&(B=d.decoder.write(B)),!(d.objectMode&&B==null)&&(d.objectMode||B&&B.length)){var z=c.push(B);z||(b=!0,i.pause())}}),i)this[U]===void 0&&typeof i[U]=="function"&&(this[U]=(function(B){return function(){return i[B].apply(i,arguments)}})(U));for(var I=0;I<W.length;I++)i.on(W[I],this.emit.bind(this,W[I]));return this._read=function(B){P("wrapped _read",B),b&&(b=!1,i.resume())},this},typeof Symbol=="function"&&(f.prototype[Symbol.asyncIterator]=function(){return ae===void 0&&(ae=r("./internal/streams/async_iterator")),ae(this)}),Object.defineProperty(f.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(f.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(f.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(i){this._readableState&&(this._readableState.flowing=i)}}),f._fromList=q,Object.defineProperty(f.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(f.from=function(i,c){return Se===void 0&&(Se=r("./internal/streams/from")),Se(f,i,c)})}).call(this)}).call(this,r("_process"),typeof global>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:global)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(r,s){"use strict";function o(S,R){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new f);m.writechunk=null,m.writecb=null,R!=null&&this.push(R),_(S);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function a(S){return this instanceof a?(w.call(this,S),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,S&&(typeof S.transform=="function"&&(this._transform=S.transform),typeof S.flush=="function"&&(this._flush=S.flush)),void this.on("prefinish",h)):new a(S)}function h(){var S=this;typeof this._flush!="function"||this._readableState.destroyed?g(this,null,null):this._flush(function(R,m){g(S,R,m)})}function g(S,R,m){if(R)return S.emit("error",R);if(m!=null&&S.push(m),S._writableState.length)throw new y;if(S._transformState.transforming)throw new p;return S.push(null)}s.exports=a;var l=r("../errors").codes,u=l.ERR_METHOD_NOT_IMPLEMENTED,f=l.ERR_MULTIPLE_CALLBACK,p=l.ERR_TRANSFORM_ALREADY_TRANSFORMING,y=l.ERR_TRANSFORM_WITH_LENGTH_0,w=r("./_stream_duplex");r("inherits")(a,w),a.prototype.push=function(S,R){return this._transformState.needTransform=!1,w.prototype.push.call(this,S,R)},a.prototype._transform=function(S,R,m){m(new u("_transform()"))},a.prototype._write=function(S,R,m){var _=this._transformState;if(_.writecb=m,_.writechunk=S,_.writeencoding=R,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},a.prototype._read=function(){var S=this._transformState;S.writechunk===null||S.transforming?S.needTransform=!0:(S.transforming=!0,this._transform(S.writechunk,S.writeencoding,S.afterTransform))},a.prototype._destroy=function(S,R){w.prototype._destroy.call(this,S,function(m){R(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(r,s){(function(o,a){(function(){"use strict";function h(T){var D=this;this.next=null,this.entry=null,this.finish=function(){H(D,T)}}function g(T){return P.from(T)}function l(T){return P.isBuffer(T)||T instanceof xr}function u(){}function f(T,D,N){G=G||r("./_stream_duplex"),T=T||{},typeof N!="boolean"&&(N=D instanceof G),this.objectMode=!!T.objectMode,N&&(this.objectMode=this.objectMode||!!T.writableObjectMode),this.highWaterMark=et(this,T,"writableHighWaterMark",N),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var F=T.decodeStrings===!1;this.decodeStrings=!F,this.defaultEncoding=T.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(W){C(D,W)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=T.emitClose!==!1,this.autoDestroy=!!T.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new h(this)}function p(T){G=G||r("./_stream_duplex");var D=this instanceof G;return D||jt.call(p,this)?(this._writableState=new f(T,this,D),this.writable=!0,T&&(typeof T.write=="function"&&(this._write=T.write),typeof T.writev=="function"&&(this._writev=T.writev),typeof T.destroy=="function"&&(this._destroy=T.destroy),typeof T.final=="function"&&(this._final=T.final)),void At.call(this)):new p(T)}function y(T,D){var N=new In;Ut(T,N),o.nextTick(D,N)}function w(T,D,N,F){var W;return N===null?W=new Xt:typeof N!="string"&&!D.objectMode&&(W=new ce("chunk",["string","Buffer"],N)),!W||(Ut(T,W),o.nextTick(F,W),!1)}function S(T,D,N){return T.objectMode||T.decodeStrings===!1||typeof D!="string"||(D=P.from(D,N)),D}function R(T,D,N,F,W,i){if(!N){var c=S(D,F,W);F!==c&&(N=!0,W="buffer",F=c)}var d=D.objectMode?1:F.length;D.length+=d;var b=D.length<D.highWaterMark;if(b||(D.needDrain=!0),D.writing||D.corked){var U=D.lastBufferedRequest;D.lastBufferedRequest={chunk:F,encoding:W,isBuf:N,callback:i,next:null},U?U.next=D.lastBufferedRequest:D.bufferedRequest=D.lastBufferedRequest,D.bufferedRequestCount+=1}else m(T,D,!1,d,F,W,i);return b}function m(T,D,N,F,W,i,c){D.writelen=F,D.writecb=c,D.writing=!0,D.sync=!0,D.destroyed?D.onwrite(new Rn("write")):N?T._writev(W,D.onwrite):T._write(W,i,D.onwrite),D.sync=!1}function _(T,D,N,F,W){--D.pendingcb,N?(o.nextTick(W,F),o.nextTick(M,T,D),T._writableState.errorEmitted=!0,Ut(T,F)):(W(F),T._writableState.errorEmitted=!0,Ut(T,F),M(T,D))}function v(T){T.writing=!1,T.writecb=null,T.length-=T.writelen,T.writelen=0}function C(T,D){var N=T._writableState,F=N.sync,W=N.writecb;if(typeof W!="function")throw new ae;if(v(N),D)_(T,N,F,D,W);else{var i=E(N)||T.destroyed;i||N.corked||N.bufferProcessing||!N.bufferedRequest||O(T,N),F?o.nextTick(x,T,N,i,W):x(T,N,i,W)}}function x(T,D,N,F){N||A(T,D),D.pendingcb--,F(),M(T,D)}function A(T,D){D.length===0&&D.needDrain&&(D.needDrain=!1,T.emit("drain"))}function O(T,D){D.bufferProcessing=!0;var N=D.bufferedRequest;if(T._writev&&N&&N.next){var F=D.bufferedRequestCount,W=Array(F),i=D.corkedRequestsFree;i.entry=N;for(var c=0,d=!0;N;)W[c]=N,N.isBuf||(d=!1),N=N.next,c+=1;W.allBuffers=d,m(T,D,!0,D.length,W,"",i.finish),D.pendingcb++,D.lastBufferedRequest=null,i.next?(D.corkedRequestsFree=i.next,i.next=null):D.corkedRequestsFree=new h(D),D.bufferedRequestCount=0}else{for(;N;){var b=N.chunk,U=N.encoding,I=N.callback,B=D.objectMode?1:b.length;if(m(T,D,!1,B,b,U,I),N=N.next,D.bufferedRequestCount--,D.writing)break}N===null&&(D.lastBufferedRequest=null)}D.bufferedRequest=N,D.bufferProcessing=!1}function E(T){return T.ending&&T.length===0&&T.bufferedRequest===null&&!T.finished&&!T.writing}function k(T,D){T._final(function(N){D.pendingcb--,N&&Ut(T,N),D.prefinished=!0,T.emit("prefinish"),M(T,D)})}function L(T,D){D.prefinished||D.finalCalled||(typeof T._final!="function"||D.destroyed?(D.prefinished=!0,T.emit("prefinish")):(D.pendingcb++,D.finalCalled=!0,o.nextTick(k,T,D)))}function M(T,D){var N=E(D);if(N&&(L(T,D),D.pendingcb===0&&(D.finished=!0,T.emit("finish"),D.autoDestroy))){var F=T._readableState;(!F||F.autoDestroy&&F.endEmitted)&&T.destroy()}return N}function q(T,D,N){D.ending=!0,M(T,D),N&&(D.finished?o.nextTick(N):T.once("finish",N)),D.ended=!0,T.writable=!1}function H(T,D,N){var F=T.entry;for(T.entry=null;F;){var W=F.callback;D.pendingcb--,W(N),F=F.next}D.corkedRequestsFree.next=T}s.exports=p;var G;p.WritableState=f;var ft={deprecate:r("util-deprecate")},At=r("./internal/streams/stream"),P=r("buffer").Buffer,xr=a.Uint8Array||function(){},oe=r("./internal/streams/destroy"),Jt=r("./internal/streams/state"),et=Jt.getHighWaterMark,nt=r("../errors").codes,ce=nt.ERR_INVALID_ARG_TYPE,Ft=nt.ERR_METHOD_NOT_IMPLEMENTED,ae=nt.ERR_MULTIPLE_CALLBACK,Se=nt.ERR_STREAM_CANNOT_PIPE,Rn=nt.ERR_STREAM_DESTROYED,Xt=nt.ERR_STREAM_NULL_VALUES,In=nt.ERR_STREAM_WRITE_AFTER_END,Dn=nt.ERR_UNKNOWN_ENCODING,Ut=oe.errorOrDestroy;r("inherits")(p,At),f.prototype.getBuffer=function(){for(var T=this.bufferedRequest,D=[];T;)D.push(T),T=T.next;return D},(function(){try{Object.defineProperty(f.prototype,"buffer",{get:ft.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var jt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(jt=Function.prototype[Symbol.hasInstance],Object.defineProperty(p,Symbol.hasInstance,{value:function(T){return!!jt.call(this,T)||this===p&&T&&T._writableState instanceof f}})):jt=function(T){return T instanceof this},p.prototype.pipe=function(){Ut(this,new Se)},p.prototype.write=function(T,D,N){var F=this._writableState,W=!1,i=!F.objectMode&&l(T);return i&&!P.isBuffer(T)&&(T=g(T)),typeof D=="function"&&(N=D,D=null),i?D="buffer":!D&&(D=F.defaultEncoding),typeof N!="function"&&(N=u),F.ending?y(this,N):(i||w(this,F,T,N))&&(F.pendingcb++,W=R(this,F,i,T,D,N)),W},p.prototype.cork=function(){this._writableState.corked++},p.prototype.uncork=function(){var T=this._writableState;T.corked&&(T.corked--,!T.writing&&!T.corked&&!T.bufferProcessing&&T.bufferedRequest&&O(this,T))},p.prototype.setDefaultEncoding=function(T){if(typeof T=="string"&&(T=T.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((T+"").toLowerCase())))throw new Dn(T);return this._writableState.defaultEncoding=T,this},Object.defineProperty(p.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),p.prototype._write=function(T,D,N){N(new Ft("_write()"))},p.prototype._writev=null,p.prototype.end=function(T,D,N){var F=this._writableState;return typeof T=="function"?(N=T,T=null,D=null):typeof D=="function"&&(N=D,D=null),T!=null&&this.write(T,D),F.corked&&(F.corked=1,this.uncork()),F.ending||q(this,F,N),this},Object.defineProperty(p.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(T){this._writableState&&(this._writableState.destroyed=T)}}),p.prototype.destroy=oe.destroy,p.prototype._undestroy=oe.undestroy,p.prototype._destroy=function(T,D){D(T)}}).call(this)}).call(this,r("_process"),typeof global>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:global)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(r,s){(function(o){(function(){"use strict";function a(A,O,E){return O in A?Object.defineProperty(A,O,{value:E,enumerable:!0,configurable:!0,writable:!0}):A[O]=E,A}function h(A,O){return{value:A,done:O}}function g(A){var O=A[y];if(O!==null){var E=A[v].read();E!==null&&(A[m]=null,A[y]=null,A[w]=null,O(h(E,!1)))}}function l(A){o.nextTick(g,A)}function u(A,O){return function(E,k){A.then(function(){return O[R]?void E(h(void 0,!0)):void O[_](E,k)},k)}}var f,p=r("./end-of-stream"),y=Symbol("lastResolve"),w=Symbol("lastReject"),S=Symbol("error"),R=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),C=Object.getPrototypeOf(function(){}),x=Object.setPrototypeOf((f={get stream(){return this[v]},next:function(){var A=this,O=this[S];if(O!==null)return Promise.reject(O);if(this[R])return Promise.resolve(h(void 0,!0));if(this[v].destroyed)return new Promise(function(M,q){o.nextTick(function(){A[S]?q(A[S]):M(h(void 0,!0))})});var E,k=this[m];if(k)E=new Promise(u(k,this));else{var L=this[v].read();if(L!==null)return Promise.resolve(h(L,!1));E=new Promise(this[_])}return this[m]=E,E}},a(f,Symbol.asyncIterator,function(){return this}),a(f,"return",function(){var A=this;return new Promise(function(O,E){A[v].destroy(null,function(k){return k?void E(k):void O(h(void 0,!0))})})}),f),C);s.exports=function(A){var O,E=Object.create(x,(O={},a(O,v,{value:A,writable:!0}),a(O,y,{value:null,writable:!0}),a(O,w,{value:null,writable:!0}),a(O,S,{value:null,writable:!0}),a(O,R,{value:A._readableState.endEmitted,writable:!0}),a(O,_,{value:function(k,L){var M=E[v].read();M?(E[m]=null,E[y]=null,E[w]=null,k(h(M,!1))):(E[y]=k,E[w]=L)},writable:!0}),O));return E[m]=null,p(A,function(k){if(k&&k.code!=="ERR_STREAM_PREMATURE_CLOSE"){var L=E[w];return L!==null&&(E[m]=null,E[y]=null,E[w]=null,L(k)),void(E[S]=k)}var M=E[y];M!==null&&(E[m]=null,E[y]=null,E[w]=null,M(h(void 0,!0))),E[R]=!0}),A.on("readable",l.bind(null,E)),E}}).call(this)}).call(this,r("_process"))},{"./end-of-stream":24,_process:12}],22:[function(r,s){"use strict";function o(m,_){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(m);_&&(C=C.filter(function(x){return Object.getOwnPropertyDescriptor(m,x).enumerable})),v.push.apply(v,C)}return v}function a(m){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?o(Object(_),!0).forEach(function(C){h(m,C,_[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):o(Object(_)).forEach(function(C){Object.defineProperty(m,C,Object.getOwnPropertyDescriptor(_,C))});return m}function h(m,_,v){return _ in m?Object.defineProperty(m,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):m[_]=v,m}function g(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function l(m,_){for(var v,C=0;C<_.length;C++)v=_[C],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(m,v.key,v)}function u(m,_,v){return _&&l(m.prototype,_),v&&l(m,v),m}function f(m,_,v){y.prototype.copy.call(m,_,v)}var p=r("buffer"),y=p.Buffer,w=r("util"),S=w.inspect,R=S&&S.custom||"inspect";s.exports=(function(){function m(){g(this,m),this.head=null,this.tail=null,this.length=0}return u(m,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,C=""+v.data;v=v.next;)C+=_+v.data;return C}},{key:"concat",value:function(_){if(this.length===0)return y.alloc(0);for(var v=y.allocUnsafe(_>>>0),C=this.head,x=0;C;)f(C.data,v,x),x+=C.data.length,C=C.next;return v}},{key:"consume",value:function(_,v){var C;return _<this.head.data.length?(C=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?C=this.shift():C=v?this._getString(_):this._getBuffer(_),C}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,C=1,x=v.data;for(_-=x.length;v=v.next;){var A=v.data,O=_>A.length?A.length:_;if(x+=O===A.length?A:A.slice(0,_),_-=O,_===0){O===A.length?(++C,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=A.slice(O));break}++C}return this.length-=C,x}},{key:"_getBuffer",value:function(_){var v=y.allocUnsafe(_),C=this.head,x=1;for(C.data.copy(v),_-=C.data.length;C=C.next;){var A=C.data,O=_>A.length?A.length:_;if(A.copy(v,v.length-_,0,O),_-=O,_===0){O===A.length?(++x,this.head=C.next?C.next:this.tail=null):(this.head=C,C.data=A.slice(O));break}++x}return this.length-=x,v}},{key:R,value:function(_,v){return S(this,a({},v,{depth:0,customInspect:!1}))}}]),m})()},{buffer:3,util:2}],23:[function(r,s){(function(o){(function(){"use strict";function a(l,u){g(l,u),h(l)}function h(l){l._writableState&&!l._writableState.emitClose||l._readableState&&!l._readableState.emitClose||l.emit("close")}function g(l,u){l.emit("error",u)}s.exports={destroy:function(l,u){var f=this,p=this._readableState&&this._readableState.destroyed,y=this._writableState&&this._writableState.destroyed;return p||y?(u?u(l):l&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,o.nextTick(g,this,l)):o.nextTick(g,this,l)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(l||null,function(w){!u&&w?f._writableState?f._writableState.errorEmitted?o.nextTick(h,f):(f._writableState.errorEmitted=!0,o.nextTick(a,f,w)):o.nextTick(a,f,w):u?(o.nextTick(h,f),u(w)):o.nextTick(h,f)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(l,u){var f=l._readableState,p=l._writableState;f&&f.autoDestroy||p&&p.autoDestroy?l.destroy(u):l.emit("error",u)}}}).call(this)}).call(this,r("_process"))},{_process:12}],24:[function(r,s){"use strict";function o(u){var f=!1;return function(){if(!f){f=!0;for(var p=arguments.length,y=Array(p),w=0;w<p;w++)y[w]=arguments[w];u.apply(this,y)}}}function a(){}function h(u){return u.setHeader&&typeof u.abort=="function"}function g(u,f,p){if(typeof f=="function")return g(u,null,f);f||(f={}),p=o(p||a);var y=f.readable||f.readable!==!1&&u.readable,w=f.writable||f.writable!==!1&&u.writable,S=function(){u.writable||m()},R=u._writableState&&u._writableState.finished,m=function(){w=!1,R=!0,y||p.call(u)},_=u._readableState&&u._readableState.endEmitted,v=function(){y=!1,_=!0,w||p.call(u)},C=function(O){p.call(u,O)},x=function(){var O;return y&&!_?(u._readableState&&u._readableState.ended||(O=new l),p.call(u,O)):w&&!R?(u._writableState&&u._writableState.ended||(O=new l),p.call(u,O)):void 0},A=function(){u.req.on("finish",m)};return h(u)?(u.on("complete",m),u.on("abort",x),u.req?A():u.on("request",A)):w&&!u._writableState&&(u.on("end",S),u.on("close",S)),u.on("end",v),u.on("finish",m),f.error!==!1&&u.on("error",C),u.on("close",x),function(){u.removeListener("complete",m),u.removeListener("abort",x),u.removeListener("request",A),u.req&&u.req.removeListener("finish",m),u.removeListener("end",S),u.removeListener("close",S),u.removeListener("finish",m),u.removeListener("end",v),u.removeListener("error",C),u.removeListener("close",x)}}var l=r("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;s.exports=g},{"../../../errors":15}],25:[function(r,s){s.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(r,s){"use strict";function o(R){var m=!1;return function(){m||(m=!0,R.apply(void 0,arguments))}}function a(R){if(R)throw R}function h(R){return R.setHeader&&typeof R.abort=="function"}function g(R,m,_,v){v=o(v);var C=!1;R.on("close",function(){C=!0}),p===void 0&&(p=r("./end-of-stream")),p(R,{readable:m,writable:_},function(A){return A?v(A):(C=!0,void v())});var x=!1;return function(A){if(!C)return x?void 0:(x=!0,h(R)?R.abort():typeof R.destroy=="function"?R.destroy():void v(A||new S("pipe")))}}function l(R){R()}function u(R,m){return R.pipe(m)}function f(R){return R.length&&typeof R[R.length-1]=="function"?R.pop():a}var p,y=r("../../../errors").codes,w=y.ERR_MISSING_ARGS,S=y.ERR_STREAM_DESTROYED;s.exports=function(){for(var R=arguments.length,m=Array(R),_=0;_<R;_++)m[_]=arguments[_];var v=f(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new w("streams");var C,x=m.map(function(A,O){var E=O<m.length-1;return g(A,E,0<O,function(k){C||(C=k),k&&x.forEach(l),E||(x.forEach(l),v(C))})});return m.reduce(u)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(r,s){"use strict";function o(h,g,l){return h.highWaterMark==null?g?h[l]:null:h.highWaterMark}var a=r("../../../errors").codes.ERR_INVALID_OPT_VALUE;s.exports={getHighWaterMark:function(h,g,l,u){var f=o(g,u,l);if(f!=null){if(!(isFinite(f)&&e(f)===f)||0>f){var p=u?l:"highWaterMark";throw new a(p,f)}return e(f)}return h.objectMode?16:16384}}},{"../../../errors":15}],28:[function(r,s){s.exports=r("events").EventEmitter},{events:7}],29:[function(r,s,o){o=s.exports=r("./lib/_stream_readable.js"),o.Stream=o,o.Readable=o,o.Writable=r("./lib/_stream_writable.js"),o.Duplex=r("./lib/_stream_duplex.js"),o.Transform=r("./lib/_stream_transform.js"),o.PassThrough=r("./lib/_stream_passthrough.js"),o.finished=r("./lib/internal/streams/end-of-stream.js"),o.pipeline=r("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(r,s,o){function a(u,f){for(var p in u)f[p]=u[p]}function h(u,f,p){return l(u,f,p)}var g=r("buffer"),l=g.Buffer;l.from&&l.alloc&&l.allocUnsafe&&l.allocUnsafeSlow?s.exports=g:(a(g,o),o.Buffer=h),h.prototype=Object.create(l.prototype),a(l,h),h.from=function(u,f,p){if(typeof u=="number")throw new TypeError("Argument must not be a number");return l(u,f,p)},h.alloc=function(u,f,p){if(typeof u!="number")throw new TypeError("Argument must be a number");var y=l(u);return f===void 0?y.fill(0):typeof p=="string"?y.fill(f,p):y.fill(f),y},h.allocUnsafe=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return l(u)},h.allocUnsafeSlow=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return g.SlowBuffer(u)}},{buffer:3}],31:[function(r,s,o){"use strict";function a(x){if(!x)return"utf8";for(var A;;)switch(x){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return x;default:if(A)return;x=(""+x).toLowerCase(),A=!0}}function h(x){var A=a(x);if(typeof A!="string"&&(v.isEncoding===C||!C(x)))throw new Error("Unknown encoding: "+x);return A||x}function g(x){this.encoding=h(x);var A;switch(this.encoding){case"utf16le":this.text=y,this.end=w,A=4;break;case"utf8":this.fillLast=p,A=4;break;case"base64":this.text=S,this.end=R,A=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(A)}function l(x){return 127>=x?0:x>>5==6?2:x>>4==14?3:x>>3==30?4:x>>6==2?-1:-2}function u(x,A,O){var E=A.length-1;if(E<O)return 0;var k=l(A[E]);return 0<=k?(0<k&&(x.lastNeed=k-1),k):--E<O||k===-2?0:(k=l(A[E]),0<=k?(0<k&&(x.lastNeed=k-2),k):--E<O||k===-2?0:(k=l(A[E]),0<=k?(0<k&&(k===2?k=0:x.lastNeed=k-3),k):0))}function f(x,A){if((192&A[0])!=128)return x.lastNeed=0,"\uFFFD";if(1<x.lastNeed&&1<A.length){if((192&A[1])!=128)return x.lastNeed=1,"\uFFFD";if(2<x.lastNeed&&2<A.length&&(192&A[2])!=128)return x.lastNeed=2,"\uFFFD"}}function p(x){var A=this.lastTotal-this.lastNeed,O=f(this,x,A);return O===void 0?this.lastNeed<=x.length?(x.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(x.copy(this.lastChar,A,0,x.length),void(this.lastNeed-=x.length)):O}function y(x,A){if((x.length-A)%2==0){var O=x.toString("utf16le",A);if(O){var E=O.charCodeAt(O.length-1);if(55296<=E&&56319>=E)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=x[x.length-2],this.lastChar[1]=x[x.length-1],O.slice(0,-1)}return O}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=x[x.length-1],x.toString("utf16le",A,x.length-1)}function w(x){var A=x&&x.length?this.write(x):"";if(this.lastNeed){var O=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,O)}return A}function S(x,A){var O=(x.length-A)%3;return O==0?x.toString("base64",A):(this.lastNeed=3-O,this.lastTotal=3,O==1?this.lastChar[0]=x[x.length-1]:(this.lastChar[0]=x[x.length-2],this.lastChar[1]=x[x.length-1]),x.toString("base64",A,x.length-O))}function R(x){var A=x&&x.length?this.write(x):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function m(x){return x.toString(this.encoding)}function _(x){return x&&x.length?this.write(x):""}var v=r("safe-buffer").Buffer,C=v.isEncoding||function(x){switch(x=""+x,x&&x.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};o.StringDecoder=g,g.prototype.write=function(x){if(x.length===0)return"";var A,O;if(this.lastNeed){if(A=this.fillLast(x),A===void 0)return"";O=this.lastNeed,this.lastNeed=0}else O=0;return O<x.length?A?A+this.text(x,O):this.text(x,O):A||""},g.prototype.end=function(x){var A=x&&x.length?this.write(x):"";return this.lastNeed?A+"\uFFFD":A},g.prototype.text=function(x,A){var O=u(this,x,A);if(!this.lastNeed)return x.toString("utf8",A);this.lastTotal=O;var E=x.length-(O-this.lastNeed);return x.copy(this.lastChar,0,E),x.toString("utf8",A,E)},g.prototype.fillLast=function(x){return this.lastNeed<=x.length?(x.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(x.copy(this.lastChar,this.lastTotal-this.lastNeed,0,x.length),void(this.lastNeed-=x.length))}},{"safe-buffer":30}],32:[function(r,s){(function(o){(function(){function a(h){try{if(!o.localStorage)return!1}catch{return!1}var g=o.localStorage[h];return g!=null&&(g+"").toLowerCase()==="true"}s.exports=function(h,g){function l(){if(!u){if(a("throwDeprecation"))throw new Error(g);a("traceDeprecation")?console.trace(g):console.warn(g),u=!0}return h.apply(this,arguments)}if(a("noDeprecation"))return h;var u=!1;return l}}).call(this)}).call(this,typeof global>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:global)},{}],"/":[function(r,s){function o(R){return R.replace(/a=ice-options:trickle\s\n/g,"")}function a(R){console.warn(R)}let h=r("debug")("simple-peer"),g=r("get-browser-rtc"),l=r("randombytes"),u=r("readable-stream"),f=r("queue-microtask"),p=r("err-code"),{Buffer:y}=r("buffer"),w=65536;class S extends u.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=l(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||l(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||S.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},S.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:g(),!this._wrtc)throw p(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(p(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(p(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(p(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(p(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){let _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?a("Ignoring unsupported ICE candidate."):this.destroy(p(v,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(v){this.destroy(p(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");let v=this._senderMap.get(m)||new Map,C=v.get(_);if(!C)C=this._pc.addTrack(m,_),v.set(_,C),this._senderMap.set(m,v),this._needsNegotiation();else throw C.removed?p(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):p(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,v){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");let C=this._senderMap.get(m),x=C?C.get(v):null;if(!x)throw p(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,C),x.replaceTrack==null?this.destroy(p(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):x.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");let v=this._senderMap.get(m),C=v?v.get(_):null;if(!C)throw p(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{C.removed=!0,this._pc.removeTrack(C)}catch(x){x.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(C):this.destroy(p(x,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,f(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),f(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(p(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=w),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{let C=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(p(C,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,v){if(this.destroyed)return v(p(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(C){return this.destroy(p(C,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>w?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=m,this._cb=v}_onFinish(){if(!this.destroyed){let m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=o(m.sdp)),m.sdp=this.sdpTransform(m.sdp);let _=()=>{if(!this.destroyed){let v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(p(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(p(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=o(m.sdp)),m.sdp=this.sdpTransform(m.sdp);let _=()=>{if(!this.destroyed){let v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(p(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(p(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(p(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;let m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(p(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(p(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){let _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(C=>{Object.assign(v,C)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{let C=[];v.forEach(x=>{C.push(_(x))}),m(null,C)},v=>m(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;let C=[];v.result().forEach(x=>{let A={};x.names().forEach(O=>{A[O]=x.stat(O)}),A.id=x.id,A.type=x.type,A.timestamp=x.timestamp,C.push(_(A))}),m(null,C)},v=>m(v)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;let m=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);let C={},x={},A={},O=!1;v.forEach(k=>{(k.type==="remotecandidate"||k.type==="remote-candidate")&&(C[k.id]=k),(k.type==="localcandidate"||k.type==="local-candidate")&&(x[k.id]=k),(k.type==="candidatepair"||k.type==="candidate-pair")&&(A[k.id]=k)});let E=k=>{O=!0;let L=x[k.localCandidateId];L&&(L.ip||L.address)?(this.localAddress=L.ip||L.address,this.localPort=+L.port):L&&L.ipAddress?(this.localAddress=L.ipAddress,this.localPort=+L.portNumber):typeof k.googLocalAddress=="string"&&(L=k.googLocalAddress.split(":"),this.localAddress=L[0],this.localPort=+L[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let M=C[k.remoteCandidateId];M&&(M.ip||M.address)?(this.remoteAddress=M.ip||M.address,this.remotePort=+M.port):M&&M.ipAddress?(this.remoteAddress=M.ipAddress,this.remotePort=+M.portNumber):typeof k.googRemoteAddress=="string"&&(M=k.googRemoteAddress.split(":"),this.remoteAddress=M[0],this.remotePort=+M[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(k=>{k.type==="transport"&&k.selectedCandidatePairId&&E(A[k.selectedCandidatePairId]),(k.type==="googCandidatePair"&&k.googActiveConnection==="true"||(k.type==="candidatepair"||k.type==="candidate-pair")&&k.selected)&&E(k)}),!O&&(!Object.keys(A).length||Object.keys(x).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(L){return this.destroy(p(L,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');let k=this._cb;this._cb=null,k(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>w)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=y.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);let m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),f(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){let m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],h.apply(null,m)}}S.WEBRTC_SUPPORT=!!g(),S.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},S.channelConfig={},s.exports=S},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})});var wr={};oo(wr,{AbsolutePosition:()=>ai,AbstractConnector:()=>ps,AbstractStruct:()=>En,AbstractType:()=>ht,Array:()=>$e,ContentAny:()=>xe,ContentBinary:()=>ze,ContentDeleted:()=>Sn,ContentDoc:()=>Ge,ContentEmbed:()=>se,ContentFormat:()=>ut,ContentJSON:()=>gr,ContentString:()=>qt,ContentType:()=>Vt,Doc:()=>_e,GC:()=>Ct,ID:()=>re,Item:()=>Q,Map:()=>qe,PermanentUserData:()=>ms,RelativePosition:()=>vn,Skip:()=>_t,Snapshot:()=>ar,Text:()=>xn,Transaction:()=>hi,UndoManager:()=>vs,UpdateDecoderV1:()=>It,UpdateDecoderV2:()=>Tt,UpdateEncoderV1:()=>Yt,UpdateEncoderV2:()=>Ot,XmlElement:()=>We,XmlFragment:()=>He,XmlHook:()=>pr,XmlText:()=>yi,YArrayEvent:()=>fi,YEvent:()=>Pe,YMapEvent:()=>pi,YTextEvent:()=>gi,YXmlEvent:()=>mi,applyUpdate:()=>mr,applyUpdateV2:()=>_i,cleanupYTextFormatting:()=>ha,compareIDs:()=>Be,compareRelativePositions:()=>$h,convertUpdateFormatV1ToV2:()=>lu,convertUpdateFormatV2ToV1:()=>Gc,createAbsolutePositionFromRelativePosition:()=>Ph,createDeleteSet:()=>bi,createDeleteSetFromStructStore:()=>ks,createDocFromSnapshot:()=>Yh,createID:()=>$,createRelativePositionFromJSON:()=>Oh,createRelativePositionFromTypeIndex:()=>Nh,createSnapshot:()=>Os,decodeRelativePosition:()=>Fh,decodeSnapshot:()=>Wh,decodeSnapshotV2:()=>Lc,decodeStateVector:()=>Us,decodeUpdate:()=>nu,decodeUpdateV2:()=>Pc,diffUpdate:()=>ou,diffUpdateV2:()=>Ls,emptySnapshot:()=>zh,encodeRelativePosition:()=>Mh,encodeSnapshot:()=>Hh,encodeSnapshotV2:()=>Oc,encodeStateAsUpdate:()=>Cn,encodeStateAsUpdateV2:()=>Rc,encodeStateVector:()=>Is,encodeStateVectorFromUpdate:()=>ru,encodeStateVectorFromUpdateV2:()=>qc,equalDeleteSets:()=>Ac,equalSnapshots:()=>qh,findIndexSS:()=>Mt,findRootTypeKey:()=>Ds,getItem:()=>Me,getItemCleanEnd:()=>bs,getItemCleanStart:()=>St,getState:()=>st,getTypeChildren:()=>fu,isDeleted:()=>Ye,isParentOf:()=>cr,iterateDeletedStructs:()=>Ve,logType:()=>Ih,logUpdate:()=>eu,logUpdateV2:()=>jc,mergeDeleteSets:()=>Fe,mergeUpdates:()=>$c,mergeUpdatesV2:()=>hr,obfuscateUpdate:()=>cu,obfuscateUpdateV2:()=>au,parseUpdateMeta:()=>iu,parseUpdateMetaV2:()=>Hc,readUpdate:()=>Th,readUpdateV2:()=>As,relativePositionToJSON:()=>Dh,snapshot:()=>Gh,snapshotContainsUpdate:()=>Jh,transact:()=>Z,tryGc:()=>Qh,typeListToArraySnapshot:()=>pu,typeMapGetAllSnapshot:()=>sa,typeMapGetSnapshot:()=>yu});var ct=()=>new Map,Er=e=>{let t=ct();return e.forEach((n,r)=>{t.set(r,n)}),t},at=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},co=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},ao=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var Nt=()=>new Set;var Cr=e=>e[e.length-1];var lo=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Pt=Array.from,kr=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},Nn=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1};var ho=(e,t)=>{let n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n};var Zt=Array.isArray;var le=class{constructor(){this._observers=ct()}on(t,n){return at(this._observers,t,Nt).add(n),n}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Pt((this._observers.get(t)||ct()).values()).forEach(r=>r(...n))}destroy(){this._observers=ct()}},he=class{constructor(){this._observers=ct()}on(t,n){at(this._observers,t,Nt).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Pt((this._observers.get(t)||ct()).values()).forEach(r=>r(...n))}destroy(){this._observers=ct()}};var pt=Math.floor;var ke=Math.abs;var uo=Math.log10;var en=(e,t)=>e<t?e:t,Qt=(e,t)=>e>t?e:t,gd=Number.isNaN;var Tr=e=>e!==0?e<0:1/e<0;var nn=Number.MAX_SAFE_INTEGER,Bi=Number.MIN_SAFE_INTEGER,md=1<<31;var fo=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&pt(e)===e),yd=Number.isNaN,wd=Number.parseInt;var Mn=String.fromCharCode,nl=String.fromCodePoint,bd=Mn(65535),rl=e=>e.toLowerCase(),il=/^\s*/g,sl=e=>e.replace(il,""),ol=/([A-Z])/g,Vi=(e,t)=>sl(e.replace(ol,n=>`${t}${rl(n)}`));var cl=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},sn=typeof TextEncoder<"u"?new TextEncoder:null,al=e=>sn.encode(e),Vn=sn?al:cl;var rn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});rn&&rn.decode(new Uint8Array).length===1&&(rn=null);var Ar=(e,t)=>ho(t,()=>e).join("");var Ae=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},rt=()=>new Ae;var ll=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t};var X=e=>{let t=new Uint8Array(ll(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},hl=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Qt(n,t)*2),e.cpos=0)},yt=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var te=yt;var V=(e,t)=>{for(;t>127;)yt(e,128|127&t),t=pt(t/128);yt(e,127&t)},jn=(e,t)=>{let n=Tr(t);for(n&&(t=-t),yt(e,(t>63?128:0)|(n?64:0)|63&t),t=pt(t/64);t>0;)yt(e,(t>127?128:0)|127&t),t=pt(t/128)},Fi=new Uint8Array(3e4),ul=Fi.length/3,dl=(e,t)=>{if(t.length<ul){let n=sn.encodeInto(t,Fi).written||0;V(e,n);for(let r=0;r<n;r++)yt(e,Fi[r])}else tt(e,Vn(t))},fl=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;V(e,r);for(let s=0;s<r;s++)yt(e,n.codePointAt(s))},xt=sn&&sn.encodeInto?dl:fl;var wo=(e,t)=>an(e,X(t)),an=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=en(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Qt(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},tt=(e,t)=>{V(e,t.byteLength),an(e,t)},ji=(e,t)=>{hl(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},pl=(e,t)=>ji(e,4).setFloat32(0,t,!1),gl=(e,t)=>ji(e,8).setFloat64(0,t,!1),ml=(e,t)=>ji(e,8).setBigInt64(0,t,!1);var go=new DataView(new ArrayBuffer(4)),yl=e=>(go.setFloat32(0,e),go.getFloat32(0)===e),de=(e,t)=>{switch(typeof t){case"string":yt(e,119),xt(e,t);break;case"number":fo(t)&&ke(t)<=2147483647?(yt(e,125),jn(e,t)):yl(t)?(yt(e,124),pl(e,t)):(yt(e,123),gl(e,t));break;case"bigint":yt(e,122),ml(e,t);break;case"object":if(t===null)yt(e,126);else if(Zt(t)){yt(e,117),V(e,t.length);for(let n=0;n<t.length;n++)de(e,t[n])}else if(t instanceof Uint8Array)yt(e,116),tt(e,t);else{yt(e,118);let n=Object.keys(t);V(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];xt(e,s),de(e,t[s])}}break;case"boolean":yt(e,t?120:121);break;default:yt(e,127)}},Fn=class extends Ae{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&V(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var mo=e=>{e.count>0&&(jn(e.encoder,e.count===1?e.s:-e.s),e.count>1&&V(e.encoder,e.count-2))},Ue=class{constructor(){this.encoder=new Ae,this.s=0,this.count=0}write(t){this.s===t?this.count++:(mo(this),this.count=1,this.s=t)}toUint8Array(){return mo(this),X(this.encoder)}};var yo=e=>{if(e.count>0){let t=e.diff*2+(e.count===1?0:1);jn(e.encoder,t),e.count>1&&V(e.encoder,e.count-2)}},cn=class{constructor(){this.encoder=new Ae,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(yo(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return yo(this),X(this.encoder)}},Ur=class{constructor(){this.sarr=[],this.s="",this.lensE=new Ue}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new Ae;return this.sarr.push(this.s),this.s="",xt(t,this.sarr.join("")),an(t,this.lensE.toUint8Array()),X(t)}};var gt=e=>new Error(e),Dt=()=>{throw gt("Method unimplemented")},wt=()=>{throw gt("Unexpected case")};var bo=gt("Unexpected end of array"),_o=gt("Integer out of Range"),hn=class{constructor(t){this.arr=t,this.pos=0}},it=e=>new hn(e),Pi=e=>e.pos!==e.arr.length;var wl=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},lt=e=>wl(e,j(e));var ee=e=>e.arr[e.pos++];var j=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&127)*n,n*=128,s<128)return t;if(t>nn)throw _o}throw bo},qn=e=>{let t=e.arr[e.pos++],n=t&63,r=64,s=(t&64)>0?-1:1;if((t&128)===0)return s*n;let o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&127)*r,r*=128,t<128)return s*n;if(n>nn)throw _o}throw bo};var bl=e=>{let t=j(e);if(t===0)return"";{let n=String.fromCodePoint(ee(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ee(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},_l=e=>rn.decode(lt(e)),kt=rn?_l:bl;var $i=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},vl=e=>$i(e,4).getFloat32(0,!1),xl=e=>$i(e,8).getFloat64(0,!1),El=e=>$i(e,8).getBigInt64(0,!1);var Sl=[e=>{},e=>null,qn,vl,xl,El,e=>!1,e=>!0,kt,e=>{let t=j(e),n={};for(let r=0;r<t;r++){let s=kt(e);n[s]=pe(e)}return n},e=>{let t=j(e),n=[];for(let r=0;r<t;r++)n.push(pe(e));return n},lt],pe=e=>Sl[127-ee(e)](e),$n=class extends hn{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Pi(this)?this.count=j(this)+1:this.count=-1),this.count--,this.s}};var Re=class extends hn{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=qn(this);let t=Tr(this.s);this.count=1,t&&(this.s=-this.s,this.count=j(this)+2)}return this.count--,this.s}};var un=class extends hn{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=qn(this),n=t&1;this.diff=pt(t/2),this.count=1,n&&(this.count=j(this)+2)}return this.s+=this.diff,this.count--,this.s}},Rr=class{constructor(t){this.decoder=new Re(t),this.str=kt(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var xd=crypto.subtle,vo=crypto.getRandomValues.bind(crypto);var xo=Math.random,qi=()=>vo(new Uint32Array(1))[0];var Cl="10000000-1000-4000-8000"+-1e11,Ir=()=>Cl.replace(/[018]/g,e=>(e^qi()&15>>e/4).toString(16));var Rt=Date.now;var ne=e=>new Promise(e);var kl=Promise.all.bind(Promise),So=e=>Promise.reject(e),Wn=e=>Promise.resolve(e);var Hi=e=>e===void 0?null:e;var Wi=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},Co=new Wi,zi=!0;try{typeof localStorage<"u"&&localStorage&&(Co=localStorage,zi=!1)}catch{}var Or=Co,ko=e=>zi||addEventListener("storage",e),To=e=>zi||removeEventListener("storage",e);var Ie=Symbol("Equality"),Lr=(e,t)=>e===t||!!e?.[Ie]?.(t)||!1;var Uo=e=>typeof e=="object",Ro=Object.assign,Al=Object.keys;var Io=(e,t)=>{for(let n in e)t(e[n],n)};var Gn=e=>Al(e).length;var Do=e=>{for(let t in e)return!1;return!0},dn=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},Yn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Yi=(e,t)=>e===t||Gn(e)===Gn(t)&&dn(e,(n,r)=>(n!==void 0||Yn(t,r))&&Lr(t[r],n)),Ul=Object.freeze,Ki=e=>{for(let t in e){let n=e[t];(typeof n=="object"||typeof n=="function")&&Ki(e[t])}return Ul(e)};var Kn=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Kn(e,t,n+1)}},Oo=()=>{};var Xi=e=>e;var ge=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[Ie]!=null)return e[Ie](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!ge(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(Gn(e)!==Gn(t))return!1;for(let n in e)if(!Yn(e,n)||!ge(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!ge(e[n],t[n]))return!1;break;default:return!1}return!0},Lo=(e,t)=>t.includes(e);var fn=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Nr=typeof window<"u"&&typeof document<"u"&&!fn,Cd=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,Ht,Rl=[],Il=()=>{if(Ht===void 0)if(fn){Ht=ct();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&Ht.set(t,""),t=r):t!==null?(Ht.set(t,r),t=null):Rl.push(r)}t!==null&&Ht.set(t,"")}else typeof location=="object"?(Ht=ct(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");Ht.set(`--${Vi(t,"-")}`,n),Ht.set(`-${Vi(t,"-")}`,n)}})):Ht=ct();return Ht},Zi=e=>Il().has(e);var De=e=>fn?Hi(process.env[e.toUpperCase().replaceAll("-","_")]):Hi(Or.getItem(e));var No=e=>Zi("--"+e)||De(e)!==null,Bo=No("production"),Dl=fn&&Lo(process.env.FORCE_COLOR,["true","1","2"]),Mo=Dl||!Zi("--no-colors")&&!No("no-color")&&(!fn||process.stdout.isTTY)&&(!fn||Zi("--color")||De("COLORTERM")!==null||(De("TERM")||"").includes("color"));var Vo=e=>new Uint8Array(e),Ol=(e,t,n)=>new Uint8Array(e,t,n),Fo=e=>new Uint8Array(e),Ll=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Mn(e[n]);return btoa(t)},Nl=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Bl=e=>{let t=atob(e),n=Vo(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},Ml=e=>{let t=Buffer.from(e,"base64");return Ol(t.buffer,t.byteOffset,t.byteLength)},Br=Nr?Ll:Nl,Mr=Nr?Bl:Ml;var jo=e=>{let t=Vo(e.byteLength);return t.set(e),t};var ts=class{constructor(t,n){this.left=t,this.right=n}},Wt=(e,t)=>new ts(e,t);var es=e=>e.next()>=.5,Vr=(e,t,n)=>pt(e.next()*(n+1-t)+t);var ns=(e,t,n)=>pt(e.next()*(n+1-t)+t);var rs=(e,t,n)=>ns(e,t,n);var Fl=e=>Mn(rs(e,97,122)),Po=(e,t=0,n=20)=>{let r=rs(e,t,n),s="";for(let o=0;o<r;o++)s+=Fl(e);return s};var Fr=(e,t)=>t[rs(e,0,t.length-1)];var Pl=Symbol("0schema"),is=class{constructor(){this._rerrs=[]}extend(t,n,r,s=null){this._rerrs.push({path:t,expected:n,has:r,message:s})}toString(){let t=[];for(let n=this._rerrs.length-1;n>0;n--){let r=this._rerrs[n];t.push(Ar(" ",(this._rerrs.length-n)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return t.join(`
`)}},ss=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[Ie]?Lr(e,t):Zt(e)?kr(e,n=>Nn(t,r=>ss(n,r))):Uo(e)?dn(e,(n,r)=>ss(n,t[r])):!1,bt=class{static _dilutes=!1;extends(t){let[n,r]=[this.shape,t.shape];return this.constructor._dilutes&&([r,n]=[n,r]),ss(n,r)}equals(t){return this.constructor===t.constructor&&ge(this.shape,t.shape)}[Pl](){return!0}[Ie](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){Dt()}get nullable(){return wn(this,Xr)}get optional(){return new jr(this)}cast(t){return $o(t,this),t}expect(t){return $o(t,this),t}},Zn=class extends bt{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){let r=t?.constructor===this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name,t?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}},dt=(e,t=null)=>new Zn(e,t),Td=dt(Zn),Qn=class extends bt{constructor(t){super(),this.shape=t}check(t,n){let r=this.shape(t);return!r&&n?.extend(null,"custom prop",t?.constructor.name,"failed to check custom prop"),r}},mt=e=>new Qn(e),Ad=dt(Qn),mn=class extends bt{constructor(t){super(),this.shape=t}check(t,n){let r=this.shape.some(s=>s===t);return!r&&n?.extend(null,this.shape.join(" | "),t.toString()),r}},Kr=(...e)=>new mn(e),qo=dt(mn),$l=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),Ho=e=>{if(yn.check(e))return[$l(e)];if(qo.check(e))return e.shape.map(t=>t+"");if(Ko.check(e))return["[+-]?\\d+.?\\d*"];if(Jo.check(e))return[".*"];if(Gr.check(e))return e.shape.map(Ho).flat(1);wt()},os=class extends bt{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(Ho).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){let r=this._r.exec(t)!=null;return!r&&n?.extend(null,this._r.toString(),t.toString(),"String doesn't match string template."),r}};var Ud=dt(os),ql=Symbol("optional"),jr=class extends bt{constructor(t){super(),this.shape=t}check(t,n){let r=t===void 0||this.shape.check(t);return!r&&n?.extend(null,"undefined (optional)","()"),r}get[ql](){return!0}},Hl=dt(jr),Pr=class extends bt{check(t,n){return n?.extend(null,"never",typeof t),!1}},Rd=new Pr,Id=dt(Pr),$r=class e extends bt{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}static _dilutes=!0;get partial(){return new e(this.shape,!0)}check(t,n){return t==null?(n?.extend(null,"object","null"),!1):dn(this.shape,(r,s)=>{let o=this._isPartial&&!Yn(t,s)||r.check(t[s],n);return!o&&n?.extend(s.toString(),r.toString(),typeof t[s],"Object property does not match"),o})}},Wl=e=>new $r(e),zl=dt($r),Gl=mt(e=>e!=null&&(e.constructor===Object||e.constructor==null)),qr=class extends bt{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&dn(t,(r,s)=>{let o=this.shape.keys.check(s,n);return!o&&n?.extend(s+"","Record",typeof t,o?"Key doesn't match schema":"Value doesn't match value"),o&&this.shape.values.check(r,n)})}},Wo=(e,t)=>new qr(e,t),Yl=dt(qr),Hr=class extends bt{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&dn(this.shape,(r,s)=>{let o=r.check(t[s],n);return!o&&n?.extend(s.toString(),"Tuple",typeof r),o})}},Kl=(...e)=>new Hr(e),Dd=dt(Hr),Wr=class extends bt{constructor(t){super(),this.shape=t.length===1?t[0]:new tr(t)}check(t,n){let r=Zt(t)&&kr(t,s=>this.shape.check(s));return!r&&n?.extend(null,"Array",""),r}},zo=(...e)=>new Wr(e),Jl=dt(Wr),Xl=mt(e=>Zt(e)),zr=class extends bt{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){let r=t instanceof this.shape&&(this._c==null||this._c(t));return!r&&n?.extend(null,this.shape.name,t?.constructor.name),r}},Zl=(e,t=null)=>new zr(e,t),Od=dt(zr),Ql=Zl(bt),cs=class extends bt{constructor(t){super(),this.len=t.length-1,this.args=Kl(...t.slice(-1)),this.res=t[this.len]}check(t,n){let r=t.constructor===Function&&t.length<=this.len;return!r&&n?.extend(null,"function",typeof t),r}};var th=dt(cs),eh=mt(e=>typeof e=="function"),as=class extends bt{constructor(t){super(),this.shape=t}check(t,n){let r=kr(this.shape,s=>s.check(t,n));return!r&&n?.extend(null,"Intersectinon",typeof t),r}};var Ld=dt(as,e=>e.shape.length>0),tr=class extends bt{static _dilutes=!0;constructor(t){super(),this.shape=t}check(t,n){let r=Nn(this.shape,s=>s.check(t,n));return n?.extend(null,"Union",typeof t),r}},wn=(...e)=>e.findIndex(t=>Gr.check(t))>=0?wn(...e.map(t=>er(t)).map(t=>Gr.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new tr(e),Gr=dt(tr),Go=()=>!0,Yr=mt(Go),nh=dt(Qn,e=>e.shape===Go),hs=mt(e=>typeof e=="bigint"),rh=mt(e=>e===hs),Yo=mt(e=>typeof e=="symbol"),Nd=mt(e=>e===Yo),gn=mt(e=>typeof e=="number"),Ko=mt(e=>e===gn),yn=mt(e=>typeof e=="string"),Jo=mt(e=>e===yn),Jr=mt(e=>typeof e=="boolean"),ih=mt(e=>e===Jr),Xo=Kr(void 0),Bd=dt(mn,e=>e.shape.length===1&&e.shape[0]===void 0),Md=Kr(void 0);var Xr=Kr(null),sh=dt(mn,e=>e.shape.length===1&&e.shape[0]===null),Vd=dt(Uint8Array),Fd=dt(Zn,e=>e.shape===Uint8Array),oh=wn(gn,yn,Xr,Xo,hs,Jr,Yo),jd=(()=>{let e=zo(Yr),t=Wo(yn,Yr),n=wn(gn,yn,Xr,Jr,e,t);return e.shape=n,t.shape.values=n,n})(),er=e=>{if(Ql.check(e))return e;if(Gl.check(e)){let t={};for(let n in e)t[n]=er(e[n]);return Wl(t)}else{if(Xl.check(e))return wn(...e.map(er));if(oh.check(e))return Kr(e);if(eh.check(e))return dt(e)}wt()},$o=Bo?()=>{}:(e,t)=>{let n=new is;if(!t.check(e,n))throw gt(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)},ls=class{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:er(t),h:n}),this}else(t){return this.if(Yr,t)}done(){return(t,n)=>{for(let r=0;r<this.patterns.length;r++){let s=this.patterns[r];if(s.if.check(t))return s.h(t,n)}throw gt("Unhandled pattern")}}},ch=e=>new ls(e),Zo=ch(Yr).if(Ko,(e,t)=>Vr(t,Bi,nn)).if(Jo,(e,t)=>Po(t)).if(ih,(e,t)=>es(t)).if(rh,(e,t)=>BigInt(Vr(t,Bi,nn))).if(Gr,(e,t)=>pn(t,Fr(t,e.shape))).if(zl,(e,t)=>{let n={};for(let r in e.shape){let s=e.shape[r];if(Hl.check(s)){if(es(t))continue;s=s.shape}n[r]=Zo(s,t)}return n}).if(Jl,(e,t)=>{let n=[],r=ns(t,0,42);for(let s=0;s<r;s++)n.push(pn(t,e.shape));return n}).if(qo,(e,t)=>Fr(t,e.shape)).if(sh,(e,t)=>null).if(th,(e,t)=>{let n=pn(t,e.res);return()=>n}).if(nh,(e,t)=>pn(t,Fr(t,[gn,yn,Xr,Xo,hs,Jr,zo(gn),Wo(wn("a","b","c"),gn)]))).if(Yl,(e,t)=>{let n={},r=Vr(t,0,3);for(let s=0;s<r;s++){let o=pn(t,e.shape.keys),a=pn(t,e.shape.values);n[o]=a}return n}).done(),pn=(e,t)=>Zo(er(t),e);var Oe=typeof document<"u"?document:{};var Pd=mt(e=>e.nodeType===dh);var $d=typeof DOMParser<"u"?new DOMParser:null;var qd=mt(e=>e.nodeType===lh);var Hd=mt(e=>e.nodeType===hh);var Qo=e=>co(e,(t,n)=>`${n}:${t};`).join("");var lh=Oe.ELEMENT_NODE,hh=Oe.TEXT_NODE,Wd=Oe.CDATA_SECTION_NODE,zd=Oe.COMMENT_NODE,uh=Oe.DOCUMENT_NODE,Gd=Oe.DOCUMENT_TYPE_NODE,dh=Oe.DOCUMENT_FRAGMENT_NODE,Yd=mt(e=>e.nodeType===uh);var tc=JSON.stringify;var zt=Symbol;var Et=zt(),$t=zt(),Zr=zt(),bn=zt(),Qr=zt(),nr=zt(),ti=zt(),Le=zt(),Ne=zt(),rc=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());let t=[],n=[],r=0;for(;r<e.length;r++){let s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){let s=e[r];s instanceof Symbol||n.push(s)}return n},ec=[Qr,ti,Le,Zr],us=0,nc=Rt(),ic=(e,t)=>{let n=ec[us],r=De("log"),s=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(t));return us=(us+1)%ec.length,t+=": ",s?(...o)=>{o.length===1&&o[0]?.constructor===Function&&(o=o[0]());let a=Rt(),h=a-nc;nc=a,e(n,t,Ne,...o.map(g=>{switch(g!=null&&g.constructor===Uint8Array&&(g=Array.from(g)),typeof g){case"string":case"symbol":return g;default:return tc(g)}}),n," +"+h+"ms")}:Oo};var yh={[Et]:Wt("font-weight","bold"),[$t]:Wt("font-weight","normal"),[Zr]:Wt("color","blue"),[Qr]:Wt("color","green"),[bn]:Wt("color","grey"),[nr]:Wt("color","red"),[ti]:Wt("color","purple"),[Le]:Wt("color","orange"),[Ne]:Wt("color","black")},wh=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());let t=[],n=[],r=ct(),s=[],o=0;for(;o<e.length;o++){let a=e[o],h=yh[a];if(h!==void 0)r.set(h.left,h.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let g=Qo(r);o>0||g.length>0?(t.push("%c"+a),n.push(g)):t.push(a)}else break}}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){let a=e[o];a instanceof Symbol||s.push(a)}return s},sc=Mo?wh:rc,rr=(...e)=>{console.log(...sc(e)),oc.forEach(t=>t.print(e))},ds=(...e)=>{console.warn(...sc(e)),e.unshift(Le),oc.forEach(t=>t.print(e))};var oc=Nt();var cc=e=>ic(rr,e);var lc=e=>({[Symbol.iterator](){return this},next:e}),hc=(e,t)=>lc(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),ei=(e,t)=>lc(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var ps=class extends le{constructor(t,n){super(),this.doc=t,this.awareness=n}},sr=class{constructor(t,n){this.clock=t,this.len=n}},be=class{constructor(){this.clients=new Map}},Ve=(e,t,n)=>t.clients.forEach((r,s)=>{let o=e.doc.store.clients.get(s);if(o!=null){let a=o[o.length-1],h=a.id.clock+a.length;for(let g=0,l=r[g];g<r.length&&l.clock<h;l=r[++g])Bc(e,o,l.clock,l.len,n)}}),xh=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=pt((n+r)/2),o=e[s],a=o.clock;if(a<=t){if(t<a+o.len)return s;n=s+1}else r=s-1}return null},Ye=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&xh(n,t.clock)!==null},Cs=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=Qt(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},Fe=e=>{let t=new be;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let o=r.slice();for(let a=n+1;a<e.length;a++)lo(o,e[a].clients.get(s)||[]);t.clients.set(s,o)}});return Cs(t),t},or=(e,t,n,r)=>{at(e.clients,t,()=>[]).push(new sr(n,r))},bi=()=>new be,ks=e=>{let t=bi();return e.clients.forEach((n,r)=>{let s=[];for(let o=0;o<n.length;o++){let a=n[o];if(a.deleted){let h=a.id.clock,g=a.length;if(o+1<n.length)for(let l=n[o+1];o+1<n.length&&l.deleted;l=n[++o+1])g+=l.length;s.push(new sr(h,g))}}s.length>0&&t.clients.set(r,s)}),t},Gt=(e,t)=>{V(e.restEncoder,t.clients.size),Pt(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),V(e.restEncoder,n);let s=r.length;V(e.restEncoder,s);for(let o=0;o<s;o++){let a=r[o];e.writeDsClock(a.clock),e.writeDsLen(a.len)}})},ie=e=>{let t=new be,n=j(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=j(e.restDecoder),o=j(e.restDecoder);if(o>0){let a=at(t.clients,s,()=>[]);for(let h=0;h<o;h++)a.push(new sr(e.readDsClock(),e.readDsLen()))}}return t},fc=(e,t,n)=>{let r=new be,s=j(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();let a=j(e.restDecoder),h=j(e.restDecoder),g=n.clients.get(a)||[],l=st(n,a);for(let u=0;u<h;u++){let f=e.readDsClock(),p=f+e.readDsLen();if(f<l){l<p&&or(r,a,l,p-l);let y=Mt(g,f),w=g[y];for(!w.deleted&&w.id.clock<f&&(g.splice(y+1,0,wi(t,w,f-w.id.clock)),y++);y<g.length&&(w=g[y++],w.id.clock<p);)w.deleted||(p<w.id.clock+w.length&&g.splice(y,0,wi(t,w,p-w.id.clock)),w.delete(t))}else or(r,a,f,p-f)}}if(r.clients.size>0){let o=new Ot;return V(o.restEncoder,0),Gt(o,r),o.toUint8Array()}return null},Ac=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(let[n,r]of e.clients.entries()){let s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let o=0;o<r.length;o++){let a=r[o],h=s[o];if(a.clock!==h.clock||a.len!==h.len)return!1}}return!0},Uc=qi,_e=class e extends le{constructor({guid:t=Ir(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:a=!1,shouldLoad:h=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Uc(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new li,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=h,this.autoLoad=a,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ne(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});let g=()=>ne(l=>{let u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=g()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=g()}load(){let t=this._item;t!==null&&!this.shouldLoad&&Z(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Pt(this.subdocs).map(t=>t.guid))}transact(t,n=null){return Z(this,t,n)}get(t,n=ht){let r=at(this.share,t,()=>{let o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==ht&&s!==n)if(s===ht){let o=new n;o._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=o}),o._start=r._start;for(let a=o._start;a!==null;a=a.right)a.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,$e)}getText(t=""){return this.get(t,xn)}getMap(t=""){return this.get(t,qe)}getXmlElement(t=""){return this.get(t,We)}getXmlFragment(t=""){return this.get(t,He)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Pt(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new e({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,Z(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},je=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return j(this.restDecoder)}readDsLen(){return j(this.restDecoder)}},It=class extends je{readLeftID(){return $(j(this.restDecoder),j(this.restDecoder))}readRightID(){return $(j(this.restDecoder),j(this.restDecoder))}readClient(){return j(this.restDecoder)}readInfo(){return ee(this.restDecoder)}readString(){return kt(this.restDecoder)}readParentInfo(){return j(this.restDecoder)===1}readTypeRef(){return j(this.restDecoder)}readLen(){return j(this.restDecoder)}readAny(){return pe(this.restDecoder)}readBuf(){return jo(lt(this.restDecoder))}readJSON(){return JSON.parse(kt(this.restDecoder))}readKey(){return kt(this.restDecoder)}},ci=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=j(this.restDecoder),this.dsCurrVal}readDsLen(){let t=j(this.restDecoder)+1;return this.dsCurrVal+=t,t}},Tt=class extends ci{constructor(t){super(t),this.keys=[],j(t),this.keyClockDecoder=new un(lt(t)),this.clientDecoder=new Re(lt(t)),this.leftClockDecoder=new un(lt(t)),this.rightClockDecoder=new un(lt(t)),this.infoDecoder=new $n(lt(t),ee),this.stringDecoder=new Rr(lt(t)),this.parentInfoDecoder=new $n(lt(t),ee),this.typeRefDecoder=new Re(lt(t)),this.lenDecoder=new Re(lt(t))}readLeftID(){return new re(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new re(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return pe(this.restDecoder)}readBuf(){return lt(this.restDecoder)}readJSON(){return pe(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},ve=class{constructor(){this.restEncoder=rt()}toUint8Array(){return X(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){V(this.restEncoder,t)}writeDsLen(t){V(this.restEncoder,t)}},Yt=class extends ve{writeLeftID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeRightID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeClient(t){V(this.restEncoder,t)}writeInfo(t){te(this.restEncoder,t)}writeString(t){xt(this.restEncoder,t)}writeParentInfo(t){V(this.restEncoder,t?1:0)}writeTypeRef(t){V(this.restEncoder,t)}writeLen(t){V(this.restEncoder,t)}writeAny(t){de(this.restEncoder,t)}writeBuf(t){tt(this.restEncoder,t)}writeJSON(t){xt(this.restEncoder,JSON.stringify(t))}writeKey(t){xt(this.restEncoder,t)}},_n=class{constructor(){this.restEncoder=rt(),this.dsCurrVal=0}toUint8Array(){return X(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,V(this.restEncoder,n)}writeDsLen(t){t===0&&wt(),V(this.restEncoder,t-1),this.dsCurrVal+=t}},Ot=class extends _n{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new cn,this.clientEncoder=new Ue,this.leftClockEncoder=new cn,this.rightClockEncoder=new cn,this.infoEncoder=new Fn(te),this.stringEncoder=new Ur,this.parentInfoEncoder=new Fn(te),this.typeRefEncoder=new Ue,this.lenEncoder=new Ue}toUint8Array(){let t=rt();return V(t,0),tt(t,this.keyClockEncoder.toUint8Array()),tt(t,this.clientEncoder.toUint8Array()),tt(t,this.leftClockEncoder.toUint8Array()),tt(t,this.rightClockEncoder.toUint8Array()),tt(t,X(this.infoEncoder)),tt(t,this.stringEncoder.toUint8Array()),tt(t,X(this.parentInfoEncoder)),tt(t,this.typeRefEncoder.toUint8Array()),tt(t,this.lenEncoder.toUint8Array()),an(t,X(this.restEncoder)),X(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){de(this.restEncoder,t)}writeBuf(t){tt(this.restEncoder,t)}writeJSON(t){de(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},Eh=(e,t,n,r)=>{r=Qt(r,t[0].id.clock);let s=Mt(t,r);V(e.restEncoder,t.length-s),e.writeClient(n),V(e.restEncoder,r);let o=t[s];o.write(e,r-o.id.clock);for(let a=s+1;a<t.length;a++)t[a].write(e,0)},Ts=(e,t,n)=>{let r=new Map;n.forEach((s,o)=>{st(t,o)>s&&r.set(o,s)}),yr(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),V(e.restEncoder,r.size),Pt(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{Eh(e,t.clients.get(s),s,o)})},Sh=(e,t)=>{let n=ct(),r=j(e.restDecoder);for(let s=0;s<r;s++){let o=j(e.restDecoder),a=new Array(o),h=e.readClient(),g=j(e.restDecoder);n.set(h,{i:0,refs:a});for(let l=0;l<o;l++){let u=e.readInfo();switch(31&u){case 0:{let f=e.readLen();a[l]=new Ct($(h,g),f),g+=f;break}case 10:{let f=j(e.restDecoder);a[l]=new _t($(h,g),f),g+=f;break}default:{let f=(u&192)===0,p=new Q($(h,g),null,(u&128)===128?e.readLeftID():null,null,(u&64)===64?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&32)===32?e.readString():null,fa(e,u));a[l]=p,g+=p.length}}}}return n},Ch=(e,t,n)=>{let r=[],s=Pt(n.keys()).sort((y,w)=>y-w);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let y=n.get(s[s.length-1]);for(;y.refs.length===y.i;)if(s.pop(),s.length>0)y=n.get(s[s.length-1]);else return null;return y},a=o();if(a===null)return null;let h=new li,g=new Map,l=(y,w)=>{let S=g.get(y);(S==null||S>w)&&g.set(y,w)},u=a.refs[a.i++],f=new Map,p=()=>{for(let y of r){let w=y.id.client,S=n.get(w);S?(S.i--,h.clients.set(w,S.refs.slice(S.i)),n.delete(w),S.i=0,S.refs=[]):h.clients.set(w,[y]),s=s.filter(R=>R!==w)}r.length=0};for(;;){if(u.constructor!==_t){let w=at(f,u.id.client,()=>st(t,u.id.client))-u.id.clock;if(w<0)r.push(u),l(u.id.client,u.id.clock-1),p();else{let S=u.getMissing(e,t);if(S!==null){r.push(u);let R=n.get(S)||{refs:[],i:0};if(R.refs.length===R.i)l(S,st(t,S)),p();else{u=R.refs[R.i++];continue}}else(w===0||w<u.length)&&(u.integrate(e,w),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=o(),a===null)break;u=a.refs[a.i++]}}if(h.clients.size>0){let y=new Ot;return Ts(y,h,new Map),V(y.restEncoder,0),{missing:g,update:y.toUint8Array()}}return null},kh=(e,t)=>Ts(e,t.doc.store,t.beforeState),As=(e,t,n,r=new Tt(e))=>Z(t,s=>{s.local=!1;let o=!1,a=s.doc,h=a.store,g=Sh(r,a),l=Ch(s,h,g),u=h.pendingStructs;if(u){for(let[p,y]of u.missing)if(y<st(h,p)){o=!0;break}if(l){for(let[p,y]of l.missing){let w=u.missing.get(p);(w==null||w>y)&&u.missing.set(p,y)}u.update=hr([u.update,l.update])}}else h.pendingStructs=l;let f=fc(r,s,h);if(h.pendingDs){let p=new Tt(it(h.pendingDs));j(p.restDecoder);let y=fc(p,s,h);f&&y?h.pendingDs=hr([f,y]):h.pendingDs=f||y}else h.pendingDs=f;if(o){let p=h.pendingStructs.update;h.pendingStructs=null,_i(s.doc,p)}},n,!1),Th=(e,t,n)=>As(e,t,n,new It(e)),_i=(e,t,n,r=Tt)=>{let s=it(t);As(s,e,n,new r(s))},mr=(e,t,n)=>_i(e,t,n,It),Ah=(e,t,n=new Map)=>{Ts(e,t.store,n),Gt(e,ks(t.store))},Rc=(e,t=new Uint8Array([0]),n=new Ot)=>{let r=Us(t);Ah(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Ls(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Yt)return $c(s.map((o,a)=>a===0?o:Gc(o)));if(n.constructor===Ot)return hr(s)}return s[0]},Cn=(e,t)=>Rc(e,t,new Yt),Ic=e=>{let t=new Map,n=j(e.restDecoder);for(let r=0;r<n;r++){let s=j(e.restDecoder),o=j(e.restDecoder);t.set(s,o)}return t},Us=e=>Ic(new je(it(e))),Rs=(e,t)=>(V(e.restEncoder,t.size),Pt(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{V(e.restEncoder,n),V(e.restEncoder,r)}),e),Uh=(e,t)=>Rs(e,yr(t.store)),Rh=(e,t=new _n)=>(e instanceof Map?Rs(t,e):Uh(t,e),t.toUint8Array()),Is=e=>Rh(e,new ve),gs=class{constructor(){this.l=[]}},pc=()=>new gs,gc=(e,t)=>e.l.push(t),mc=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Dc=(e,t,n)=>Kn(e.l,[t,n]),re=class{constructor(t,n){this.client=t,this.clock=n}},Be=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,$=(e,t)=>new re(e,t),yc=(e,t)=>{V(e,t.client),V(e,t.clock)},wc=e=>$(j(e),j(e)),Ds=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw wt()},cr=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Ih=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},ms=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(o,a)=>{let h=o.get("ds"),g=o.get("ids"),l=u=>this.clients.set(u,a);h.observe(u=>{u.changes.added.forEach(f=>{f.content.getContent().forEach(p=>{p instanceof Uint8Array&&this.dss.set(a,Fe([this.dss.get(a)||bi(),ie(new je(it(p)))]))})})}),this.dss.set(a,Fe(h.map(u=>ie(new je(it(u)))))),g.observe(u=>u.changes.added.forEach(f=>f.content.getContent().forEach(l))),g.forEach(l)};n.observe(o=>{o.keysChanged.forEach(a=>s(n.get(a),a))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let o=this.yusers,a=o.get(r);a||(a=new qe,a.set("ids",new $e),a.set("ds",new $e),o.set(r,a)),a.get("ids").push([n]),o.observe(h=>{setTimeout(()=>{let g=o.get(r);if(g!==a){a=g,this.clients.forEach((f,p)=>{r===f&&a.get("ids").push([p])});let l=new ve,u=this.dss.get(r);u&&(Gt(l,u),a.get("ds").push([l.toUint8Array()]))}},0)}),t.on("afterTransaction",h=>{setTimeout(()=>{let g=a.get("ds"),l=h.deleteSet;if(h.local&&l.clients.size>0&&s(h,l)){let u=new ve;Gt(u,l),g.push([u.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(Ye(r,t))return n;return null}},vn=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},Dh=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},Oh=e=>new vn(e.type==null?null:$(e.type.client,e.type.clock),e.tname??null,e.item==null?null:$(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),ai=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},Lh=(e,t,n=0)=>new ai(e,t,n),ni=(e,t,n)=>{let r=null,s=null;return e._item===null?s=Ds(e):r=$(e._item.id.client,e._item.id.clock),new vn(r,s,t,n)},Nh=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return ni(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return ni(e,$(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return ni(e,r.lastId,n);r=r.right}return ni(e,null,n)},Bh=(e,t)=>{let{type:n,tname:r,item:s,assoc:o}=t;if(s!==null)V(e,0),yc(e,s);else if(r!==null)te(e,1),xt(e,r);else if(n!==null)te(e,2),yc(e,n);else throw wt();return jn(e,o),e},Mh=e=>{let t=rt();return Bh(t,e),X(t)},Vh=e=>{let t=null,n=null,r=null;switch(j(e)){case 0:r=wc(e);break;case 1:n=kt(e);break;case 2:t=wc(e)}let s=Pi(e)?qn(e):0;return new vn(t,n,r,s)},Fh=e=>Vh(it(e)),jh=(e,t)=>{let n=Me(e,t),r=t.clock-n.id.clock;return{item:n,diff:r}},Ph=(e,t,n=!0)=>{let r=t.store,s=e.item,o=e.type,a=e.tname,h=e.assoc,g=null,l=0;if(s!==null){if(st(r,s.client)<=s.clock)return null;let u=n?Es(r,s):jh(r,s),f=u.item;if(!(f instanceof Q))return null;if(g=f.parent,g._item===null||!g._item.deleted){l=f.deleted||!f.countable?0:u.diff+(h>=0?0:1);let p=f.left;for(;p!==null;)!p.deleted&&p.countable&&(l+=p.length),p=p.left}}else{if(a!==null)g=t.get(a);else if(o!==null){if(st(r,o.client)<=o.clock)return null;let{item:u}=n?Es(r,o):{item:Me(r,o)};if(u instanceof Q&&u.content instanceof Vt)g=u.content.type;else return null}else throw wt();h>=0?l=g._length:l=0}return Lh(g,l,e.assoc)},$h=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Be(e.item,t.item)&&Be(e.type,t.type)&&e.assoc===t.assoc,ar=class{constructor(t,n){this.ds=t,this.sv=n}},qh=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,o=t.sv;if(s.size!==o.size||n.size!==r.size)return!1;for(let[a,h]of s.entries())if(o.get(a)!==h)return!1;for(let[a,h]of n.entries()){let g=r.get(a)||[];if(h.length!==g.length)return!1;for(let l=0;l<h.length;l++){let u=h[l],f=g[l];if(u.clock!==f.clock||u.len!==f.len)return!1}}return!0},Oc=(e,t=new _n)=>(Gt(t,e.ds),Rs(t,e.sv),t.toUint8Array()),Hh=e=>Oc(e,new ve),Lc=(e,t=new ci(it(e)))=>new ar(ie(t),Ic(t)),Wh=e=>Lc(e,new je(it(e))),Os=(e,t)=>new ar(e,t),zh=Os(bi(),new Map),Gh=e=>Os(ks(e.store),yr(e.store)),me=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ye(t.ds,e.id),ys=(e,t)=>{let n=at(e.meta,ys,Nt),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<st(r,o)&&St(e,$(o,s))}),Ve(e,t.ds,s=>{}),n.add(t))},Yh=(e,t,n=new _e)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:r,ds:s}=t,o=new Ot;return e.transact(a=>{let h=0;r.forEach(g=>{g>0&&h++}),V(o.restEncoder,h);for(let[g,l]of r){if(l===0)continue;l<st(e.store,g)&&St(a,$(g,l));let u=e.store.clients.get(g)||[],f=Mt(u,l-1);V(o.restEncoder,f+1),o.writeClient(g),V(o.restEncoder,0);for(let p=0;p<=f;p++)u[p].write(o,0)}Gt(o,s)}),_i(n,o.toUint8Array(),"snapshot"),n},Kh=(e,t,n=Tt)=>{let r=new n(it(t)),s=new Kt(r,!1);for(let a=s.curr;a!==null;a=s.next())if((e.sv.get(a.id.client)||0)<a.id.clock+a.length)return!1;let o=Fe([e.ds,ie(r)]);return Ac(e.ds,o)},Jh=(e,t)=>Kh(e,t,It),li=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},yr=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},st=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},Nc=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw wt()}n.push(t)},Mt=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let a=pt(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[a],o=s.id.clock,o<=t){if(t<o+s.length)return a;n=a+1}else r=a-1;a=pt((n+r)/2)}throw wt()},Xh=(e,t)=>{let n=e.clients.get(t.client);return n[Mt(n,t.clock)]},Me=Xh,ws=(e,t,n)=>{let r=Mt(t,n),s=t[r];return s.id.clock<n&&s instanceof Q?(t.splice(r+1,0,wi(e,s,n-s.id.clock)),r+1):r},St=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[ws(e,n,t.clock)]},bs=(e,t,n)=>{let r=t.clients.get(n.client),s=Mt(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==Ct&&r.splice(s+1,0,wi(e,o,n.clock-o.id.clock+1)),o},Zh=(e,t,n)=>{let r=e.clients.get(t.id.client);r[Mt(r,t.id.clock)]=n},Bc=(e,t,n,r,s)=>{if(r===0)return;let o=n+r,a=ws(e,t,n),h;do h=t[a++],o<h.id.clock+h.length&&ws(e,t,o),s(h);while(a<t.length&&t[a].id.clock<o)},hi=class{constructor(t,n,r){this.doc=t,this.deleteSet=new be,this.beforeState=yr(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},bc=(e,t)=>t.deleteSet.clients.size===0&&!ao(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Cs(t.deleteSet),kh(e,t),Gt(e,t.deleteSet),!0),_c=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&at(e.changed,t,Nt).add(n)},si=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Q&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}let o=t-s;return o&&e.splice(t+1-o,o),o},Mc=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let o=t.clients.get(r);for(let a=s.length-1;a>=0;a--){let h=s[a],g=h.clock+h.len;for(let l=Mt(o,h.clock),u=o[l];l<o.length&&u.id.clock<g;u=o[++l]){let f=o[l];if(h.clock+h.len<=f.id.clock)break;f instanceof Q&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},Vc=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){let a=n[o],h=en(s.length-1,1+Mt(s,a.clock+a.len-1));for(let g=h,l=s[g];g>0&&l.id.clock>=a.clock;l=s[g])g-=1+si(s,g)}})},Qh=(e,t,n)=>{Mc(e,t,n),Vc(e,t)},Fc=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,o=n.deleteSet,a=n._mergeStructs;try{Cs(o),n.afterState=yr(n.doc.store),r.emit("beforeObserverCalls",[n,r]);let h=[];n.changed.forEach((g,l)=>h.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,g)})),h.push(()=>{n.changedParentTypes.forEach((g,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(g=g.filter(u=>u.target._item===null||!u.target._item.deleted),g.forEach(u=>{u.currentTarget=l,u._path=null}),g.sort((u,f)=>u.path.length-f.path.length),h.push(()=>{Dc(l._dEH,g,n)}))}),h.push(()=>r.emit("afterTransaction",[n,r])),h.push(()=>{n._needFormattingCleanup&&vu(n)})}),Kn(h,[])}finally{r.gc&&Mc(o,s,r.gcFilter),Vc(o,s),n.afterState.forEach((u,f)=>{let p=n.beforeState.get(f)||0;if(p!==u){let y=s.clients.get(f),w=Qt(Mt(y,p),1);for(let S=y.length-1;S>=w;)S-=1+si(y,S)}});for(let u=a.length-1;u>=0;u--){let{client:f,clock:p}=a[u].id,y=s.clients.get(f),w=Mt(y,p);w+1<y.length&&si(y,w+1)>1||w>0&&si(y,w)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(rr(Le,Et,"[yjs] ",$t,nr,"Changed the client-id because another client seems to be using it."),r.clientID=Uc()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let u=new Yt;bc(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let u=new Ot;bc(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}let{subdocsAdded:h,subdocsLoaded:g,subdocsRemoved:l}=n;(h.size>0||l.size>0||g.size>0)&&(h.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:g,added:h,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Fc(e,t+1)}}},Z=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,o=!1,a=null;e._transaction===null&&(o=!0,e._transaction=new hi(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{a=t(e._transaction)}finally{if(o){let h=e._transaction===s[0];e._transaction=null,h&&Fc(s,0)}}return a},_s=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},vc=(e,t,n)=>{Ve(e,n.deletions,r=>{r instanceof Q&&t.scope.some(s=>s===e.doc||cr(s,r))&&Fs(r,!1)})},xc=(e,t,n)=>{let r=null,s=e.doc,o=e.scope;Z(s,h=>{for(;t.length>0&&e.currStackItem===null;){let g=s.store,l=t.pop(),u=new Set,f=[],p=!1;Ve(h,l.insertions,y=>{if(y instanceof Q){if(y.redone!==null){let{item:w,diff:S}=Es(g,y.id);S>0&&(w=St(h,$(w.id.client,w.id.clock+S))),y=w}!y.deleted&&o.some(w=>w===h.doc||cr(w,y))&&f.push(y)}}),Ve(h,l.deletions,y=>{y instanceof Q&&o.some(w=>w===h.doc||cr(w,y))&&!Ye(l.insertions,y.id)&&u.add(y)}),u.forEach(y=>{p=da(h,y,u,l.insertions,e.ignoreRemoteMapChanges,e)!==null||p});for(let y=f.length-1;y>=0;y--){let w=f[y];e.deleteFilter(w)&&(w.delete(h),p=!0)}e.currStackItem=p?l:null}h.changed.forEach((g,l)=>{g.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=h},e);let a=e.currStackItem;if(a!=null){let h=r.changedParentTypes;e.emit("stack-item-popped",[{stackItem:a,type:n,changedParentTypes:h,origin:e},e]),e.currStackItem=null}return a},vs=class extends le{constructor(t,{captureTimeout:n=500,captureTransaction:r=g=>!0,deleteFilter:s=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:a=!1,doc:h=Zt(t)?t[0].doc:t instanceof _e?t:t.doc}={}){super(),this.scope=[],this.doc=h,this.addToScope(t),this.deleteFilter=s,o.add(this),this.trackedOrigins=o,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=a,this.captureTimeout=n,this.afterTransactionHandler=g=>{if(!this.captureTransaction(g)||!this.scope.some(R=>g.changedParentTypes.has(R)||R===this.doc)||!this.trackedOrigins.has(g.origin)&&(!g.origin||!this.trackedOrigins.has(g.origin.constructor)))return;let l=this.undoing,u=this.redoing,f=l?this.redoStack:this.undoStack;l?this.stopCapturing():u||this.clear(!1,!0);let p=new be;g.afterState.forEach((R,m)=>{let _=g.beforeState.get(m)||0,v=R-_;v>0&&or(p,m,_,v)});let y=Rt(),w=!1;if(this.lastChange>0&&y-this.lastChange<this.captureTimeout&&f.length>0&&!l&&!u){let R=f[f.length-1];R.deletions=Fe([R.deletions,g.deleteSet]),R.insertions=Fe([R.insertions,p])}else f.push(new _s(g.deleteSet,p)),w=!0;!l&&!u&&(this.lastChange=y),Ve(g,g.deleteSet,R=>{R instanceof Q&&this.scope.some(m=>m===g.doc||cr(m,R))&&Fs(R,!0)});let S=[{stackItem:f[f.length-1],origin:g.origin,type:l?"redo":"undo",changedParentTypes:g.changedParentTypes},this];w?this.emit("stack-item-added",S):this.emit("stack-item-updated",S)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){let n=new Set(this.scope);t=Zt(t)?t:[t],t.forEach(r=>{n.has(r)||(n.add(r),(r instanceof ht?r.doc!==this.doc:r!==this.doc)&&ds("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>vc(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>vc(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=xc(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=xc(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*tu(e){let t=j(e.restDecoder);for(let n=0;n<t;n++){let r=j(e.restDecoder),s=e.readClient(),o=j(e.restDecoder);for(let a=0;a<r;a++){let h=e.readInfo();if(h===10){let g=j(e.restDecoder);yield new _t($(s,o),g),o+=g}else if((31&h)!==0){let g=(h&192)===0,l=new Q($(s,o),null,(h&128)===128?e.readLeftID():null,null,(h&64)===64?e.readRightID():null,g?e.readParentInfo()?e.readString():e.readLeftID():null,g&&(h&32)===32?e.readString():null,fa(e,h));yield l,o+=l.length}else{let g=e.readLen();yield new Ct($(s,o),g),o+=g}}}}var Kt=class{constructor(t,n){this.gen=tu(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_t);return this.curr}},eu=e=>jc(e,It),jc=(e,t=Tt)=>{let n=[],r=new t(it(e)),s=new Kt(r,!1);for(let a=s.curr;a!==null;a=s.next())n.push(a);rr("Structs: ",n);let o=ie(r);rr("DeleteSet: ",o)},nu=e=>Pc(e,It),Pc=(e,t=Tt)=>{let n=[],r=new t(it(e)),s=new Kt(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);return{structs:n,ds:ie(r)}},lr=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},$c=e=>hr(e,It,Yt),qc=(e,t=_n,n=Tt)=>{let r=new t,s=new Kt(new n(it(e)),!1),o=s.curr;if(o!==null){let a=0,h=o.id.client,g=o.id.clock!==0,l=g?0:o.id.clock+o.length;for(;o!==null;o=s.next())h!==o.id.client&&(l!==0&&(a++,V(r.restEncoder,h),V(r.restEncoder,l)),h=o.id.client,l=0,g=o.id.clock!==0),o.constructor===_t&&(g=!0),g||(l=o.id.clock+o.length);l!==0&&(a++,V(r.restEncoder,h),V(r.restEncoder,l));let u=rt();return V(u,a),wo(u,r.restEncoder),r.restEncoder=u,r.toUint8Array()}else return V(r.restEncoder,0),r.toUint8Array()},ru=e=>qc(e,ve,It),Hc=(e,t=Tt)=>{let n=new Map,r=new Map,s=new Kt(new t(it(e)),!1),o=s.curr;if(o!==null){let a=o.id.client,h=o.id.clock;for(n.set(a,h);o!==null;o=s.next())a!==o.id.client&&(r.set(a,h),n.set(o.id.client,o.id.clock),a=o.id.client),h=o.id.clock+o.length;r.set(a,h)}return{from:n,to:r}},iu=e=>Hc(e,It),su=(e,t)=>{if(e.constructor===Ct){let{client:n,clock:r}=e.id;return new Ct($(n,r+t),e.length-t)}else if(e.constructor===_t){let{client:n,clock:r}=e.id;return new _t($(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new Q($(r,s+t),null,$(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hr=(e,t=Tt,n=Ot)=>{if(e.length===1)return e[0];let r=e.map(u=>new t(it(u))),s=r.map(u=>new Kt(u,!0)),o=null,a=new n,h=new lr(a);for(;s=s.filter(p=>p.curr!==null),s.sort((p,y)=>{if(p.curr.id.client===y.curr.id.client){let w=p.curr.id.clock-y.curr.id.clock;return w===0?p.curr.constructor===y.curr.constructor?0:p.curr.constructor===_t?1:-1:w}else return y.curr.id.client-p.curr.id.client}),s.length!==0;){let u=s[0],f=u.curr.id.client;if(o!==null){let p=u.curr,y=!1;for(;p!==null&&p.id.clock+p.length<=o.struct.id.clock+o.struct.length&&p.id.client>=o.struct.id.client;)p=u.next(),y=!0;if(p===null||p.id.client!==f||y&&p.id.clock>o.struct.id.clock+o.struct.length)continue;if(f!==o.struct.id.client)ye(h,o.struct,o.offset),o={struct:p,offset:0},u.next();else if(o.struct.id.clock+o.struct.length<p.id.clock)if(o.struct.constructor===_t)o.struct.length=p.id.clock+p.length-o.struct.id.clock;else{ye(h,o.struct,o.offset);let w=p.id.clock-o.struct.id.clock-o.struct.length;o={struct:new _t($(f,o.struct.id.clock+o.struct.length),w),offset:0}}else{let w=o.struct.id.clock+o.struct.length-p.id.clock;w>0&&(o.struct.constructor===_t?o.struct.length-=w:p=su(p,w)),o.struct.mergeWith(p)||(ye(h,o.struct,o.offset),o={struct:p,offset:0},u.next())}}else o={struct:u.curr,offset:0},u.next();for(let p=u.curr;p!==null&&p.id.client===f&&p.id.clock===o.struct.id.clock+o.struct.length&&p.constructor!==_t;p=u.next())ye(h,o.struct,o.offset),o={struct:p,offset:0}}o!==null&&(ye(h,o.struct,o.offset),o=null),Ns(h);let g=r.map(u=>ie(u)),l=Fe(g);return Gt(a,l),a.toUint8Array()},Ls=(e,t,n=Tt,r=Ot)=>{let s=Us(t),o=new r,a=new lr(o),h=new n(it(e)),g=new Kt(h,!1);for(;g.curr;){let u=g.curr,f=u.id.client,p=s.get(f)||0;if(g.curr.constructor===_t){g.next();continue}if(u.id.clock+u.length>p)for(ye(a,u,Qt(p-u.id.clock,0)),g.next();g.curr&&g.curr.id.client===f;)ye(a,g.curr,0),g.next();else for(;g.curr&&g.curr.id.client===f&&g.curr.id.clock+g.curr.length<=p;)g.next()}Ns(a);let l=ie(h);return Gt(o,l),o.toUint8Array()},ou=(e,t)=>Ls(e,t,It,Yt),Wc=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:X(e.encoder.restEncoder)}),e.encoder.restEncoder=rt(),e.written=0)},ye=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Wc(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),V(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ns=e=>{Wc(e);let t=e.encoder.restEncoder;V(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];V(t,r.written),an(t,r.restEncoder)}},vi=(e,t,n,r)=>{let s=new n(it(e)),o=new Kt(s,!1),a=new r,h=new lr(a);for(let l=o.curr;l!==null;l=o.next())ye(h,t(l),0);Ns(h);let g=ie(s);return Gt(a,g),a.toUint8Array()},zc=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0,s=ct(),o=ct(),a=ct(),h=ct();return h.set(null,null),g=>{switch(g.constructor){case Ct:case _t:return g;case Q:{let l=g,u=l.content;switch(u.constructor){case Sn:break;case Vt:{if(n){let f=u.type;f instanceof We&&(f.nodeName=at(o,f.nodeName,()=>"node-"+r)),f instanceof pr&&(f.hookName=at(o,f.hookName,()=>"hook-"+r))}break}case xe:{let f=u;f.arr=f.arr.map(()=>r);break}case ze:{let f=u;f.content=new Uint8Array([r]);break}case Ge:{let f=u;t&&(f.opts={},f.doc.guid=r+"");break}case se:{let f=u;f.embed={};break}case ut:{let f=u;e&&(f.key=at(a,f.key,()=>r+""),f.value=at(h,f.value,()=>({i:r})));break}case gr:{let f=u;f.arr=f.arr.map(()=>r);break}case qt:{let f=u;f.str=Ar(r%10+"",f.str.length);break}default:wt()}return l.parentSub&&(l.parentSub=at(s,l.parentSub,()=>r+"")),r++,g}default:wt()}}},cu=(e,t)=>vi(e,zc(t),It,Yt),au=(e,t)=>vi(e,zc(t),Tt,Ot),lu=e=>vi(e,Xi,It,Ot),Gc=e=>vi(e,Xi,Tt,Yt),Ec="You must not compute changes after the event-handler fired.",Pe=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=hu(this.currentTarget,this.target))}deletes(t){return Ye(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw gt(Ec);let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let o=n._map.get(s),a,h;if(this.adds(o)){let g=o.left;for(;g!==null&&this.adds(g);)g=g.left;if(this.deletes(o))if(g!==null&&this.deletes(g))a="delete",h=Cr(g.content.getContent());else return;else g!==null&&this.deletes(g)?(a="update",h=Cr(g.content.getContent())):(a="add",h=void 0)}else if(this.deletes(o))a="delete",h=Cr(o.content.getContent());else return;t.set(s,{action:a,oldValue:h})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw gt(Ec);let n=this.target,r=Nt(),s=Nt(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let h=null,g=()=>{h&&o.push(h)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((h===null||h.delete===void 0)&&(g(),h={delete:0}),h.delete+=l.length,s.add(l)):this.adds(l)?((h===null||h.insert===void 0)&&(g(),h={insert:[]}),h.insert=h.insert.concat(l.content.getContent()),r.add(l)):((h===null||h.retain===void 0)&&(g(),h={retain:0}),h.retain+=l.length);h!==null&&h.retain===void 0&&g()}this._changes=t}return t}},hu=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},vt=()=>{ds("Invalid access: Add Yjs type to a document before reading data.")},Yc=80,Bs=0,xs=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Bs++}},uu=e=>{e.timestamp=Bs++},Kc=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Bs++},du=(e,t,n)=>{if(e.length>=Yc){let r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return Kc(r,t,n),r}else{let r=new xs(t,n);return e.push(r),r}},xi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,a)=>ke(t-o.index)<ke(t-a.index)?o:a),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,uu(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&ke(n.index-s)<r.parent.length/Yc?(Kc(n,r,s),n):du(e._searchMarker,r,s)},ur=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Qt(t,s.index+n))}},fu=e=>{e.doc??vt();let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},Ei=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;at(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Dc(r._eH,n,t)},ht=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=pc(),this._dEH=pc(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Dt()}clone(){throw Dt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){gc(this._eH,t)}observeDeep(t){gc(this._dEH,t)}unobserve(t){mc(this._eH,t)}unobserveDeep(t){mc(this._dEH,t)}toJSON(){}},Jc=(e,t,n)=>{e.doc??vt(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let a=o.content.getContent();if(a.length<=t)t-=a.length;else{for(let h=t;h<a.length&&r>0;h++)s.push(a[h]),r--;t=0}}o=o.right}return s},Xc=e=>{e.doc??vt();let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},pu=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&me(r,t)){let s=r.content.getContent();for(let o=0;o<s.length;o++)n.push(s[o])}r=r.right}return n},dr=(e,t)=>{let n=0,r=e._start;for(e.doc??vt();r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}r=r.right}},Zc=(e,t)=>{let n=[];return dr(e,(r,s)=>{n.push(t(r,s,e))}),n},gu=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Qc=(e,t)=>{e.doc??vt();let n=xi(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ui=(e,t,n,r)=>{let s=n,o=e.doc,a=o.clientID,h=o.store,g=n===null?t._start:n.right,l=[],u=()=>{l.length>0&&(s=new Q($(a,st(h,a)),s,s&&s.lastId,g,g&&g.id,t,null,new xe(l)),s.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:s=new Q($(a,st(h,a)),s,s&&s.lastId,g,g&&g.id,t,null,new ze(new Uint8Array(f))),s.integrate(e,0);break;case _e:s=new Q($(a,st(h,a)),s,s&&s.lastId,g,g&&g.id,t,null,new Ge(f)),s.integrate(e,0);break;default:if(f instanceof ht)s=new Q($(a,st(h,a)),s,s&&s.lastId,g,g&&g.id,t,null,new Vt(f)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},ta=()=>gt("Length exceeded!"),ea=(e,t,n,r)=>{if(n>t._length)throw ta();if(n===0)return t._searchMarker&&ur(t._searchMarker,n,r.length),ui(e,t,null,r);let s=n,o=xi(t,n),a=t._start;for(o!==null&&(a=o.p,n-=o.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&St(e,$(a.id.client,a.id.clock+n));break}n-=a.length}return t._searchMarker&&ur(t._searchMarker,s,r.length),ui(e,t,a,r)},mu=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,a)=>a.index>o.index?a:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return ui(e,t,s,n)},na=(e,t,n,r)=>{if(r===0)return;let s=n,o=r,a=xi(t,n),h=t._start;for(a!==null&&(h=a.p,n-=a.index);h!==null&&n>0;h=h.right)!h.deleted&&h.countable&&(n<h.length&&St(e,$(h.id.client,h.id.clock+n)),n-=h.length);for(;r>0&&h!==null;)h.deleted||(r<h.length&&St(e,$(h.id.client,h.id.clock+r)),h.delete(e),r-=h.length),h=h.right;if(r>0)throw ta();t._searchMarker&&ur(t._searchMarker,s,-o+r)},di=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},Ms=(e,t,n,r)=>{let s=t._map.get(n)||null,o=e.doc,a=o.clientID,h;if(r==null)h=new xe([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:h=new xe([r]);break;case Uint8Array:h=new ze(r);break;case _e:h=new Ge(r);break;default:if(r instanceof ht)h=new Vt(r);else throw new Error("Unexpected content type")}new Q($(a,st(o.store,a)),s,s&&s.lastId,null,null,t,n,h).integrate(e,0)},Vs=(e,t)=>{e.doc??vt();let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},ra=e=>{let t={};return e.doc??vt(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},ia=(e,t)=>{e.doc??vt();let n=e._map.get(t);return n!==void 0&&!n.deleted},yu=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&me(r,n)?r.content.getContent()[r.length-1]:void 0},sa=(e,t)=>{let n={};return e._map.forEach((r,s)=>{let o=r;for(;o!==null&&(!t.sv.has(o.id.client)||o.id.clock>=(t.sv.get(o.id.client)||0));)o=o.left;o!==null&&me(o,t)&&(n[s]=o.content.getContent()[o.length-1])}),n},ri=e=>(e.doc??vt(),hc(e._map.entries(),t=>!t[1].deleted)),fi=class extends Pe{},$e=class e extends ht{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new e;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof ht?n.clone():n)),t}get length(){return this.doc??vt(),this._length}_callObserver(t,n){super._callObserver(t,n),Ei(this,t,new fi(this,t))}insert(t,n){this.doc!==null?Z(this.doc,r=>{ea(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?Z(this.doc,n=>{mu(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?Z(this.doc,r=>{na(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Qc(this,t)}toArray(){return Xc(this)}slice(t=0,n=this.length){return Jc(this,t,n)}toJSON(){return this.map(t=>t instanceof ht?t.toJSON():t)}map(t){return Zc(this,t)}forEach(t){dr(this,t)}[Symbol.iterator](){return gu(this)}_write(t){t.writeTypeRef(Vu)}},wu=e=>new $e,pi=class extends Pe{constructor(t,n,r){super(t,n),this.keysChanged=r}},qe=class e extends ht{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return this.forEach((n,r)=>{t.set(r,n instanceof ht?n.clone():n)}),t}_callObserver(t,n){Ei(this,t,new pi(this,t,n))}toJSON(){this.doc??vt();let t={};return this._map.forEach((n,r)=>{if(!n.deleted){let s=n.content.getContent()[n.length-1];t[r]=s instanceof ht?s.toJSON():s}}),t}get size(){return[...ri(this)].length}keys(){return ei(ri(this),t=>t[0])}values(){return ei(ri(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return ei(ri(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??vt(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Z(this.doc,n=>{di(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?Z(this.doc,r=>{Ms(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Vs(this,t)}has(t){return ia(this,t)}clear(){this.doc!==null?Z(this.doc,t=>{this.forEach(function(n,r,s){di(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Fu)}},bu=e=>new qe,we=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Yi(e,t),fr=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){this.right===null&&wt(),this.right.content.constructor===ut?this.right.deleted||kn(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}},Sc=(e,t,n)=>{for(;t.right!==null&&n>0;)t.right.content.constructor===ut?t.right.deleted||kn(t.currentAttributes,t.right.content):t.right.deleted||(n<t.right.length&&St(e,$(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length),t.left=t.right,t.right=t.right.right;return t},ii=(e,t,n,r)=>{let s=new Map,o=r?xi(t,n):null;if(o){let a=new fr(o.p.left,o.p,o.index,s);return Sc(e,a,n-o.index)}else{let a=new fr(null,t._start,0,s);return Sc(e,a,n)}},oa=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ut&&we(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,o=s.clientID;r.forEach((a,h)=>{let g=n.left,l=n.right,u=new Q($(o,st(s.store,o)),g,g&&g.lastId,l,l&&l.id,t,null,new ut(h,a));u.integrate(e,0),n.right=u,n.forward()})},kn=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},ca=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===ut&&we(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},aa=(e,t,n,r)=>{let s=e.doc,o=s.clientID,a=new Map;for(let h in r){let g=r[h],l=n.currentAttributes.get(h)??null;if(!we(l,g)){a.set(h,l);let{left:u,right:f}=n;n.right=new Q($(o,st(s.store,o)),u,u&&u.lastId,f,f&&f.id,t,null,new ut(h,g)),n.right.integrate(e,0),n.forward()}}return a},fs=(e,t,n,r,s)=>{n.currentAttributes.forEach((p,y)=>{s[y]===void 0&&(s[y]=null)});let o=e.doc,a=o.clientID;ca(n,s);let h=aa(e,t,n,s),g=r.constructor===String?new qt(r):r instanceof ht?new Vt(r):new se(r),{left:l,right:u,index:f}=n;t._searchMarker&&ur(t._searchMarker,n.index,g.getLength()),u=new Q($(a,st(o.store,a)),l,l&&l.lastId,u,u&&u.id,t,null,g),u.integrate(e,0),n.right=u,n.index=f,n.forward(),oa(e,t,n,h)},Cc=(e,t,n,r,s)=>{let o=e.doc,a=o.clientID;ca(n,s);let h=aa(e,t,n,s);t:for(;n.right!==null&&(r>0||h.size>0&&(n.right.deleted||n.right.content.constructor===ut));){if(!n.right.deleted)switch(n.right.content.constructor){case ut:{let{key:g,value:l}=n.right.content,u=s[g];if(u!==void 0){if(we(u,l))h.delete(g);else{if(r===0)break t;h.set(g,l)}n.right.delete(e)}else n.currentAttributes.set(g,l);break}default:r<n.right.length&&St(e,$(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let g="";for(;r>0;r--)g+=`
`;n.right=new Q($(a,st(o.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new qt(g)),n.right.integrate(e,0),n.forward()}oa(e,t,n,h)},la=(e,t,n,r,s)=>{let o=t,a=ct();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===ut){let l=o.content;a.set(l.key,l)}o=o.right}let h=0,g=!1;for(;t!==o;){if(n===t&&(g=!0),!t.deleted){let l=t.content;if(l.constructor===ut){let{key:u,value:f}=l,p=r.get(u)??null;(a.get(u)!==l||p===f)&&(t.delete(e),h++,!g&&(s.get(u)??null)===f&&p!==f&&(p===null?s.delete(u):s.set(u,p))),!g&&!t.deleted&&kn(s,l)}}t=t.right}return h},_u=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ut){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},ha=e=>{let t=0;return Z(e.doc,n=>{let r=e._start,s=e._start,o=ct(),a=Er(o);for(;s;)s.deleted===!1&&(s.content.constructor===ut?kn(a,s.content):(t+=la(n,r,s,o,a),o=Er(a),r=s)),s=s.right}),t},vu=e=>{let t=new Set,n=e.doc;for(let[r,s]of e.afterState.entries()){let o=e.beforeState.get(r)||0;s!==o&&Bc(e,n.store.clients.get(r),o,s,a=>{!a.deleted&&a.content.constructor===ut&&a.constructor!==Ct&&t.add(a.parent)})}Z(n,r=>{Ve(e,e.deleteSet,s=>{if(s instanceof Ct||!s.parent._hasFormatting||t.has(s.parent))return;let o=s.parent;s.content.constructor===ut?t.add(o):_u(r,s)});for(let s of t)ha(s)})},kc=(e,t,n)=>{let r=n,s=Er(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Vt:case se:case qt:n<t.right.length&&St(e,$(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&la(e,o,t.right,s,t.currentAttributes);let a=(t.left||t.right).parent;return a._searchMarker&&ur(a._searchMarker,t.index,-r+n),t},gi=class extends Pe{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];Z(t,r=>{let s=new Map,o=new Map,a=this.target._start,h=null,g={},l="",u=0,f=0,p=()=>{if(h!==null){let y=null;switch(h){case"delete":f>0&&(y={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(y={insert:l},s.size>0&&(y.attributes={},s.forEach((w,S)=>{w!==null&&(y.attributes[S]=w)}))),l="";break;case"retain":u>0&&(y={retain:u},Do(g)||(y.attributes=Ro({},g))),u=0;break}y&&n.push(y),h=null}};for(;a!==null;){switch(a.content.constructor){case Vt:case se:this.adds(a)?this.deletes(a)||(p(),h="insert",l=a.content.getContent()[0],p()):this.deletes(a)?(h!=="delete"&&(p(),h="delete"),f+=1):a.deleted||(h!=="retain"&&(p(),h="retain"),u+=1);break;case qt:this.adds(a)?this.deletes(a)||(h!=="insert"&&(p(),h="insert"),l+=a.content.str):this.deletes(a)?(h!=="delete"&&(p(),h="delete"),f+=a.length):a.deleted||(h!=="retain"&&(p(),h="retain"),u+=a.length);break;case ut:{let{key:y,value:w}=a.content;if(this.adds(a)){if(!this.deletes(a)){let S=s.get(y)??null;we(S,w)?w!==null&&a.delete(r):(h==="retain"&&p(),we(w,o.get(y)??null)?delete g[y]:g[y]=w)}}else if(this.deletes(a)){o.set(y,w);let S=s.get(y)??null;we(S,w)||(h==="retain"&&p(),g[y]=S)}else if(!a.deleted){o.set(y,w);let S=g[y];S!==void 0&&(we(S,w)?S!==null&&a.delete(r):(h==="retain"&&p(),w===null?delete g[y]:g[y]=w))}a.deleted||(h==="insert"&&p(),kn(s,a.content));break}}a=a.right}for(p();n.length>0;){let y=n[n.length-1];if(y.retain!==void 0&&y.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},xn=class e extends ht{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??vt(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new gi(this,t,n);Ei(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??vt();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===qt&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?Z(this.doc,r=>{let s=new fr(null,this._start,0,new Map);for(let o=0;o<t.length;o++){let a=t[o];if(a.insert!==void 0){let h=!n&&typeof a.insert=="string"&&o===t.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof h!="string"||h.length>0)&&fs(r,this,s,h,a.attributes||{})}else a.retain!==void 0?Cc(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&kc(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??vt();let s=[],o=new Map,a=this.doc,h="",g=this._start;function l(){if(h.length>0){let f={},p=!1;o.forEach((w,S)=>{p=!0,f[S]=w});let y={insert:h};p&&(y.attributes=f),s.push(y),h=""}}let u=()=>{for(;g!==null;){if(me(g,t)||n!==void 0&&me(g,n))switch(g.content.constructor){case qt:{let f=o.get("ychange");t!==void 0&&!me(g,t)?(f===void 0||f.user!==g.id.client||f.type!=="removed")&&(l(),o.set("ychange",r?r("removed",g.id):{type:"removed"})):n!==void 0&&!me(g,n)?(f===void 0||f.user!==g.id.client||f.type!=="added")&&(l(),o.set("ychange",r?r("added",g.id):{type:"added"})):f!==void 0&&(l(),o.delete("ychange")),h+=g.content.str;break}case Vt:case se:{l();let f={insert:g.content.getContent()[0]};if(o.size>0){let p={};f.attributes=p,o.forEach((y,w)=>{p[w]=y})}s.push(f);break}case ut:me(g,t)&&(l(),kn(o,g.content));break}g=g.right}l()};return t||n?Z(a,f=>{t&&ys(f,t),n&&ys(f,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?Z(s,o=>{let a=ii(o,this,t,!r);r||(r={},a.currentAttributes.forEach((h,g)=>{r[g]=h})),fs(o,this,a,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){let s=this.doc;s!==null?Z(s,o=>{let a=ii(o,this,t,!r);fs(o,this,a,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?Z(r,s=>{kc(s,ii(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?Z(s,o=>{let a=ii(o,this,t,!1);a.right!==null&&Cc(o,this,a,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?Z(this.doc,n=>{di(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?Z(this.doc,r=>{Ms(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Vs(this,t)}getAttributes(){return ra(this)}_write(t){t.writeTypeRef(ju)}},xu=e=>new xn,ir=class{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??vt()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===We||n.constructor===He)&&n._start!==null)t=n._start;else for(;t!==null;){let r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},He=class e extends ht{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof ht?n.clone():n)),t}get length(){return this.doc??vt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ir(this,t)}querySelector(t){t=t.toUpperCase();let r=new ir(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Pt(new ir(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ei(this,t,new mi(this,n,t))}toString(){return Zc(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),dr(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?Z(this.doc,r=>{ea(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)Z(this.doc,r=>{let s=t&&t instanceof ht?t._item:t;ui(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw gt("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?Z(this.doc,r=>{na(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Xc(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Qc(this,t)}slice(t=0,n=this.length){return Jc(this,t,n)}forEach(t){dr(this,t)}_write(t){t.writeTypeRef($u)}},Eu=e=>new He,We=class e extends He{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new e(this.nodeName)}clone(){let t=new e(this.nodeName),n=this.getAttributes();return Io(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof ht?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let h in t)r.push(h);r.sort();let s=r.length;for(let h=0;h<s;h++){let g=r[h];n.push(g+'="'+t[g]+'"')}let o=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${o}${a}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?Z(this.doc,n=>{di(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?Z(this.doc,r=>{Ms(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Vs(this,t)}hasAttribute(t){return ia(this,t)}getAttributes(t){return t?sa(this,t):ra(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),o=this.getAttributes();for(let a in o){let h=o[a];typeof h=="string"&&s.setAttribute(a,h)}return dr(this,a=>{s.appendChild(a.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Pu),t.writeKey(this.nodeName)}},Su=e=>new We(e.readKey()),mi=class extends Pe{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},pr=class e extends qe{constructor(t){super(),this.hookName=t}_copy(){return new e(this.hookName)}clone(){let t=new e(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(qu),t.writeKey(this.hookName)}},Cu=e=>new pr(e.readKey()),yi=class e extends xn{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let o=[];for(let a in t.attributes[s])o.push({key:a,value:t.attributes[s][a]});o.sort((a,h)=>a.key<h.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let o=n[s];r+=`<${o.nodeName}`;for(let a=0;a<o.attrs.length;a++){let h=o.attrs[a];r+=` ${h.key}="${h.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Hu)}},ku=e=>new yi,En=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Dt()}mergeWith(t){return!1}write(t,n,r){throw Dt()}integrate(t,n){throw Dt()}},Tu=0,Ct=class extends En{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Nc(t.doc.store,this)}write(t,n){t.writeInfo(Tu),t.writeLen(this.length-n)}getMissing(t,n){return null}},ze=class e{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new e(this.content)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},Au=e=>new ze(e.readBuf()),Sn=class e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.len)}splice(t){let n=new e(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){or(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},Uu=e=>new Sn(e.readLen()),ua=(e,t)=>new _e({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Ge=class e{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new e(ua(this.doc.guid,this.opts))}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},Ru=e=>new Ge(ua(e.readString(),e.readAny())),se=class e{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new e(this.embed)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},Iu=e=>new se(e.readJSON()),ut=class e{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.key,this.value)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,n){let r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},Du=e=>new ut(e.readKey(),e.readJSON()),gr=class e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},Ou=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new gr(n)},Lu=De("node_env")==="development",xe=class e{constructor(t){this.arr=t,Lu&&Ki(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeAny(o)}}getRef(){return 8}},Nu=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new xe(n)},qt=class e{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new e(this.str)}splice(t){let n=new e(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},Bu=e=>new qt(e.readString()),Mu=[wu,bu,xu,Su,Eu,Cu,ku],Vu=0,Fu=1,ju=2,Pu=3,$u=4,qu=5,Hu=6,Vt=class e{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new e(this.type._copy())}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},Wu=e=>new Vt(Mu[e.readTypeRef()](e)),Es=(e,t)=>{let n=t,r=0,s;do r>0&&(n=$(n.client,n.clock+r)),s=Me(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof Q);return{item:s,diff:r}},Fs=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},wi=(e,t,n)=>{let{client:r,clock:s}=t.id,o=new Q($(r,s+n),t,$(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=$(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},Tc=(e,t)=>Nn(e,n=>Ye(n.deletions,t)),da=(e,t,n,r,s,o)=>{let a=e.doc,h=a.store,g=a.clientID,l=t.redone;if(l!==null)return St(e,l);let u=t.parent._item,f=null,p;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||da(e,u,n,r,s,o)===null))return null;for(;u.redone!==null;)u=St(e,u.redone)}let y=u===null?t.parent:u.content.type;if(t.parentSub===null){for(f=t.left,p=t;f!==null;){let m=f;for(;m!==null&&m.parent._item!==u;)m=m.redone===null?null:St(e,m.redone);if(m!==null&&m.parent._item===u){f=m;break}f=f.left}for(;p!==null;){let m=p;for(;m!==null&&m.parent._item!==u;)m=m.redone===null?null:St(e,m.redone);if(m!==null&&m.parent._item===u){p=m;break}p=p.right}}else if(p=null,t.right&&!s){for(f=t;f!==null&&f.right!==null&&(f.right.redone||Ye(r,f.right.id)||Tc(o.undoStack,f.right.id)||Tc(o.redoStack,f.right.id));)for(f=f.right;f.redone;)f=St(e,f.redone);if(f&&f.right!==null)return null}else f=y._map.get(t.parentSub)||null;let w=st(h,g),S=$(g,w),R=new Q(S,f,f&&f.lastId,p,p&&p.id,y,t.parentSub,t.content.copy());return t.redone=S,Fs(R,!0),R.integrate(e,0),R},Q=class e extends En{constructor(t,n,r,s,o,a,h,g){super(t,g.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=a,this.parentSub=h,this.redone=null,this.content=g,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=st(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=st(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===re&&this.id.client!==this.parent.client&&this.parent.clock>=st(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bs(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=St(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Ct||this.right&&this.right.constructor===Ct)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===e?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===e&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===re){let r=Me(n,this.parent);r.constructor===Ct?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=bs(t,t.doc.store,$(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),o.add(s),Be(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Be(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(Me(t.doc.store,s.origin)))o.has(Me(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Nc(t.doc.store,this),this.content.integrate(t,this),_c(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Ct(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:$(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Be(t.origin,this.lastId)&&this.right===t&&Be(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),or(t.deleteSet,this.id.client,this.id.clock,this.length),_c(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw wt();this.content.gc(t),n?Zh(t,this,new Ct(this.id,this.length)):this.content=new Sn(this.length)}write(t,n){let r=n>0?$(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(t.writeInfo(a),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let h=this.parent;if(h._item!==void 0){let g=h._item;if(g===null){let l=Ds(h);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(g.id)}else h.constructor===String?(t.writeParentInfo(!0),t.writeString(h)):h.constructor===re?(t.writeParentInfo(!1),t.writeLeftID(h)):wt();o!==null&&t.writeString(o)}this.content.write(t,n)}},fa=(e,t)=>zu[t&31](e),zu=[()=>{wt()},Uu,Ou,Au,Bu,Iu,Du,Wu,Nu,Ru,()=>{wt()}],Gu=10,_t=class extends En{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){wt()}write(t,n){t.writeInfo(Gu),V(t.restEncoder,this.length-n)}getMissing(t,n){return null}},pa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},ga="__ $YJS$ __";pa[ga]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");pa[ga]=!0;var Ke=e=>ne((t,n)=>{e.onerror=r=>n(new Error(r.target.error)),e.onsuccess=r=>t(r.target.result)}),ma=(e,t)=>ne((n,r)=>{let s=indexedDB.open(e);s.onupgradeneeded=o=>t(o.target.result),s.onerror=o=>r(gt(o.target.error)),s.onsuccess=o=>{let a=o.target.result;a.onversionchange=()=>{a.close()},n(a)}}),ya=e=>Ke(indexedDB.deleteDatabase(e)),wa=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),Tn=(e,t,n="readwrite")=>{let r=e.transaction(t,n);return t.map(s=>Xu(r,s))},js=(e,t)=>Ke(e.count(t)),ba=(e,t)=>Ke(e.get(t)),Ps=(e,t)=>Ke(e.delete(t)),_a=(e,t,n)=>Ke(e.put(t,n));var Si=(e,t)=>Ke(e.add(t)),va=(e,t,n)=>Ke(e.getAll(t,n));var Yu=(e,t,n)=>{let r=null;return Ju(e,t,s=>(r=s,!1),n).then(()=>r)},xa=(e,t=null)=>Yu(e,t,"prev");var Ku=(e,t)=>ne((n,r)=>{e.onerror=r,e.onsuccess=async s=>{let o=s.target.result;if(o===null||await t(o)===!1)return n();o.continue()}});var Ju=(e,t,n,r="next")=>Ku(e.openKeyCursor(t,r),s=>n(s.key)),Xu=(e,t)=>e.objectStore(t);var Ea=(e,t)=>IDBKeyRange.upperBound(e,t),Sa=(e,t)=>IDBKeyRange.lowerBound(e,t);var $s="custom",Ca="updates",ka=500,Ta=(e,t=()=>{},n=()=>{})=>{let[r]=Tn(e.db,[Ca]);return va(r,Sa(e._dbref,!1)).then(s=>{e._destroyed||(t(r),Z(e.doc,()=>{s.forEach(o=>mr(e.doc,o))},e,!1),n(r))}).then(()=>xa(r).then(s=>{e._dbref=s+1})).then(()=>js(r).then(s=>{e._dbsize=s})).then(()=>r)},Qu=(e,t=!0)=>Ta(e).then(n=>{(t||e._dbsize>=ka)&&Si(n,Cn(e.doc)).then(()=>Ps(n,Ea(e._dbref,!0))).then(()=>js(n).then(r=>{e._dbsize=r}))});var Ci=class extends he{constructor(t,n){super(),this.doc=n,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=ma(t,r=>wa(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=ne(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Ta(this,a=>Si(a,Cn(n)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[o]=Tn(this.db,[Ca]);Si(o,r),++this._dbsize>=ka&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{Qu(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{ya(this.name)})}get(t){return this._db.then(n=>{let[r]=Tn(n,[$s],"readonly");return ba(r,t)})}set(t,n){return this._db.then(r=>{let[s]=Tn(r,[$s]);return _a(s,n,t)})}del(t){return this._db.then(n=>{let[r]=Tn(n,[$s]);return Ps(r,t)})}};var td=1200,ed=2500,ki=3e4,qs=e=>{if(e.shouldConnect&&e.ws===null){let t=new WebSocket(e.url),n=e.binaryType,r=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=a=>{e.lastMessageReceived=Rt();let h=a.data,g=typeof h=="string"?JSON.parse(h):h;g&&g.type==="pong"&&(clearTimeout(r),r=setTimeout(o,ki/2)),e.emit("message",[g,e])};let s=a=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:a},e])):e.unsuccessfulReconnects++,setTimeout(qs,en(uo(e.unsuccessfulReconnects+1)*td,ed),e)),clearTimeout(r)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>s(null),t.onerror=a=>s(a),t.onopen=()=>{e.lastMessageReceived=Rt(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),r=setTimeout(o,ki/2)}}},Ti=class extends he{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&ki<Rt()-this.lastMessageReceived&&this.ws.close()},ki/2),qs(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&qs(this)}};var Aa=new Map,Hs=class{constructor(t){this.room=t,this.onmessage=null,this._onChange=n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:Mr(n.newValue||"")}),ko(this._onChange)}postMessage(t){Or.setItem(this.room,Br(Fo(t)))}close(){To(this._onChange)}},rd=typeof BroadcastChannel>"u"?Hs:BroadcastChannel,Ws=e=>at(Aa,e,()=>{let t=Nt(),n=new rd(e);return n.onmessage=r=>t.forEach(s=>s(r.data,"broadcastchannel")),{bc:n,subs:t}}),Ua=(e,t)=>(Ws(e).subs.add(t),t),Ra=(e,t)=>{let n=Ws(e),r=n.subs.delete(t);return r&&n.subs.size===0&&(n.bc.close(),Aa.delete(e)),r},Ia=(e,t,n=null)=>{let r=Ws(e);r.bc.postMessage(t),r.subs.forEach(s=>s(t,n))};var Da=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var qa=el(La(),1);var Ai=0,Ui=1,Na=2,Gs=(e,t)=>{V(e,Ai);let n=Is(t);tt(e,n)},Ys=(e,t,n)=>{V(e,Ui),tt(e,Cn(t,n))},sd=(e,t,n)=>Ys(t,n,lt(e)),Ba=(e,t,n,r)=>{try{mr(t,lt(e),n)}catch(s){r?.(s),console.error("Caught error while handling a Yjs update",s)}},Ma=(e,t)=>{V(e,Na),tt(e,t)},od=Ba,Va=(e,t,n,r,s)=>{let o=j(e);switch(o){case Ai:sd(e,t,n);break;case Ui:Ba(e,n,r,s);break;case Na:od(e,n,r,s);break;default:throw new Error("Unknown message type")}return o};var Ii={};oo(Ii,{Awareness:()=>br,applyAwarenessUpdate:()=>Ks,encodeAwarenessUpdate:()=>An,modifyAwarenessUpdate:()=>ad,outdatedTimeout:()=>Ri,removeAwarenessStates:()=>_r});var Ri=3e4,br=class extends he{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let n=Rt();this.getLocalState()!==null&&Ri/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&Ri<=n-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&_r(this,r,"timeout")},pt(Ri/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){let n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:Rt()});let a=[],h=[],g=[],l=[];t===null?l.push(n):o==null?t!=null&&a.push(n):(h.push(n),ge(o,t)||g.push(n)),(a.length>0||g.length>0||l.length>0)&&this.emit("change",[{added:a,updated:g,removed:l},"local"]),this.emit("update",[{added:a,updated:h,removed:l},"local"])}setLocalStateField(t,n){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}},_r=(e,t,n)=>{let r=[];for(let s=0;s<t.length;s++){let o=t[s];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){let a=e.meta.get(o);e.meta.set(o,{clock:a.clock+1,lastUpdated:Rt()})}r.push(o)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},An=(e,t,n=e.states)=>{let r=t.length,s=rt();V(s,r);for(let o=0;o<r;o++){let a=t[o],h=n.get(a)||null,g=e.meta.get(a).clock;V(s,a),V(s,g),xt(s,JSON.stringify(h))}return X(s)},ad=(e,t)=>{let n=it(e),r=rt(),s=j(n);V(r,s);for(let o=0;o<s;o++){let a=j(n),h=j(n),g=JSON.parse(kt(n)),l=t(g);V(r,a),V(r,h),xt(r,JSON.stringify(l))}return X(r)},Ks=(e,t,n)=>{let r=it(t),s=Rt(),o=[],a=[],h=[],g=[],l=j(r);for(let u=0;u<l;u++){let f=j(r),p=j(r),y=JSON.parse(kt(r)),w=e.meta.get(f),S=e.states.get(f),R=w===void 0?0:w.clock;(R<p||R===p&&y===null&&e.states.has(f))&&(y===null?f===e.clientID&&e.getLocalState()!=null?p++:e.states.delete(f):e.states.set(f,y),e.meta.set(f,{clock:p,lastUpdated:s}),w===void 0&&y!==null?o.push(f):w!==void 0&&y===null?g.push(f):y!==null&&(ge(y,S)||h.push(f),a.push(f)))}(o.length>0||h.length>0||g.length>0)&&e.emit("change",[{added:o,updated:h,removed:g},n]),(o.length>0||a.length>0||g.length>0)&&e.emit("update",[{added:o,updated:a,removed:g},n])};var Fa=(e,t)=>{let n=Vn(e).buffer,r=Vn(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(s=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},Js=(e,t)=>{if(!t)return Wn(e);let n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(r=>{let s=rt();return xt(s,"AES-GCM"),tt(s,n),tt(s,new Uint8Array(r)),X(s)})},ja=(e,t)=>{let n=rt();return de(n,e),Js(X(n),t)},Xs=(e,t)=>{if(!t)return Wn(e);let n=it(e);kt(n)!=="AES-GCM"&&So(gt("Unknown encryption algorithm"));let s=lt(n),o=lt(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:s},t,o).then(a=>new Uint8Array(a))},Pa=(e,t)=>Xs(e,t).then(n=>pe(it(new Uint8Array(n))));var Lt=cc("y-webrtc"),Un=0,Ha=3,vr=1,ro=4,Di=new Map,Je=new Map,Wa=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),Lt("synced ",Et,e.name,$t," with all peers"))},za=(e,t,n)=>{let r=it(t),s=rt(),o=j(r);if(e===void 0)return null;let a=e.awareness,h=e.doc,g=!1;switch(o){case Un:{V(s,Un);let l=Va(r,s,h,e);l===Ui&&!e.synced&&n(),l===Ai&&(g=!0);break}case Ha:V(s,vr),tt(s,An(a,Array.from(a.getStates().keys()))),g=!0;break;case vr:Ks(a,lt(r),e);break;case ro:{let l=ee(r)===1,u=kt(r);if(u!==e.peerId&&(e.bcConns.has(u)&&!l||!e.bcConns.has(u)&&l)){let f=[],p=[];l?(e.bcConns.add(u),p.push(u)):(e.bcConns.delete(u),f.push(u)),e.provider.emit("peers",[{added:p,removed:f,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),Ga(e)}break}default:return console.error("Unable to compute message"),s}return g?s:null},hd=(e,t)=>{let n=e.room;return Lt("received message from ",Et,e.remotePeerId,bn," (",n.name,")",$t,Ne),za(n,t,()=>{e.synced=!0,Lt("synced ",Et,n.name,$t," with ",Et,e.remotePeerId),Wa(n)})},Zs=(e,t)=>{Lt("send message to ",Et,e.remotePeerId,$t,bn," (",e.room.name,")",Ne);try{e.peer.send(X(t))}catch{}},ud=(e,t)=>{Lt("broadcast message in ",Et,e.name,$t),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})},Oi=class{constructor(t,n,r,s){Lt("establishing connection to ",Et,r),this.room=s,this.remotePeerId=r,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new qa.default({initiator:n,...s.provider.peerOpts}),this.peer.on("signal",o=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),io(t,s,{to:r,from:s.peerId,type:"signal",token:this.glareToken,signal:o})}),this.peer.on("connect",()=>{Lt("connected to ",Et,r),this.connected=!0;let a=s.provider.doc,h=s.awareness,g=rt();V(g,Un),Gs(g,a),Zs(this,g);let l=h.getStates();if(l.size>0){let u=rt();V(u,vr),tt(u,An(h,Array.from(l.keys()))),Zs(this,u)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,s.webrtcConns.has(this.remotePeerId)&&(s.webrtcConns.delete(this.remotePeerId),s.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}])),Wa(s),this.peer.destroy(),Lt("closed connection to ",Et,r),to(s)}),this.peer.on("error",o=>{Lt("Error in connection to ",Et,r,": ",o),to(s)}),this.peer.on("data",o=>{let a=hd(this,o);a!==null&&Zs(this,a)})}destroy(){this.peer.destroy()}},Ee=(e,t)=>Js(t,e.key).then(n=>e.mux(()=>Ia(e.name,n))),$a=(e,t)=>{e.bcconnected&&Ee(e,t),ud(e,t)},to=e=>{Di.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&io(t,e,{type:"announce",from:e.peerId}))})},Ga=e=>{if(e.provider.filterBcConns){let t=rt();V(t,ro),te(t,1),xt(t,e.peerId),Ee(e,X(t))}},eo=class{constructor(t,n,r,s){this.peerId=Ir(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=s,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Da(),this.bcconnected=!1,this._bcSubscriber=o=>Xs(new Uint8Array(o),s).then(a=>this.mux(()=>{let h=za(this,a,()=>{});h&&Ee(this,X(h))})),this._docUpdateHandler=(o,a)=>{let h=rt();V(h,Un),Ma(h,o),$a(this,X(h))},this._awarenessUpdateHandler=({added:o,updated:a,removed:h},g)=>{let l=o.concat(a).concat(h),u=rt();V(u,vr),tt(u,An(this.awareness,l)),$a(this,X(u))},this._beforeUnloadHandler=()=>{_r(this.awareness,[t.clientID],"window unload"),Je.forEach(o=>{o.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),to(this);let t=this.name;Ua(t,this._bcSubscriber),this.bcconnected=!0,Ga(this);let n=rt();V(n,Un),Gs(n,this.doc),Ee(this,X(n));let r=rt();V(r,Un),Ys(r,this.doc),Ee(this,X(r));let s=rt();V(s,Ha),Ee(this,X(s));let o=rt();V(o,vr),tt(o,An(this.awareness,[this.doc.clientID])),Ee(this,X(o))}disconnect(){Di.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),_r(this.awareness,[this.doc.clientID],"disconnect");let t=rt();V(t,ro),te(t,0),xt(t,this.peerId),Ee(this,X(t)),Ra(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}},dd=(e,t,n,r)=>{if(Je.has(n))throw gt(`A Yjs Doc connected to room "${n}" already exists!`);let s=new eo(e,t,n,r);return Je.set(n,s),s},io=(e,t,n)=>{t.key?ja(n,t.key).then(r=>{e.send({type:"publish",topic:t.name,data:Br(r)})}):e.send({type:"publish",topic:t.name,data:n})},no=class extends Ti{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{Lt(`connected (${t})`);let n=Array.from(Je.keys());this.send({type:"subscribe",topics:n}),Je.forEach(r=>io(this,r,{type:"announce",from:r.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{let r=n.topic,s=Je.get(r);if(s==null||typeof r!="string")return;let o=a=>{let h=s.webrtcConns,g=s.peerId;if(a==null||a.from===g||a.to!==void 0&&a.to!==g||s.bcConns.has(a.from))return;let l=h.has(a.from)?()=>{}:()=>s.provider.emit("peers",[{removed:[],added:[a.from],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}]);switch(a.type){case"announce":h.size<s.provider.maxConns&&(at(h,a.from,()=>new Oi(this,!0,a.from,s)),l());break;case"signal":if(a.signal.type==="offer"){let u=h.get(a.from);if(u){let f=a.token,p=u.glareToken;if(p&&p>f){Lt("offer rejected: ",a.from);return}u.glareToken=void 0}}if(a.signal.type==="answer"){Lt("offer answered by: ",a.from);let u=h.get(a.from);u.glareToken=void 0}a.to===g&&(at(h,a.from,()=>new Oi(this,!1,a.from,s)).peer.signal(a.signal),l());break}};s.key?typeof n.data=="string"&&Pa(Mr(n.data),s.key).then(o):o(n.data)}}}),this.on("disconnect",()=>Lt(`disconnect (${t})`))}},Qs=e=>{e.emit("status",[{connected:e.connected}])},Li=class extends le{constructor(t,n,{signaling:r=["wss://y-webrtc-eu.fly.dev"],password:s=null,awareness:o=new br(n),maxConns:a=20+pt(xo()*15),filterBcConns:h=!0,peerOpts:g={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=h,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=a,this.peerOpts=g,this.key=s?Fa(s,t):Wn(null),this.room=null,this.key.then(l=>{this.room=dd(n,this,t,l),this.shouldConnect?this.room.connect():this.room.disconnect(),Qs(this)}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{let n=at(Di,t,()=>new no(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&(this.room.connect(),Qs(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),Di.delete(t.url))}),this.room&&(this.room.disconnect(),Qs(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),Je.delete(this.roomName)}),super.destroy()}};window.Y=wr;window.IndexeddbPersistence=Ci;window.WebrtcProvider=Li;window.awarenessProtocol=Ii;window.yjsModulesLoaded=!0;window.dispatchEvent(new Event("yjsModulesLoaded"));})();
/*! Bundled license information:

simple-peer/simplepeer.min.js:
  (*!
  * The buffer module from node.js, for the browser.
  *
  * @author   Feross Aboukhadijeh <https://feross.org>
  * @license  MIT
  *)
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  (*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
