<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <title data-i18n="app.title">PBE Score Keeper</title>
  <link href="css/jquery-ui.min.css" rel="stylesheet">
  <script src="scripts/jquery-3.7.1.min.js"></script>
  <script src="scripts/jquery-ui.min.js"></script>
  <!-- Yjs CRDT Library - Bundled for browser -->
  <script src="scripts/yjs-bundle.min.js"></script>
  <script src="scripts/app-globals.js"></script>
  <script src="scripts/app-yjs.js"></script>
  <!-- i18n: app-i18n.js defines register_i18n_language, then language files register themselves -->
  <script src="scripts/app-i18n.js"></script>
  <script src="scripts/i18n/en.js"></script>
  <script src="scripts/i18n/es.js"></script>
  <script src="scripts/i18n/fr.js"></script>
  <script src="scripts/i18n/pig.js"></script>
  <script src="scripts/app-theme.js"></script>
  <script src="scripts/app-ui-mode.js"></script>
  <script src="scripts/app-header-menu.js"></script>
  <script src="scripts/app-state.js"></script>
  <script src="scripts/app-data.js"></script>
  <script src="scripts/app-reorder.js"></script>
  <script src="scripts/app-summaries.js"></script>
  <script src="scripts/app-snapshot.js"></script>
  <script src="scripts/app-import-export.js"></script>
  <script src="scripts/app-backup.js"></script>
  <script src="scripts/app-sync-crypto.js"></script>
  <script src="scripts/app-sync.js"></script>
  <script src="scripts/app-history.js"></script>
  <script src="scripts/app-block-manager.js"></script>
  <script src="scripts/app-team-manager.js"></script>
  <script src="scripts/app-display.js"></script>
  <script src="scripts/app-storage.js"></script>
  <script src="scripts/app.js"></script>

  <link rel="stylesheet" href="css/styles.css">

</head>

<body>

  <div data-role="page" id="main">
    <div data-role="header" class="jqm-header">
      <div class="header-row">
        <div class="header-menu">
          <button id="header_menu_toggle" class="header-menu-toggle" type="button" aria-expanded="false" aria-controls="header_menu_panel" data-i18n-aria-label="menu.toggle_aria" data-i18n-title="menu.toggle_title">
            <span class="header-menu-icon" aria-hidden="true">&#9776;</span>
          </button>
          <div id="header_menu_panel" class="header-menu-panel" aria-hidden="false">
            <label class="language-picker" for="language_preference">
              <span data-i18n="app.language">Language</span>
              <select id="language_preference" class="config-select">
                <!-- Options populated dynamically from registered languages -->
              </select>
            </label>
            <label class="theme-picker" for="theme_preference">
              <span data-i18n="app.theme">Theme</span>
              <select id="theme_preference" class="config-select">
                <option value="system" data-i18n="theme.system">System</option>
                <option value="light" data-i18n="theme.light">Light</option>
                <option value="dark" data-i18n="theme.dark">Dark</option>
              </select>
            </label>
            <label class="ui-mode-toggle">
              <span data-i18n="ui_mode.label">UI Mode</span>
              <span class="ui-mode-option" data-i18n="ui_mode.classic">Classic</span>
              <span class="ui-mode-switch">
                <input type="checkbox" id="ui_mode_toggle" role="switch" data-i18n-aria-label="ui_mode.toggle_aria" data-i18n-title="ui_mode.toggle_title">
                <span class="ui-mode-slider" aria-hidden="true"></span>
              </span>
              <span class="ui-mode-option" data-i18n="ui_mode.beta">Beta</span>
            </label>
            <div id="header_menu_rounding_slot" class="header-menu-rounding-slot"></div>
            <div id="header_menu_session_slot" class="header-menu-session-slot"></div>
            <div id="header_menu_question_slot" class="header-menu-question-slot">
              <fieldset class="config-fieldset header-menu-question-fieldset" id="header_menu_question_fieldset">
                <legend data-i18n="score_entry.question">Question</legend>
              </fieldset>
            </div>
            <div class="header-menu-actions">
              <button id="import_export_button" class="config-add-btn header-menu-action-btn" type="button" onclick="showImportExportDialog()" data-i18n="advanced.title"></button>
              <button id="change_log_button" class="config-add-btn header-menu-action-btn" type="button" onclick="showChangeLogDialog()" data-i18n="edit_log.see_all_changes"></button>
            </div>
          </div>
        </div>
        <h1 data-i18n="app.title">PBE Score Keeper</h1>
        <div class="header-sync">
          <div id="sync_button_slot" class="sync-button-slot">
            <button id="sync_button" class="sync-button" onclick="showSyncDialog()" data-i18n-title="sync.button_tooltip">
              <span class="sync-icon">üîÑ</span>
              <span class="sync-status" data-i18n="sync.button">Sync</span>
            </button>
          </div>
          <span id="sync_server_badge" class="sync-server-badge" style="display: none;" data-i18n-title="sync.server_badge_tooltip">üñ•Ô∏è</span>
          <div id="sync_peers" class="sync-peers" style="display: none;">
            <span class="peer-count"></span>
            <div class="peer-tooltip"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="accordion">
      <h3 id="accordion_config_header" data-i18n="config.title">Configuration (Session/Round/Game)</h3>
      <div data-role="session_configuration" id="session_configuration">
        <h4 data-i18n="config.instructions_title">Instructions</h4>
        <p data-i18n="config.instructions">This is a score keeper for the Pathfinder Bible Experience (aka the Bible Bowl). Please enter your number of teams as well as blocks/groups below so that the scoring grid can be created</p>
        <h5 data-i18n="config.storage_title">Data Storage Note</h5>
        <p data-i18n="config.storage_note">Data is stored only on your device, and is not shared in any way with any server. This also means that if you change devices your data will not appear on the new device.</p>
        <div id="session_fieldset_placeholder"></div>
        <fieldset class="config-fieldset" id="session_fieldset">
          <legend data-i18n="config.session_title">Session</legend>
          <div class="config-count-row">
            <span id="session_display_count"></span>
          </div>
          <div class="session-buttons-row">
            <button id="new_session" class="config-add-btn" onclick='local_data_update(this)' data-i18n="config.new_session">New Session</button>
            <button id="manage_sessions" class="config-add-btn" onclick='showSessionManagerDialog()' data-i18n="session_manager.manage_button">Manage Sessions</button>
          </div>
        </fieldset>
        <div id="teams_fieldset_placeholder"></div>
        <fieldset class="config-fieldset" id="teams_fieldset">
          <legend id="teams_legend" data-i18n="teams.title" data-i18n-count="1">Set up your Teams</legend>
          <div class="config-count-row" style="display:none;">
            <span id="total_teams"></span> <span id="total_teams_text" data-i18n="teams.teams">teams</span>
          </div>
          <div id="team_names" class="config-items-list"></div>
          <div id="team_minimum_notice" class="config-minimum-notice" style="display:none;" data-i18n="teams.minimum_notice">At least 1 team is required</div>
          <button id="total_teams_increase" class="config-add-btn" onclick='local_data_update(this)' data-i18n="teams.add_team">Add Team</button>
        </fieldset>
        <div id="blocks_fieldset_placeholder"></div>
        <fieldset class="config-fieldset" id="blocks_fieldset">
          <legend id="blocks_legend" data-i18n="blocks.title" data-i18n-count="1">Set up your Blocks</legend>
          <div class="config-count-row" style="display:none;">
            <span id="total_blocks"></span> <span id="total_blocks_text" data-i18n="blocks.blocks">blocks/groups</span>
          </div>
          <div id="block_names" class="config-items-list"></div>
          <div id="block_minimum_notice" class="config-minimum-notice" style="display:none;" data-i18n="blocks.minimum_notice">At least 1 block/group is required</div>
          <div id="block_in_use_notice" class="config-in-use-notice" style="display:none;" data-i18n="blocks.in_use_notice">Cannot delete: block/group is assigned to questions</div>
          <button id="total_blocks_increase" class="config-add-btn" onclick='local_data_update(this)' data-i18n="blocks.add_block">Add Block/Group</button>
        </fieldset>
        <fieldset id="max_points_fieldset">
          <legend data-i18n="points.title">Maximum Points per Question</legend>
          <span id="max_points_controls" class="max-points-controls">
            <span id="max_points" class="editable-number" tabindex="0" role="button" data-i18n-aria-label="points.edit_max_points"></span> <span id="max_points_text" data-i18n="points.points">points</span> <button id="max_points_decrease" onclick='local_data_update(this)'>-</button> <button id="max_points_increase" onclick='local_data_update(this)'>+</button>
            <span id="max_points_minimum_notice" class="config-minimum-notice" style="display:none;" data-i18n="points.minimum_notice">Cannot be lower due to already entered scores</span>
          </span>
        </fieldset>
        <div id="rounding_fieldset_placeholder"></div>
        <fieldset class="config-fieldset" id="rounding_fieldset">
          <legend class="rounding-legend" data-i18n="rounding.title_classic">Rounding Live Team score to best team's total?</legend>
          <div id="rounding" class="rounding-toggle is-exact">
            <span class="rounding-label" data-i18n="rounding.title">Live Score</span>
            <label>
              <input type="radio" id="rounding_no" name="rounding" value="false" onchange="local_data_update(this)">
              <span class="ui-mode-option" data-i18n="rounding.no">Exact</span>
            </label>
            <span class="rounding-switch" aria-hidden="true">
              <span class="rounding-slider"></span>
            </span>
            <label>
              <input type="radio" id="rounding_yes" name="rounding" value="true" onchange="local_data_update(this)">
              <span class="ui-mode-option" data-i18n="rounding.yes">Rounded</span>
            </label>
          </div>
        </fieldset>
        <button class="config-add-btn" onclick="local_data_update(this);$( '#accordion' ).accordion({active: 1});" data-i18n="config.enter_scores">Enter Scores</button>
      </div>
      <h3 data-i18n="score_entry.title">Score Entry</h3>
      <div>
        <div data-role="score_entry">
          <div id="score_entry_fieldset_placeholder"></div>
          <fieldset id="beta_session_fieldset" class="beta-session-fieldset" aria-hidden="true">
            <legend class="beta-session-legend">
              <button id="session_prev_button" class="beta-session-nav-btn" type="button" onclick="local_data_update(this)" data-i18n-aria-label="session_nav.previous" data-i18n-title="session_nav.previous">&lt;</button>
              <span id="beta_session_title" class="beta-session-title"></span>
              <button id="session_next_button" class="beta-session-nav-btn" type="button" onclick="local_data_update(this)" data-i18n-aria-label="session_nav.next" data-i18n-title="session_nav.next">&gt;</button>
            </legend>
            <div id="beta_session_entry_slot" class="beta-session-entry-slot"></div>
          </fieldset>
          <div id="score_entry_content">
            <div id="score_entry_content_body_placeholder"></div>
            <fieldset id="beta_question_fieldset" class="beta-question-fieldset" aria-hidden="true">
              <legend class="beta-question-legend">
                <span id="beta_question_prev_slot"></span>
                <span id="beta_question_title_slot"></span>
                <span id="beta_question_next_slot"></span>
              </legend>
              <div id="beta_question_slot" class="beta-question-slot"></div>
              <div id="beta_question_bottom_slot" class="beta-question-bottom-slot"></div>
            </fieldset>
            <div id="score_entry_content_body">
              <div>
                <div class="nav-buttons score-entry-top-nav">
                  <span id="previous_question_placeholder"></span>
                  <button class="config-add-btn" id="previous_question" onclick='local_data_update(this)' data-i18n="score_entry.previous">Previous Question</button>
                  <button class="config-add-btn score-entry-advanced-toggle" id="score_entry_advanced_toggle" type="button" data-i18n="score_entry.advanced_toggle" aria-expanded="false" aria-controls="score_entry_advanced_options"></button>
                  <span id="next_question_placeholder"></span>
                  <button class="config-add-btn" id="next_question" onclick='local_data_update(this)' data-i18n="score_entry.next">Next Question</button>
                </div>
                <br>
                <div id="score_entry_advanced_placeholder" class="score-entry-advanced-placeholder"></div>
                <div id="score_entry_advanced_options" class="score-entry-advanced">
                  <button type="button" id="score_entry_reorder_button" class="config-add-btn score-entry-reorder-button" data-i18n="score_entry.reorder_entry" aria-haspopup="dialog"></button>
                  <div id="question_quick_nav_container" class="question-quick-nav-container"></div>
                  <label><span id="ignore_question_warning" style="font-size: xx-large;display:none">üö´</span><input type="checkbox" id="ignore_question" onchange="local_data_update(this)"><span data-i18n="score_entry.ignore">Ignore this Question in Score Calculations</span></label>
                  <label><input type="checkbox" id="extra_credit" onchange="local_data_update(this)"><span data-i18n="score_entry.extra_credit">Allow Extra Credit</span></label>
                </div>
                <div id="ignored_question">
                  <h4><span id="current_question_title_placeholder"></span><span id="current_question_title_count" ></span></h4>
                  <div id="score_entry_fields" class="score-entry-fields">
                    <div class="score-entry-field" data-field="points">
                      <button type="button" class="score-entry-drag-handle drag-handle" draggable="true" data-i18n-title="score_entry.reorder_points" data-i18n-aria-label="score_entry.reorder_points">&equiv; &#8597;</button>
                      <fieldset>
                        <legend id="points_legend">
                          <span data-i18n="points.possible">Possible Points</span>
                          <span class="max-points-legend-controls">
                            <span class="max-points-legend-open">(</span>
                            <span id="max_points_controls_slot" class="max-points-controls-slot"></span>
                            <span class="max-points-legend-close">)</span>
                          </span>
                        </legend>
                        <div id="max_points_notice_slot" class="max-points-notice-slot"></div>
                        <div id="question_score">
                        </div>
                      </fieldset>
                    </div>
                    <div class="score-entry-field" data-field="block" id="score_entry_block_container">
                      <button type="button" class="score-entry-drag-handle drag-handle" draggable="true" data-i18n-title="score_entry.reorder_block" data-i18n-aria-label="score_entry.reorder_block">&equiv; &#8597;</button>
                      <fieldset id="question_block_fieldset">
                        <legend class="score-entry-block-legend">
                          <span id="score_entry_block_label" data-i18n="score_entry.block_group" data-i18n-count="1">Block/Group</span>
                          <button id="manage_blocks_button" class="config-add-btn score-entry-manage-blocks" type="button" onclick="showBlockManagerDialog()" data-i18n="blocks.manage_button"></button>
                        </legend>
                        <div id="question_block"></div>
                      </fieldset>
                    </div>
                    <div class="score-entry-field score-entry-team-container" data-field="teams">
                      <fieldset id="question_teams_fieldset" class="score-entry-team-fieldset">
                        <legend class="score-entry-team-legend">
                          <span id="score_entry_team_label" data-i18n="score_entry.team" data-i18n-count="1">Team</span>
                          <button id="manage_teams_button" class="config-add-btn score-entry-manage-teams" type="button" onclick="showTeamManagerDialog()" data-i18n="teams.manage_button"></button>
                        </legend>
                        <div id="question_teams"></div>
                      </fieldset>
                    </div>
                  </div>
                </div>
              </div><br>
              <div id="score_entry_bottom_nav_placeholder"></div>
              <div id="score_entry_bottom_nav" class="nav-buttons">
                <button class="config-add-btn" id="previous_question_2" onclick='local_data_update(this)' data-i18n="score_entry.previous">Previous Question</button>
                <button class="config-add-btn" id="next_question_2" onclick='local_data_update(this)' data-i18n="score_entry.next">Next Question</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <h3 id="accordion_scores_tabs_header" data-i18n="scores.according"></h3>
      <div id="accordion_scores_tabs_panel">
        <div id="scores_tabs" class="scores-tabs">
          <ul>
            <li id="scores_tab_team_exact_tab"><a href="#scores_tab_team_exact" data-i18n="scores.team">Team</a></li>
            <li id="scores_tab_team_rounded_tab"><a href="#scores_tab_team_rounded" data-i18n="scores.team">Team</a></li>
            <li id="scores_tab_by_block_tab"><a href="#scores_tab_by_block" data-i18n="scores.by_block"></a></li>
            <li id="scores_tab_team_block_tab"><a href="#scores_tab_team_block" data-i18n="scores.team_and_block"></a></li>
            <li id="scores_tab_history_tab"><a href="#scores_tab_history" data-i18n="scores.question_history"></a></li>
          </ul>
          <div id="scores_tab_team_exact" class="scores-tab-panel"></div>
          <div id="scores_tab_team_rounded" class="scores-tab-panel"></div>
          <div id="scores_tab_by_block" class="scores-tab-panel"></div>
          <div id="scores_tab_team_block" class="scores-tab-panel"></div>
          <div id="scores_tab_history" class="scores-tab-panel"></div>
        </div>
      </div>
      <h3 id="accordion_score_by_team_exact" data-i18n="scores.team_exact">Team (Exact)</h3>
      <div id="accordion_score_by_team_exact_panel">
        <div data-role="team_scores" id="team_scores" data-i18n="placeholders.team_scores">
          Team Scores Go Here
        </div>
      </div>
      <h3 id="accordion_score_by_team_rounded" data-i18n="scores.team_rounded">Team (Rounded)</h3>
      <div id="accordion_score_by_team_rounded_panel">
        <div data-role="rounded_team_scores" id="rounded_team_scores" data-i18n="placeholders.rounded_scores">
          Rounded Team Scores Go Here
        </div>
      </div>
      <h3 id="accordion_score_by_block" data-i18n="scores.by_block">Block</h3>
      <div id="accordion_score_by_block_panel">
        <div data-role="block_scores" id="block_scores" data-i18n="placeholders.block_scores">
          Block/Group Scores Go Here
        </div>
      </div>
      <h3 id="accordion_score_by_team_and_block" data-i18n="scores.team_and_block">Team & Block</h3>
      <div id="accordion_score_by_team_and_block_panel">
        <div data-role="team_and_block_scores" id="team_and_block_scores" data-i18n="placeholders.team_block_scores">
          Team &amp; Block/Group Scores Go Here
        </div>
      </div>
      <h3 id="accordion_score_by_question_history" data-i18n="scores.question_history">Question Log</h3>
      <div id="accordion_score_by_question_history_panel">
        <div data-role="scores" id="scores" data-i18n="placeholders.question_history">
          Question History Goes Here
        </div>
      </div>
      <h3 id="accordion_change_log_header" data-i18n="edit_log.title">Change Log</h3>
      <div id="accordion_change_log_panel">
        <div data-role="history" id="history_viewer">
          <div class="history-header-row">
            <h4 data-i18n="edit_log.change_log">Change Log</h4>
            <button id="view_backups_btn" class="config-add-btn" onclick="showBackupBrowserDialog()" data-i18n="backup.view_backups">View Backups</button>
          </div>
          <table id="history_table">
            <thead>
              <tr>
                <th data-i18n="edit_log.time">Time</th>
                <th data-i18n="edit_log.user">User</th>
                <th data-i18n="edit_log.session">Session</th>
                <th data-i18n="edit_log.action">Action</th>
                <th data-i18n="edit_log.details_header">Details</th>
              </tr>
            </thead>
            <tbody id="history_list">
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: #666;" data-i18n="edit_log.no_changes">
                  No changes recorded yet. Make some changes to see them here!
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <h3 id="accordion_advanced_header" data-i18n="advanced.title">Import/Export</h3>
      <div id="accordion_advanced_panel">
        <div data-role="Advanced" id="Advanced">
          <fieldset>
            <legend id = "export_csv_label" data-i18n="advanced.export_csv">Export CSV</legend>
            <button class="config-add-btn" id= "export_team" onclick='local_data_update(this)' data-i18n="advanced.export_team">Export Score by Team</button>
            <button class="config-add-btn" id= "export_block" onclick='local_data_update(this)' data-i18n="advanced.export_block">Export Score by Block/Group</button>
            <button class="config-add-btn" id= "export_team_and_block" onclick='local_data_update(this)' data-i18n="advanced.export_team_and_block">Export Score by Team & Block/Group</button>
            <button class="config-add-btn" id= "export_question_log" onclick='local_data_update(this)' data-i18n="advanced.export_question_history">Export Question History</button>
          </fieldset>
          <fieldset>
            <legend id = "export_json_label" data-i18n="advanced.export_json">Export for Importing</legend>
            <button class="config-add-btn" id= "export_session_json" onclick='local_data_update(this)' data-i18n="advanced.export_session">Export Session (Round/Game)</button>
            <button class="config-add-btn" id= "export_all_json" onclick='local_data_update(this)' data-i18n="advanced.export_all">Export All</button>
          </fieldset>
          <fieldset>
            <legend id = "import_json_label" data-i18n="advanced.import">Import</legend>
            <p data-i18n="advanced.import_warning">Warning: Importing bad files can corrupt your data. It is strongly recommended that you run an "Export for Importing" before importing.</p>
            <div id = "import_group">
              <span data-i18n="advanced.select_file">Please Select file to import:</span>
              <input type="file" id="import_file" />
            </div>
          </fieldset>
          <fieldset>
            <legend data-i18n="advanced.device_migration">Device Migration</legend>
            <p data-i18n="advanced.migration_description">Transfer all sessions between devices using peer-to-peer sync.</p>
            <button class="config-add-btn" id="migration_send" onclick="showMigrationDialog('send')" data-i18n="advanced.migration_send">Send to Another Device</button>
            <button class="config-add-btn" id="migration_receive" onclick="showMigrationDialog('receive')" data-i18n="advanced.migration_receive">Receive from Another Device</button>
          </fieldset>
        </div>
      </div>
    </div>
    <div id="scores_tabs_placeholder"></div>
    <footer><p><span data-i18n="footer.feedback">Have an idea to make this better?</span> <a target="_blank" href="https://github.com/antgiant/PBE_Score_Keeper/issues" data-i18n="footer.let_me_know">Let me know</a>.</p>
    <p><center data-i18n="footer.version" data-i18n-version="2.18.16">v 2.18.16</center></p></footer>
</body>

</html>
